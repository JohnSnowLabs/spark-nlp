
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>sparknlp.annotator.ner.ner_dl &#8212; Spark NLP 4.1.0 documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../../../../static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../../../../static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../../static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../../static/css/custom.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../../../../" id="documentation_options" src="../../../../static/documentation_options.js"></script>
    <script src="../../../../static/jquery.js"></script>
    <script src="../../../../static/underscore.js"></script>
    <script src="../../../../static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../../static/doctools.js"></script>
    <script src="../../../../static/toggleprompt.js"></script>
    <link rel="shortcut icon" href="../../../../static/fav.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../../../index.html">
  
  
  
  
    <img src="../../../../static/logo.png" class="logo__image only-light" alt="Logo image">
    <img src="../../../../static/logo.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../getting_started/index.html">
  Getting Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../user_guide/index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../third_party/index.html">
  Third Party Projects
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../reference/index.html">
  API Reference
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  <h1>Source code for sparknlp.annotator.ner.ner_dl</h1><div class="highlight"><pre>
<span></span><span class="c1">#  Copyright 2017-2022 John Snow Labs</span>
<span class="c1">#</span>
<span class="c1">#  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1">#  you may not use this file except in compliance with the License.</span>
<span class="c1">#  You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1">#  Unless required by applicable law or agreed to in writing, software</span>
<span class="c1">#  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1">#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1">#  See the License for the specific language governing permissions and</span>
<span class="c1">#  limitations under the License.</span>
<span class="sd">&quot;&quot;&quot;Contains classes for NerDL.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">sparknlp.common</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sparknlp.annotator.ner.ner_approach</span> <span class="kn">import</span> <span class="n">NerApproach</span>


<div class="viewcode-block" id="NerDLApproach"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLApproach">[docs]</a><span class="k">class</span> <span class="nc">NerDLApproach</span><span class="p">(</span><span class="n">AnnotatorApproach</span><span class="p">,</span> <span class="n">NerApproach</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This Named Entity recognition annotator allows to train generic NER model</span>
<span class="sd">    based on Neural Networks.</span>

<span class="sd">    The architecture of the neural network is a Char CNNs - BiLSTM - CRF that</span>
<span class="sd">    achieves state-of-the-art in most datasets.</span>

<span class="sd">    For instantiated/pretrained models, see :class:`.NerDLModel`.</span>

<span class="sd">    The training data should be a labeled Spark Dataset, in the format of</span>
<span class="sd">    :class:`.CoNLL` 2003 IOB with `Annotation` type columns. The data should</span>
<span class="sd">    have columns of type ``DOCUMENT, TOKEN, WORD_EMBEDDINGS`` and an additional</span>
<span class="sd">    label column of annotator type ``NAMED_ENTITY``.</span>

<span class="sd">    Excluding the label, this can be done with for example:</span>

<span class="sd">    - a SentenceDetector,</span>
<span class="sd">    - a Tokenizer and</span>
<span class="sd">    - a WordEmbeddingsModel (any embeddings can be chosen, e.g. BertEmbeddings</span>
<span class="sd">      for BERT based embeddings).</span>

<span class="sd">    For extended examples of usage, see the `Spark NLP Workshop &lt;https://github.com/JohnSnowLabs/spark-nlp-workshop/tree/master/jupyter/training/english/dl-ner&gt;`__.</span>

<span class="sd">    ==================================== ======================</span>
<span class="sd">    Input Annotation types               Output Annotation type</span>
<span class="sd">    ==================================== ======================</span>
<span class="sd">    ``DOCUMENT, TOKEN, WORD_EMBEDDINGS`` ``NAMED_ENTITY``</span>
<span class="sd">    ==================================== ======================</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    labelColumn</span>
<span class="sd">        Column with label per each token</span>
<span class="sd">    entities</span>
<span class="sd">        Entities to recognize</span>
<span class="sd">    minEpochs</span>
<span class="sd">        Minimum number of epochs to train, by default 0</span>
<span class="sd">    maxEpochs</span>
<span class="sd">        Maximum number of epochs to train, by default 50</span>
<span class="sd">    verbose</span>
<span class="sd">        Level of verbosity during training, by default 2</span>
<span class="sd">    randomSeed</span>
<span class="sd">        Random seed</span>
<span class="sd">    lr</span>
<span class="sd">        Learning Rate, by default 0.001</span>
<span class="sd">    po</span>
<span class="sd">        Learning rate decay coefficient. Real Learning Rage = lr / (1 + po *</span>
<span class="sd">        epoch), by default 0.005</span>
<span class="sd">    batchSize</span>
<span class="sd">        Batch size, by default 8</span>
<span class="sd">    dropout</span>
<span class="sd">        Dropout coefficient, by default 0.5</span>
<span class="sd">    graphFolder</span>
<span class="sd">        Folder path that contain external graph files</span>
<span class="sd">    configProtoBytes</span>
<span class="sd">        ConfigProto from tensorflow, serialized into byte array.</span>
<span class="sd">    useContrib</span>
<span class="sd">        whether to use contrib LSTM Cells. Not compatible with Windows. Might</span>
<span class="sd">        slightly improve accuracy</span>
<span class="sd">    validationSplit</span>
<span class="sd">        Choose the proportion of training dataset to be validated against the</span>
<span class="sd">        model on each Epoch. The value should be between 0.0 and 1.0 and by</span>
<span class="sd">        default it is 0.0 and off, by default 0.0</span>
<span class="sd">    evaluationLogExtended</span>
<span class="sd">        Whether logs for validation to be extended, by default False.</span>
<span class="sd">    testDataset</span>
<span class="sd">        Path to test dataset. If set used to calculate statistic on it during</span>
<span class="sd">        training.</span>
<span class="sd">    includeConfidence</span>
<span class="sd">        whether to include confidence scores in annotation metadata, by default</span>
<span class="sd">        False</span>
<span class="sd">    includeAllConfidenceScores</span>
<span class="sd">        whether to include all confidence scores in annotation metadata or just</span>
<span class="sd">        the score of the predicted tag, by default False</span>
<span class="sd">    enableOutputLogs</span>
<span class="sd">        Whether to use stdout in addition to Spark logs, by default False</span>
<span class="sd">    outputLogsPath</span>
<span class="sd">        Folder path to save training logs</span>
<span class="sd">    enableMemoryOptimizer</span>
<span class="sd">        Whether to optimize for large datasets or not. Enabling this option can</span>
<span class="sd">        slow down training, by default False</span>
<span class="sd">    useBestModel</span>
<span class="sd">        Whether to restore and use the model that has achieved the best performance</span>
<span class="sd">        at the end of the training.</span>
<span class="sd">    bestModelMetric</span>
<span class="sd">        Whether to check F1 Micro-average or F1 Macro-average as a final metric for the best model</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import sparknlp</span>
<span class="sd">    &gt;&gt;&gt; from sparknlp.base import *</span>
<span class="sd">    &gt;&gt;&gt; from sparknlp.annotator import *</span>
<span class="sd">    &gt;&gt;&gt; from sparknlp.training import *</span>
<span class="sd">    &gt;&gt;&gt; from pyspark.ml import Pipeline</span>

<span class="sd">    This CoNLL dataset already includes a sentence, token and label</span>
<span class="sd">    column with their respective annotator types. If a custom dataset is used,</span>
<span class="sd">    these need to be defined with for example:</span>

<span class="sd">    &gt;&gt;&gt; documentAssembler = DocumentAssembler() \\</span>
<span class="sd">    ...     .setInputCol(&quot;text&quot;) \\</span>
<span class="sd">    ...     .setOutputCol(&quot;document&quot;)</span>
<span class="sd">    &gt;&gt;&gt; sentence = SentenceDetector() \\</span>
<span class="sd">    ...     .setInputCols([&quot;document&quot;]) \\</span>
<span class="sd">    ...     .setOutputCol(&quot;sentence&quot;)</span>
<span class="sd">    &gt;&gt;&gt; tokenizer = Tokenizer() \\</span>
<span class="sd">    ...     .setInputCols([&quot;sentence&quot;]) \\</span>
<span class="sd">    ...     .setOutputCol(&quot;token&quot;)</span>

<span class="sd">    Then the training can start</span>

<span class="sd">    &gt;&gt;&gt; embeddings = BertEmbeddings.pretrained() \\</span>
<span class="sd">    ...     .setInputCols([&quot;sentence&quot;, &quot;token&quot;]) \\</span>
<span class="sd">    ...     .setOutputCol(&quot;embeddings&quot;)</span>
<span class="sd">    &gt;&gt;&gt; nerTagger = NerDLApproach() \\</span>
<span class="sd">    ...     .setInputCols([&quot;sentence&quot;, &quot;token&quot;, &quot;embeddings&quot;]) \\</span>
<span class="sd">    ...     .setLabelColumn(&quot;label&quot;) \\</span>
<span class="sd">    ...     .setOutputCol(&quot;ner&quot;) \\</span>
<span class="sd">    ...     .setMaxEpochs(1) \\</span>
<span class="sd">    ...     .setRandomSeed(0) \\</span>
<span class="sd">    ...     .setVerbose(0)</span>
<span class="sd">    &gt;&gt;&gt; pipeline = Pipeline().setStages([</span>
<span class="sd">    ...     embeddings,</span>
<span class="sd">    ...     nerTagger</span>
<span class="sd">    ... ])</span>

<span class="sd">    We use the sentences, tokens, and labels from the CoNLL dataset.</span>

<span class="sd">    &gt;&gt;&gt; conll = CoNLL()</span>
<span class="sd">    &gt;&gt;&gt; trainingData = conll.readDataset(spark, &quot;src/test/resources/conll2003/eng.train&quot;)</span>
<span class="sd">    &gt;&gt;&gt; pipelineModel = pipeline.fit(trainingData)</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    NerCrfApproach : for a generic CRF approach</span>
<span class="sd">    NerConverter : to further process the results</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">lr</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;lr&quot;</span><span class="p">,</span> <span class="s2">&quot;Learning Rate&quot;</span><span class="p">,</span> <span class="n">TypeConverters</span><span class="o">.</span><span class="n">toFloat</span><span class="p">)</span>

    <span class="n">po</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;po&quot;</span><span class="p">,</span> <span class="s2">&quot;Learning rate decay coefficient. Real Learning Rage = lr / (1 + po * epoch)&quot;</span><span class="p">,</span>
               <span class="n">TypeConverters</span><span class="o">.</span><span class="n">toFloat</span><span class="p">)</span>

    <span class="n">batchSize</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;batchSize&quot;</span><span class="p">,</span> <span class="s2">&quot;Batch size&quot;</span><span class="p">,</span> <span class="n">TypeConverters</span><span class="o">.</span><span class="n">toInt</span><span class="p">)</span>

    <span class="n">dropout</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;dropout&quot;</span><span class="p">,</span> <span class="s2">&quot;Dropout coefficient&quot;</span><span class="p">,</span> <span class="n">TypeConverters</span><span class="o">.</span><span class="n">toFloat</span><span class="p">)</span>

    <span class="n">graphFolder</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;graphFolder&quot;</span><span class="p">,</span> <span class="s2">&quot;Folder path that contain external graph files&quot;</span><span class="p">,</span>
                        <span class="n">TypeConverters</span><span class="o">.</span><span class="n">toString</span><span class="p">)</span>

    <span class="n">configProtoBytes</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;configProtoBytes&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;ConfigProto from tensorflow, serialized into byte array. Get with config_proto.SerializeToString()&quot;</span><span class="p">,</span>
                             <span class="n">TypeConverters</span><span class="o">.</span><span class="n">toListInt</span><span class="p">)</span>

    <span class="n">useContrib</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;useContrib&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;whether to use contrib LSTM Cells. Not compatible with Windows. Might slightly improve accuracy.&quot;</span><span class="p">,</span>
                       <span class="n">TypeConverters</span><span class="o">.</span><span class="n">toBoolean</span><span class="p">)</span>

    <span class="n">validationSplit</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;validationSplit&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;Choose the proportion of training dataset to be validated against the model on each Epoch. The value should be between 0.0 and 1.0 and by default it is 0.0 and off.&quot;</span><span class="p">,</span>
                            <span class="n">TypeConverters</span><span class="o">.</span><span class="n">toFloat</span><span class="p">)</span>

    <span class="n">evaluationLogExtended</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;evaluationLogExtended&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;Whether logs for validation to be extended: it displays time and evaluation of each label. Default is False.&quot;</span><span class="p">,</span>
                                  <span class="n">TypeConverters</span><span class="o">.</span><span class="n">toBoolean</span><span class="p">)</span>

    <span class="n">testDataset</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;testDataset&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Path to test dataset. If set used to calculate statistic on it during training.&quot;</span><span class="p">,</span>
                        <span class="n">TypeConverters</span><span class="o">.</span><span class="n">identity</span><span class="p">)</span>

    <span class="n">includeConfidence</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;includeConfidence&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;whether to include confidence scores in annotation metadata&quot;</span><span class="p">,</span>
                              <span class="n">TypeConverters</span><span class="o">.</span><span class="n">toBoolean</span><span class="p">)</span>

    <span class="n">includeAllConfidenceScores</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;includeAllConfidenceScores&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;whether to include all confidence scores in annotation metadata or just the score of the predicted tag&quot;</span><span class="p">,</span>
                                       <span class="n">TypeConverters</span><span class="o">.</span><span class="n">toBoolean</span><span class="p">)</span>

    <span class="n">enableOutputLogs</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;enableOutputLogs&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;Whether to use stdout in addition to Spark logs.&quot;</span><span class="p">,</span>
                             <span class="n">TypeConverters</span><span class="o">.</span><span class="n">toBoolean</span><span class="p">)</span>

    <span class="n">outputLogsPath</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;outputLogsPath&quot;</span><span class="p">,</span> <span class="s2">&quot;Folder path to save training logs&quot;</span><span class="p">,</span>
                           <span class="n">TypeConverters</span><span class="o">.</span><span class="n">toString</span><span class="p">)</span>

    <span class="n">enableMemoryOptimizer</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;enableMemoryOptimizer&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;Whether to optimize for large datasets or not. Enabling this option can slow down training.&quot;</span><span class="p">,</span>
                                  <span class="n">TypeConverters</span><span class="o">.</span><span class="n">toBoolean</span><span class="p">)</span>

    <span class="n">useBestModel</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;useBestModel&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;Whether to restore and use the model that has achieved the best performance at the end of the training.&quot;</span><span class="p">,</span>
                         <span class="n">TypeConverters</span><span class="o">.</span><span class="n">toBoolean</span><span class="p">)</span>

    <span class="n">bestModelMetric</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;bestModelMetric&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;Whether to check F1 Micro-average or F1 Macro-average as a final metric for the best model.&quot;</span><span class="p">,</span>
                            <span class="n">TypeConverters</span><span class="o">.</span><span class="n">toString</span><span class="p">)</span>

<div class="viewcode-block" id="NerDLApproach.setConfigProtoBytes"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLApproach.setConfigProtoBytes">[docs]</a>    <span class="k">def</span> <span class="nf">setConfigProtoBytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets configProto from tensorflow, serialized into byte array.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        b : List[int]</span>
<span class="sd">            ConfigProto from tensorflow, serialized into byte array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">configProtoBytes</span><span class="o">=</span><span class="n">b</span><span class="p">)</span></div>

<div class="viewcode-block" id="NerDLApproach.setGraphFolder"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLApproach.setGraphFolder">[docs]</a>    <span class="k">def</span> <span class="nf">setGraphFolder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets folder path that contain external graph files.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p : str</span>
<span class="sd">            Folder path that contain external graph files</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">graphFolder</span><span class="o">=</span><span class="n">p</span><span class="p">)</span></div>

<div class="viewcode-block" id="NerDLApproach.setUseContrib"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLApproach.setUseContrib">[docs]</a>    <span class="k">def</span> <span class="nf">setUseContrib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets whether to use contrib LSTM Cells. Not compatible with Windows.</span>
<span class="sd">        Might slightly improve accuracy.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        v : bool</span>
<span class="sd">            Whether to use contrib LSTM Cells</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        Exception</span>
<span class="sd">            Windows not supported to use contrib</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="s1">&#39;win32&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Windows not supported to use contrib&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">useContrib</span><span class="o">=</span><span class="n">v</span><span class="p">)</span></div>

<div class="viewcode-block" id="NerDLApproach.setLr"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLApproach.setLr">[docs]</a>    <span class="k">def</span> <span class="nf">setLr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets Learning Rate, by default 0.001.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        v : float</span>
<span class="sd">            Learning Rate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="NerDLApproach.setPo"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLApproach.setPo">[docs]</a>    <span class="k">def</span> <span class="nf">setPo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets Learning rate decay coefficient, by default 0.005.</span>

<span class="sd">        Real Learning Rage is lr / (1 + po * epoch).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        v : float</span>
<span class="sd">            Learning rate decay coefficient</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">po</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="NerDLApproach.setBatchSize"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLApproach.setBatchSize">[docs]</a>    <span class="k">def</span> <span class="nf">setBatchSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets batch size, by default 64.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        v : int</span>
<span class="sd">            Batch size</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">batchSize</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="NerDLApproach.setDropout"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLApproach.setDropout">[docs]</a>    <span class="k">def</span> <span class="nf">setDropout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets dropout coefficient, by default 0.5.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        v : float</span>
<span class="sd">            Dropout coefficient</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">dropout</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">_create_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">java_model</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NerDLModel</span><span class="p">(</span><span class="n">java_model</span><span class="o">=</span><span class="n">java_model</span><span class="p">)</span>

<div class="viewcode-block" id="NerDLApproach.setValidationSplit"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLApproach.setValidationSplit">[docs]</a>    <span class="k">def</span> <span class="nf">setValidationSplit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the proportion of training dataset to be validated against the</span>
<span class="sd">        model on each Epoch, by default it is 0.0 and off. The value should be</span>
<span class="sd">        between 0.0 and 1.0.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        v : float</span>
<span class="sd">            Proportion of training dataset to be validated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">validationSplit</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="NerDLApproach.setEvaluationLogExtended"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLApproach.setEvaluationLogExtended">[docs]</a>    <span class="k">def</span> <span class="nf">setEvaluationLogExtended</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets whether logs for validation to be extended, by default False.</span>
<span class="sd">        Displays time and evaluation of each label.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        v : bool</span>
<span class="sd">            Whether logs for validation to be extended</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">evaluationLogExtended</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="NerDLApproach.setTestDataset"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLApproach.setTestDataset">[docs]</a>    <span class="k">def</span> <span class="nf">setTestDataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">read_as</span><span class="o">=</span><span class="n">ReadAs</span><span class="o">.</span><span class="n">SPARK</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;parquet&quot;</span><span class="p">}):</span>
        <span class="sd">&quot;&quot;&quot;Sets Path to test dataset. If set used to calculate statistic on it</span>
<span class="sd">        during training.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            Path to test dataset</span>
<span class="sd">        read_as : str, optional</span>
<span class="sd">            How to read the resource, by default ReadAs.SPARK</span>
<span class="sd">        options : dict, optional</span>
<span class="sd">            Options for reading the resource, by default {&quot;format&quot;: &quot;parquet&quot;}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">testDataset</span><span class="o">=</span><span class="n">ExternalResource</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">read_as</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">copy</span><span class="p">()))</span></div>

<div class="viewcode-block" id="NerDLApproach.setIncludeConfidence"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLApproach.setIncludeConfidence">[docs]</a>    <span class="k">def</span> <span class="nf">setIncludeConfidence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets whether to include confidence scores in annotation metadata, by</span>
<span class="sd">        default False.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : bool</span>
<span class="sd">            Whether to include the confidence value in the output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">includeConfidence</span><span class="o">=</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="NerDLApproach.setIncludeAllConfidenceScores"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLApproach.setIncludeAllConfidenceScores">[docs]</a>    <span class="k">def</span> <span class="nf">setIncludeAllConfidenceScores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets whether to include all confidence scores in annotation metadata</span>
<span class="sd">        or just the score of the predicted tag, by default False.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : bool</span>
<span class="sd">            Whether to include all confidence scores in annotation metadata or</span>
<span class="sd">            just the score of the predicted tag</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">includeAllConfidenceScores</span><span class="o">=</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="NerDLApproach.setEnableOutputLogs"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLApproach.setEnableOutputLogs">[docs]</a>    <span class="k">def</span> <span class="nf">setEnableOutputLogs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets whether to use stdout in addition to Spark logs, by default</span>
<span class="sd">        False.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : bool</span>
<span class="sd">            Whether to use stdout in addition to Spark logs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">enableOutputLogs</span><span class="o">=</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="NerDLApproach.setEnableMemoryOptimizer"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLApproach.setEnableMemoryOptimizer">[docs]</a>    <span class="k">def</span> <span class="nf">setEnableMemoryOptimizer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets Whether to optimize for large datasets or not, by default False.</span>
<span class="sd">        Enabling this option can slow down training.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : bool</span>
<span class="sd">            Whether to optimize for large datasets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">enableMemoryOptimizer</span><span class="o">=</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="NerDLApproach.setOutputLogsPath"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLApproach.setOutputLogsPath">[docs]</a>    <span class="k">def</span> <span class="nf">setOutputLogsPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets folder path to save training logs.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p : str</span>
<span class="sd">            Folder path to save training logs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">outputLogsPath</span><span class="o">=</span><span class="n">p</span><span class="p">)</span></div>

<div class="viewcode-block" id="NerDLApproach.setUseBestModel"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLApproach.setUseBestModel">[docs]</a>    <span class="k">def</span> <span class="nf">setUseBestModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Whether to restore and use the model that has achieved the best performance at the end of the training.</span>
<span class="sd">        The metric that is being monitored is F1 for testDataset and if it&#39;s not set it will be validationSplit, and if it&#39;s not set finally looks for loss.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : bool</span>
<span class="sd">            Whether to restore and use the model that has achieved the best performance at the end of the training.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">useBestModel</span><span class="o">=</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="NerDLApproach.setBestModelMetric"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLApproach.setBestModelMetric">[docs]</a>    <span class="k">def</span> <span class="nf">setBestModelMetric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Whether to check F1 Micro-average or F1 Macro-average as a final metric for the best model when setUseBestModel is True</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : str</span>
<span class="sd">            Whether to check F1 Micro-average or F1 Macro-average as a final metric for the best model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">bestModelMetric</span><span class="o">=</span><span class="n">value</span><span class="p">)</span></div>

    <span class="nd">@keyword_only</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NerDLApproach</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">classname</span><span class="o">=</span><span class="s2">&quot;com.johnsnowlabs.nlp.annotators.ner.dl.NerDLApproach&quot;</span><span class="p">)</span>
        <span class="n">uc</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;win32&#39;</span> <span class="k">else</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setDefault</span><span class="p">(</span>
            <span class="n">minEpochs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">maxEpochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
            <span class="n">lr</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="mf">0.001</span><span class="p">),</span>
            <span class="n">po</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="mf">0.005</span><span class="p">),</span>
            <span class="n">batchSize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">dropout</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span>
            <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">useContrib</span><span class="o">=</span><span class="n">uc</span><span class="p">,</span>
            <span class="n">validationSplit</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span>
            <span class="n">evaluationLogExtended</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">includeConfidence</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">includeAllConfidenceScores</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">enableOutputLogs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">enableMemoryOptimizer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">useBestModel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">bestModelMetric</span><span class="o">=</span><span class="s2">&quot;f1_micro&quot;</span></div>
        <span class="p">)</span>

<div class="viewcode-block" id="NerDLModel"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLModel">[docs]</a><span class="k">class</span> <span class="nc">NerDLModel</span><span class="p">(</span><span class="n">AnnotatorModel</span><span class="p">,</span> <span class="n">HasStorageRef</span><span class="p">,</span> <span class="n">HasBatchedAnnotate</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This Named Entity recognition annotator is a generic NER model based on</span>
<span class="sd">    Neural Networks.</span>

<span class="sd">    Neural Network architecture is Char CNNs - BiLSTM - CRF that achieves</span>
<span class="sd">    state-of-the-art in most datasets.</span>

<span class="sd">    This is the instantiated model of the :class:`.NerDLApproach`. For training</span>
<span class="sd">    your own model, please see the documentation of that class.</span>

<span class="sd">    Pretrained models can be loaded with :meth:`.pretrained` of the companion</span>
<span class="sd">    object:</span>

<span class="sd">    &gt;&gt;&gt; nerModel = NerDLModel.pretrained() \\</span>
<span class="sd">    ...     .setInputCols([&quot;sentence&quot;, &quot;token&quot;, &quot;embeddings&quot;]) \\</span>
<span class="sd">    ...     .setOutputCol(&quot;ner&quot;)</span>


<span class="sd">    The default model is ``&quot;ner_dl&quot;``, if no name is provided.</span>

<span class="sd">    For available pretrained models please see the `Models Hub</span>
<span class="sd">    &lt;https://nlp.johnsnowlabs.com/models?task=Named+Entity+Recognition&gt;`__.</span>
<span class="sd">    Additionally, pretrained pipelines are available for this module, see</span>
<span class="sd">    `Pipelines &lt;https://nlp.johnsnowlabs.com/docs/en/pipelines&gt;`__.</span>

<span class="sd">    Note that some pretrained models require specific types of embeddings,</span>
<span class="sd">    depending on which they were trained on. For example, the default model</span>
<span class="sd">    ``&quot;ner_dl&quot;`` requires the WordEmbeddings ``&quot;glove_100d&quot;``.</span>

<span class="sd">    For extended examples of usage, see the `Spark NLP Workshop</span>
<span class="sd">    &lt;https://github.com/JohnSnowLabs/spark-nlp-workshop/blob/master/tutorials/Certification_Trainings/Public/3.SparkNLP_Pretrained_Models.ipynb&gt;`__.</span>

<span class="sd">    ==================================== ======================</span>
<span class="sd">    Input Annotation types               Output Annotation type</span>
<span class="sd">    ==================================== ======================</span>
<span class="sd">    ``DOCUMENT, TOKEN, WORD_EMBEDDINGS`` ``NAMED_ENTITY``</span>
<span class="sd">    ==================================== ======================</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    batchSize</span>
<span class="sd">        Size of every batch, by default 8</span>
<span class="sd">    configProtoBytes</span>
<span class="sd">        ConfigProto from tensorflow, serialized into byte array.</span>
<span class="sd">    includeConfidence</span>
<span class="sd">        Whether to include confidence scores in annotation metadata, by default</span>
<span class="sd">        False</span>
<span class="sd">    includeAllConfidenceScores</span>
<span class="sd">        Whether to include all confidence scores in annotation metadata or just</span>
<span class="sd">        the score of the predicted tag, by default False</span>
<span class="sd">    classes</span>
<span class="sd">        Tags used to trained this NerDLModel</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import sparknlp</span>
<span class="sd">    &gt;&gt;&gt; from sparknlp.base import *</span>
<span class="sd">    &gt;&gt;&gt; from sparknlp.annotator import *</span>
<span class="sd">    &gt;&gt;&gt; from pyspark.ml import Pipeline</span>

<span class="sd">    First extract the prerequisites for the NerDLModel</span>

<span class="sd">    &gt;&gt;&gt; documentAssembler = DocumentAssembler() \\</span>
<span class="sd">    ...     .setInputCol(&quot;text&quot;) \\</span>
<span class="sd">    ...     .setOutputCol(&quot;document&quot;)</span>
<span class="sd">    &gt;&gt;&gt; sentence = SentenceDetector() \\</span>
<span class="sd">    ...     .setInputCols([&quot;document&quot;]) \\</span>
<span class="sd">    ...     .setOutputCol(&quot;sentence&quot;)</span>
<span class="sd">    &gt;&gt;&gt; tokenizer = Tokenizer() \\</span>
<span class="sd">    ...     .setInputCols([&quot;sentence&quot;]) \\</span>
<span class="sd">    ...     .setOutputCol(&quot;token&quot;)</span>
<span class="sd">    &gt;&gt;&gt; embeddings = WordEmbeddingsModel.pretrained() \\</span>
<span class="sd">    ...     .setInputCols([&quot;sentence&quot;, &quot;token&quot;]) \\</span>
<span class="sd">    ...     .setOutputCol(&quot;bert&quot;)</span>

<span class="sd">    Then NER can be extracted</span>

<span class="sd">    &gt;&gt;&gt; nerTagger = NerDLModel.pretrained() \\</span>
<span class="sd">    ...     .setInputCols([&quot;sentence&quot;, &quot;token&quot;, &quot;bert&quot;]) \\</span>
<span class="sd">    ...     .setOutputCol(&quot;ner&quot;)</span>
<span class="sd">    &gt;&gt;&gt; pipeline = Pipeline().setStages([</span>
<span class="sd">    ...     documentAssembler,</span>
<span class="sd">    ...     sentence,</span>
<span class="sd">    ...     tokenizer,</span>
<span class="sd">    ...     embeddings,</span>
<span class="sd">    ...     nerTagger</span>
<span class="sd">    ... ])</span>
<span class="sd">    &gt;&gt;&gt; data = spark.createDataFrame([[&quot;U.N. official Ekeus heads for Baghdad.&quot;]]).toDF(&quot;text&quot;)</span>
<span class="sd">    &gt;&gt;&gt; result = pipeline.fit(data).transform(data)</span>
<span class="sd">    &gt;&gt;&gt; result.select(&quot;ner.result&quot;).show(truncate=False)</span>
<span class="sd">    +------------------------------------+</span>
<span class="sd">    |result                              |</span>
<span class="sd">    +------------------------------------+</span>
<span class="sd">    |[B-ORG, O, O, B-PER, O, O, B-LOC, O]|</span>
<span class="sd">    +------------------------------------+</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    NerCrfModel : for a generic CRF approach</span>
<span class="sd">    NerConverter : to further process the results</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;NerDLModel&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s2">&quot;com.johnsnowlabs.nlp.annotators.ner.dl.NerDLModel&quot;</span><span class="p">,</span> <span class="n">java_model</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NerDLModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">classname</span><span class="o">=</span><span class="n">classname</span><span class="p">,</span>
            <span class="n">java_model</span><span class="o">=</span><span class="n">java_model</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setDefault</span><span class="p">(</span>
            <span class="n">includeConfidence</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">includeAllConfidenceScores</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">batchSize</span><span class="o">=</span><span class="mi">8</span>
        <span class="p">)</span>

    <span class="n">configProtoBytes</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;configProtoBytes&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;ConfigProto from tensorflow, serialized into byte array. Get with config_proto.SerializeToString()&quot;</span><span class="p">,</span>
                             <span class="n">TypeConverters</span><span class="o">.</span><span class="n">toListInt</span><span class="p">)</span>
    <span class="n">includeConfidence</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;includeConfidence&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;whether to include confidence scores in annotation metadata&quot;</span><span class="p">,</span>
                              <span class="n">TypeConverters</span><span class="o">.</span><span class="n">toBoolean</span><span class="p">)</span>
    <span class="n">includeAllConfidenceScores</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;includeAllConfidenceScores&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;whether to include all confidence scores in annotation metadata or just the score of the predicted tag&quot;</span><span class="p">,</span>
                                       <span class="n">TypeConverters</span><span class="o">.</span><span class="n">toBoolean</span><span class="p">)</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">Params</span><span class="o">.</span><span class="n">_dummy</span><span class="p">(),</span> <span class="s2">&quot;classes&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;get the tags used to trained this NerDLModel&quot;</span><span class="p">,</span>
                    <span class="n">TypeConverters</span><span class="o">.</span><span class="n">toListString</span><span class="p">)</span>

<div class="viewcode-block" id="NerDLModel.setConfigProtoBytes"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLModel.setConfigProtoBytes">[docs]</a>    <span class="k">def</span> <span class="nf">setConfigProtoBytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets configProto from tensorflow, serialized into byte array.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        b : List[int]</span>
<span class="sd">            ConfigProto from tensorflow, serialized into byte array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">configProtoBytes</span><span class="o">=</span><span class="n">b</span><span class="p">)</span></div>

<div class="viewcode-block" id="NerDLModel.setIncludeConfidence"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLModel.setIncludeConfidence">[docs]</a>    <span class="k">def</span> <span class="nf">setIncludeConfidence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets whether to include confidence scores in annotation metadata, by</span>
<span class="sd">        default False.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : bool</span>
<span class="sd">            Whether to include the confidence value in the output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">includeConfidence</span><span class="o">=</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="NerDLModel.setIncludeAllConfidenceScores"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLModel.setIncludeAllConfidenceScores">[docs]</a>    <span class="k">def</span> <span class="nf">setIncludeAllConfidenceScores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets whether to include all confidence scores in annotation metadata</span>
<span class="sd">        or just the score of the predicted tag, by default False.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : bool</span>
<span class="sd">            Whether to include all confidence scores in annotation metadata or</span>
<span class="sd">            just the score of the predicted tag</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">includeAllConfidenceScores</span><span class="o">=</span><span class="n">value</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="NerDLModel.pretrained"><a class="viewcode-back" href="../../../../reference/autosummary/sparknlp/annotator/ner/ner_dl/index.html#sparknlp.annotator.ner.ner_dl.NerDLModel.pretrained">[docs]</a>    <span class="k">def</span> <span class="nf">pretrained</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;ner_dl&quot;</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="n">remote_loc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Downloads and loads a pretrained model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            Name of the pretrained model, by default &quot;ner_dl&quot;</span>
<span class="sd">        lang : str, optional</span>
<span class="sd">            Language of the pretrained model, by default &quot;en&quot;</span>
<span class="sd">        remote_loc : str, optional</span>
<span class="sd">            Optional remote address of the resource, by default None. Will use</span>
<span class="sd">            Spark NLPs repositories otherwise.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        NerDLModel</span>
<span class="sd">            The restored model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">sparknlp.pretrained</span> <span class="kn">import</span> <span class="n">ResourceDownloader</span>
        <span class="k">return</span> <span class="n">ResourceDownloader</span><span class="o">.</span><span class="n">downloadModel</span><span class="p">(</span><span class="n">NerDLModel</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">lang</span><span class="p">,</span> <span class="n">remote_loc</span><span class="p">)</span></div></div>

</pre></div>

              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2022, John Snow Labs.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.1.1.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>