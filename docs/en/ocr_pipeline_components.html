<!DOCTYPE html><html lang="en">
  <head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-59JLR64');</script>
<!-- End Google Tag Manager --><title>Spark OCR | John Snow Labs</title><meta name="description" content="High Performance NLP with Apache Spark
">
<link rel="canonical" href="/docs/en/ocr_pipeline_components"><link rel="alternate" type="application/rss+xml" title="Spark NLP" href="/feed.xml"><!-- start favicons snippet, use https://realfavicongenerator.net/ -->
<!---->
<!-- <link rel="apple-touch-icon" sizes="180x180" href="/fav.ico"> -->

<!---->
<!-- <link rel="icon" type="image/png" sizes="32x32" href="/fav.ico"> -->

<!---->
<!-- <link rel="icon" type="image/png" sizes="16x16" href="/fav.ico"> -->

<!---->
<!-- <link rel="manifest" href="/fav.ico"> --><link rel="mask-icon" href="/fav.ico" color="#fc4d50"><link rel="shortcut icon" href="/fav.ico">

<meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/browserconfig.xml">

<meta name="theme-color" content="#ffffff">
<!-- end favicons snippet --><link rel="stylesheet" href="/assets/css/main.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" ><!-- start custom head snippets -->
 <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"> 
 <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<!-- end custom head snippets -->
<script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.decodeUrl = function(str) {
    return str ? decodeURIComponent(str.replace(/\+/g, '%20')) : '';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
</script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.4',
      sources: {
        font_awesome: 'https://use.fontawesome.com/releases/v5.0.13/css/all.css',
        jquery: 'https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js',
        leancloud_js_sdk: '//cdn1.lncld.net/static/js/3.4.1/av-min.js',
        chart: 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js',
        gitalk: {
          js: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.js',
          css: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3'
        }
      },
      paths: {
        search_js: '/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script></head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page layout--page--sidebar clearfix js-page-root&nbsp; layout--page--aside">
  <div class="page__mask d-print-none js-page-mask js-sidebar-hide"></div>
  <div class="page__viewport">
    <div class="page__actions d-print-none">
      <div class="js-sidebar-show">
        <i class="fas fa-bars icon--show"></i>
      </div>
    </div>

    <div class="grid page__grid">

      <div class="page__sidebar d-print-none"><a title="High Performance NLP with Apache Spark
" href="/">
    <!--<svg width="187" height="50" viewBox="0 0 187 50" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M38.6212 18.6877H42.3588V29.0697C42.3588 33.7209 40.1163 35.382 36.5448 35.382C35.7143 35.382 34.5515 35.2159 33.804 34.9668L34.2192 31.9767C34.7176 32.1428 35.382 32.3089 36.1295 32.3089C37.7076 32.3089 38.6212 31.6445 38.6212 29.0697V18.6877Z" fill="#3E4095"/>
<path d="M55.2325 28.9867C55.2325 33.3056 52.1594 35.299 48.9202 35.299C45.4319 35.299 42.774 32.9734 42.774 29.1528C42.774 25.3322 45.2657 22.8405 49.0863 22.8405C52.7408 22.8405 55.2325 25.4153 55.2325 28.9867ZM46.5946 29.0698C46.5946 31.1462 47.4252 32.6412 49.0033 32.6412C50.4152 32.6412 51.3289 31.2292 51.3289 29.0698C51.3289 27.3256 50.6644 25.4983 49.0033 25.4983C47.2591 25.4983 46.5946 27.3256 46.5946 29.0698Z" fill="#3E4095"/>
<path d="M55.6478 17.774H59.3854V24.5847H59.4684C59.8837 24.0863 60.382 23.6711 60.9634 23.3388C61.4618 23.0066 62.2093 22.8405 62.8737 22.8405C65.1993 22.8405 67.0266 24.5016 67.0266 28.0731V35.0498H63.289V28.4883C63.289 26.9103 62.7907 25.8305 61.3787 25.8305C60.382 25.8305 59.8006 26.495 59.5515 27.1594C59.4684 27.4086 59.4684 27.7408 59.4684 27.99V35.0498H55.6478V17.774Z" fill="#3E4095"/>
<path d="M68.1064 26.9103C68.1064 25.4153 68.0233 24.1694 68.0233 23.0897H71.2625L71.4286 24.7508C71.927 24.0033 73.0898 22.8405 75.0831 22.8405C77.4917 22.8405 79.319 24.4186 79.319 27.907V34.9668H75.5814V28.4053C75.5814 26.9103 75.0831 25.8305 73.6711 25.8305C72.6745 25.8305 72.01 26.495 71.7609 27.2425C71.6778 27.4917 71.5947 27.8239 71.5947 28.1561V35.0498H68.1064V26.9103Z" fill="#3E4095"/>
<path d="M83.887 31.2292C84.8836 31.7275 86.3787 32.2259 87.9567 32.2259C89.6179 32.2259 90.5315 31.5614 90.5315 30.4817C90.5315 29.485 89.784 28.9036 87.7906 28.1561C85.0497 27.2425 83.3056 25.6644 83.3056 23.3388C83.3056 20.5149 85.6311 18.4385 89.5348 18.4385C91.362 18.4385 92.774 18.8538 93.6876 19.269L92.8571 22.2591C92.1926 21.9268 91.0298 21.5116 89.4517 21.5116C87.8737 21.5116 87.0431 22.2591 87.0431 23.0896C87.0431 24.1694 87.9567 24.5847 90.1162 25.4152C93.0232 26.495 94.3521 27.99 94.3521 30.3156C94.3521 33.0564 92.2757 35.382 87.7076 35.382C85.7973 35.382 83.97 34.8837 83.0564 34.3853L83.887 31.2292Z" fill="#3E4095"/>
<path d="M94.9336 26.9103C94.9336 25.4153 94.8505 24.1694 94.8505 23.0897H98.0897L98.2558 24.7508H98.3389C98.8372 24.0033 100 22.8405 101.993 22.8405C104.402 22.8405 106.229 24.4186 106.229 27.907V34.9668H102.492V28.4053C102.492 26.9103 101.993 25.8305 100.581 25.8305C99.5847 25.8305 98.9203 26.495 98.6711 27.2425C98.5881 27.4917 98.505 27.8239 98.505 28.1561V35.0498H94.7675V26.9103H94.9336Z" fill="#3E4095"/>
<path d="M119.103 28.9867C119.103 33.3056 116.03 35.299 112.791 35.299C109.302 35.299 106.645 32.9734 106.645 29.1528C106.645 25.3322 109.136 22.8405 112.957 22.8405C116.694 22.8405 119.103 25.4153 119.103 28.9867ZM110.465 29.0698C110.465 31.1462 111.296 32.6412 112.874 32.6412C114.286 32.6412 115.199 31.2292 115.199 29.0698C115.199 27.3256 114.535 25.4983 112.874 25.4983C111.13 25.4983 110.465 27.3256 110.465 29.0698Z" fill="#3E4095"/>
<path d="M121.927 23.1727L122.841 28.0731C123.09 29.3189 123.339 30.6478 123.505 31.9767H123.588C123.837 30.6478 124.17 29.2359 124.502 28.0731L125.748 23.1727H128.655L129.817 27.9069C130.15 29.2359 130.482 30.5648 130.731 31.9767H130.814C130.98 30.6478 131.229 29.2359 131.478 27.9069L132.475 23.1727H136.13L132.475 35.0498H128.987L127.907 30.897C127.575 29.7342 127.409 28.6545 127.16 27.1594H127.076C126.827 28.6545 126.578 29.7342 126.329 30.897L125.166 35.0498H121.678L118.189 23.1727H121.927Z" fill="#3E4095"/>
<path d="M143.023 18.9369H145.1V32.8073H152.575V34.5515H143.023V18.9369Z" fill="#0098DA"/>
<path d="M155.399 29.5681L153.571 34.5515H151.329L157.226 18.9369H159.801L165.781 34.5515H163.455L161.545 29.5681H155.399ZM161.213 27.99L159.468 23.3389C159.136 22.3422 158.804 21.5116 158.555 20.6811H158.472C158.223 21.5116 157.973 22.3422 157.641 23.2558L155.897 27.99H161.213Z" fill="#0098DA"/>
<path d="M165.864 19.186C166.777 19.0199 168.355 18.8538 169.933 18.8538C172.176 18.8538 173.505 19.186 174.502 20.0166C175.332 20.6811 175.914 21.5947 175.914 22.8405C175.914 24.3355 174.834 25.6644 173.173 26.2458V26.3289C174.502 26.6611 176.495 27.8239 176.495 30.2326C176.495 31.5615 175.914 32.6412 175.083 33.3887C173.92 34.3854 172.093 34.8837 169.269 34.8837C167.774 34.8837 166.611 34.8007 165.864 34.7176V19.186ZM168.023 25.5814H170.183C172.508 25.5814 173.754 24.5017 173.754 23.0066C173.754 21.0963 172.176 20.4319 170.1 20.4319C169.02 20.4319 168.355 20.5149 168.023 20.598V25.5814ZM168.023 32.9734C168.521 33.0565 169.103 33.0565 169.933 33.0565C172.093 33.0565 174.252 32.392 174.252 29.9834C174.252 27.8239 172.342 26.9934 169.933 26.9934H167.94V32.9734H168.023Z" fill="#0098DA"/>
<path d="M176.91 31.9768C177.907 32.6412 179.402 33.1396 180.98 33.1396C183.223 33.1396 184.468 32.0598 184.468 30.4818C184.468 28.9867 183.638 28.1562 181.229 27.4087C178.239 26.495 176.661 25.1661 176.661 22.9236C176.661 20.4319 178.821 18.6047 182.06 18.6047C183.887 18.6047 185.133 19.02 185.963 19.4352L185.382 21.0964C184.884 20.7641 183.638 20.2658 182.06 20.2658C179.734 20.2658 178.821 21.5947 178.821 22.5914C178.821 24.0033 179.817 24.7509 182.226 25.4984C185.133 26.412 186.628 27.6578 186.628 30.1495C186.628 32.4751 184.884 34.7176 180.814 34.7176C179.153 34.7176 177.325 34.2193 176.412 33.6379L176.91 31.9768Z" fill="#0098DA"/>
<path d="M22.5083 35.6312C22.5083 40.1163 18.8538 43.7708 14.3688 43.7708C9.88372 43.7708 6.22924 40.1163 6.22924 35.6312V12.2093L0 11.4618V35.6312C0 43.6047 6.4784 50 14.3688 50C22.2591 50 28.7375 43.5216 28.7375 35.6312V11.4618L22.5083 12.2093V35.6312Z" fill="#0098DA"/>
<path d="M16.1129 17.7741H8.63786C8.13952 17.7741 7.72424 17.3588 7.72424 16.8604V9.38536C7.72424 8.88702 8.13952 8.47174 8.63786 8.47174H16.1129C16.6113 8.47174 17.0266 8.88702 17.0266 9.38536V16.8604C17.0266 17.3588 16.6113 17.7741 16.1129 17.7741Z" fill="#3E4095"/>
<path d="M20.515 22.7575H15.2824C14.7841 22.7575 14.3688 22.3422 14.3688 21.8439V16.6113C14.3688 16.113 14.7841 15.6977 15.2824 15.6977H20.515C21.0133 15.6977 21.4286 16.113 21.4286 16.6113V21.8439C21.4286 22.4253 21.0133 22.7575 20.515 22.7575Z" fill="#3E4095"/>
<path d="M19.8505 9.71762H16.113C15.6146 9.71762 15.1993 9.30233 15.1993 8.80399V5.06645C15.1993 4.56811 15.6146 4.15283 16.113 4.15283H19.8505C20.3488 4.15283 20.7641 4.56811 20.7641 5.06645V8.80399C20.6811 9.30233 20.3488 9.71762 19.8505 9.71762Z" fill="#3E4095"/>
<path d="M13.6213 3.48837H11.8771C11.3788 3.48837 10.9635 3.07309 10.9635 2.57475V0.913621C10.9635 0.415282 11.3788 0 11.8771 0H13.6213C14.1196 0 14.5349 0.415282 14.5349 0.913621V2.65781C14.5349 3.15615 14.1196 3.48837 13.6213 3.48837Z" fill="#3E4095"/>
<path d="M20.2658 41.196H8.38867V41.3622H20.2658V41.196Z" fill="#ECF9FF"/>
<path d="M20.2658 40.9469H8.38867V41.113H20.2658V40.9469Z" fill="#EBF9FF"/>
<path d="M20.2658 40.7808H8.38867V40.9469H20.2658V40.7808Z" fill="#EAF8FF"/>
<path d="M20.2658 40.6146H8.38867V40.7807H20.2658V40.6146Z" fill="#E9F8FF"/>
<path d="M20.2658 40.3655H8.38867V40.5316H20.2658V40.3655Z" fill="#E8F8FF"/>
<path d="M20.2658 40.1993H8.38867V40.3655H20.2658V40.1993Z" fill="#E7F7FF"/>
<path d="M20.2658 40.0333H8.38867V40.1994H20.2658V40.0333Z" fill="#E6F7FF"/>
<path d="M20.2658 39.8671H8.38867V40.0332H20.2658V39.8671Z" fill="#E5F7FF"/>
<path d="M20.2658 39.618H8.38867V39.7841H20.2658V39.618Z" fill="#E4F6FE"/>
<path d="M20.2658 39.4518H8.38867V39.618H20.2658V39.4518Z" fill="#E3F6FE"/>
<path d="M20.2658 39.2858H8.38867V39.4519H20.2658V39.2858Z" fill="#E2F5FE"/>
<path d="M20.2658 39.0366H8.38867V39.2027H20.2658V39.0366Z" fill="#E1F5FE"/>
<path d="M20.2658 38.8705H8.38867V39.0366H20.2658V38.8705Z" fill="#E0F5FE"/>
<path d="M20.2658 38.7043H8.38867V38.8705H20.2658V38.7043Z" fill="#DFF4FE"/>
<path d="M20.2658 38.4552H8.38867V38.6213H20.2658V38.4552Z" fill="#DEF4FE"/>
<path d="M20.2658 38.2891H8.38867V38.4552H20.2658V38.2891Z" fill="#DDF4FE"/>
<path d="M20.2658 38.1229H8.38867V38.289H20.2658V38.1229Z" fill="#DCF3FE"/>
<path d="M20.2658 37.8738H8.38867V38.0399H20.2658V37.8738Z" fill="#DBF3FE"/>
<path d="M20.2658 37.7077H8.38867V37.8738H20.2658V37.7077Z" fill="#DAF3FE"/>
<path d="M20.2658 37.5416H8.38867V37.7077H20.2658V37.5416Z" fill="#D9F2FE"/>
<path d="M20.2658 37.3754H8.38867V37.5415H20.2658V37.3754Z" fill="#D8F2FE"/>
<path d="M20.2658 37.1263H8.38867V37.2924H20.2658V37.1263Z" fill="#D7F2FE"/>
<path d="M20.2658 36.9601H8.38867V37.1263H20.2658V36.9601Z" fill="#D6F1FE"/>
<path d="M20.2658 36.7941H8.38867V36.9602H20.2658V36.7941Z" fill="#D5F1FE"/>
<path d="M20.2658 36.5449H8.38867V36.711H20.2658V36.5449Z" fill="#D4F1FD"/>
<path d="M20.2658 36.3788H8.38867V36.5449H20.2658V36.3788Z" fill="#D3F0FD"/>
<path d="M20.2658 36.2126H8.38867V36.3788H20.2658V36.2126Z" fill="#D2F0FD"/>
<path d="M20.2658 35.9635H8.38867V36.1296H20.2658V35.9635Z" fill="#D1F0FD"/>
<path d="M20.2658 35.7974H8.38867V35.9635H20.2658V35.7974Z" fill="#D0EFFD"/>
<path d="M20.2658 35.6313H8.38867V35.7974H20.2658V35.6313Z" fill="#CFEFFD"/>
<path d="M20.2658 35.3821H8.38867V35.5482H20.2658V35.3821Z" fill="#CEEEFD"/>
<path d="M20.2658 35.216H8.38867V35.3821H20.2658V35.216Z" fill="#CDEEFD"/>
<path d="M20.2658 35.0499H8.38867V35.216H20.2658V35.0499Z" fill="#CCEEFD"/>
<path d="M20.2658 34.8837H8.38867V35.0498H20.2658V34.8837Z" fill="#CBEDFD"/>
<path d="M20.2658 34.6346H8.38867V34.8007H20.2658V34.6346Z" fill="#CAEDFD"/>
<path d="M20.2658 34.4684H8.38867V34.6346H20.2658V34.4684Z" fill="#C9EDFD"/>
<path d="M20.2658 34.3024H8.38867V34.4685H20.2658V34.3024Z" fill="#C8ECFD"/>
<path d="M20.2658 34.0532H8.38867V34.2193H20.2658V34.0532Z" fill="#C7ECFD"/>
<path d="M20.2658 33.8871H8.38867V34.0532H20.2658V33.8871Z" fill="#C6ECFD"/>
<path d="M20.2658 33.7209H8.38867V33.8871H20.2658V33.7209Z" fill="#C4EBFC"/>
<path d="M20.2658 33.4718H8.38867V33.6379H20.2658V33.4718Z" fill="#C3EBFC"/>
<path d="M20.2658 33.3057H8.38867V33.4718H20.2658V33.3057Z" fill="#C2EBFC"/>
<path d="M20.2658 33.1396H8.38867V33.3057H20.2658V33.1396Z" fill="#C1EAFC"/>
<path d="M20.2658 32.8904H8.38867V33.0565H20.2658V32.8904Z" fill="#C0EAFC"/>
<path d="M20.2658 32.7242H8.38867V32.8904H20.2658V32.7242Z" fill="#BFEAFC"/>
<path d="M20.2658 32.5582H8.38867V32.7243H20.2658V32.5582Z" fill="#BEE9FC"/>
<path d="M20.2658 32.392H8.38867V32.5581H20.2658V32.392Z" fill="#BDE9FC"/>
<path d="M20.2658 32.1429H8.38867V32.309H20.2658V32.1429Z" fill="#BCE9FC"/>
<path d="M20.2658 31.9768H8.38867V32.1429H20.2658V31.9768Z" fill="#BBE8FC"/>
<path d="M20.2658 31.8107H8.38867V31.9768H20.2658V31.8107Z" fill="#BAE8FC"/>
<path d="M20.2658 31.5615H8.38867V31.7276H20.2658V31.5615Z" fill="#B9E7FC"/>
<path d="M20.2658 31.3954H8.38867V31.5615H20.2658V31.3954Z" fill="#B8E7FC"/>
<path d="M20.2658 31.2292H8.38867V31.3954H20.2658V31.2292Z" fill="#B7E7FC"/>
<path d="M20.2658 30.9801H8.38867V31.1462H20.2658V30.9801Z" fill="#B6E6FC"/>
<path d="M20.2658 30.814H8.38867V30.9801H20.2658V30.814Z" fill="#B5E6FB"/>
<path d="M20.2658 30.6479H8.38867V30.814H20.2658V30.6479Z" fill="#B4E6FB"/>
<path d="M20.2658 30.3987H8.38867V30.5648H20.2658V30.3987Z" fill="#B3E5FB"/>
<path d="M20.2658 30.2326H8.38867V30.3987H20.2658V30.2326Z" fill="#B2E5FB"/>
<path d="M20.2658 30.0665H8.38867V30.2326H20.2658V30.0665Z" fill="#B1E5FB"/>
<path d="M20.2658 29.9004H8.38867V30.0665H20.2658V29.9004Z" fill="#B0E4FB"/>
<path d="M20.2658 29.6512H8.38867V29.8173H20.2658V29.6512Z" fill="#AFE4FB"/>
<path d="M20.2658 29.4851H8.38867V29.6512H20.2658V29.4851Z" fill="#AEE4FB"/>
<path d="M20.2658 29.319H8.38867V29.4851H20.2658V29.319Z" fill="#ADE3FB"/>
<path d="M20.2658 29.0698H8.38867V29.2359H20.2658V29.0698Z" fill="#ACE3FB"/>
<path d="M20.2658 28.9037H8.38867V29.0698H20.2658V28.9037Z" fill="#ABE3FB"/>
<path d="M20.2658 28.7375H8.38867V28.9037H20.2658V28.7375Z" fill="#AAE2FB"/>
<path d="M20.2658 28.4884H8.38867V28.6545H20.2658V28.4884Z" fill="#A9E2FB"/>
<path d="M20.2658 28.3223H8.38867V28.4884H20.2658V28.3223Z" fill="#A8E2FB"/>
<path d="M20.2658 28.1562H8.38867V28.3223H20.2658V28.1562Z" fill="#A7E1FB"/>
<path d="M20.2658 27.907H8.38867V28.0731H20.2658V27.907Z" fill="#A6E1FB"/>
<path d="M20.2658 27.7409H8.38867V27.907H20.2658V27.7409Z" fill="#A5E0FA"/>
<path d="M20.2658 27.5748H8.38867V27.7409H20.2658V27.5748Z" fill="#A4E0FA"/>
<path d="M20.2658 27.4087H8.38867V27.5748H20.2658V27.4087Z" fill="#A3E0FA"/>
<path d="M20.2658 27.1595H8.38867V27.3256H20.2658V27.1595Z" fill="#A2DFFA"/>
<path d="M20.2658 26.9934H8.38867V27.1595H20.2658V26.9934Z" fill="#A1DFFA"/>
<path d="M20.2658 26.8273H8.38867V26.9934H20.2658V26.8273Z" fill="#A0DFFA"/>
<path d="M20.2658 26.5781H8.38867V26.7442H20.2658V26.5781Z" fill="#9FDEFA"/>
<path d="M20.2658 26.412H8.38867V26.5781H20.2658V26.412Z" fill="#9EDEFA"/>
</svg>
-->
</a><div class="sidebar-toc"><ul class="toc toc--navigator"><li class="toc-h1">Spark OCR</li><li class="toc-h2"><a href="/docs/en/ocr">Getting Started</a></li><li class="toc-h2"><a href="/docs/en/ocr_install">Installation</a></li><li class="toc-h2"><a href="/docs/en/version_compatibility">Version Compatibility</a></li><li class="toc-h2 active"><a href="/docs/en/ocr_pipeline_components">Pipeline components</a></li><li class="toc-h2"><a href="/docs/en/ocr_table_recognition">Table recognition</a></li><li class="toc-h2"><a href="/docs/en/ocr_visual_document_understanding">Visual document understanding</a></li><li class="toc-h2"><a href="/docs/en/ocr_object_detection">Object detection</a></li><li class="toc-h2"><a href="/docs/en/ocr_structures">Structures and helpers</a></li><li class="toc-h2"><a href="/docs/en/ocr_release_notes">Release notes</a></li></ul></div></div><div class="page__main js-page-main has-aside cell cell--auto">

      <div class="page__main-inner"><div class="page__header d-print-none"><!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-59JLR64"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) --><header class="header"><div class="main">
      <div class="header__title">
        <a class="responsive_btn" href="#" id="responsive_menu">          
        <i class="fas fa-bars"></i>
        <i class="fas fa-times"></i>
        </a>
        <div class="header__brand">
          <a title="High Performance NLP with Apache Spark
" href="https://www.johnsnowlabs.com" target="_blank"><svg width="187" height="50" viewBox="0 0 187 50" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M38.6212 18.6877H42.3588V29.0697C42.3588 33.7209 40.1163 35.382 36.5448 35.382C35.7143 35.382 34.5515 35.2159 33.804 34.9668L34.2192 31.9767C34.7176 32.1428 35.382 32.3089 36.1295 32.3089C37.7076 32.3089 38.6212 31.6445 38.6212 29.0697V18.6877Z" fill="#3E4095"/>
<path d="M55.2325 28.9867C55.2325 33.3056 52.1594 35.299 48.9202 35.299C45.4319 35.299 42.774 32.9734 42.774 29.1528C42.774 25.3322 45.2657 22.8405 49.0863 22.8405C52.7408 22.8405 55.2325 25.4153 55.2325 28.9867ZM46.5946 29.0698C46.5946 31.1462 47.4252 32.6412 49.0033 32.6412C50.4152 32.6412 51.3289 31.2292 51.3289 29.0698C51.3289 27.3256 50.6644 25.4983 49.0033 25.4983C47.2591 25.4983 46.5946 27.3256 46.5946 29.0698Z" fill="#3E4095"/>
<path d="M55.6478 17.774H59.3854V24.5847H59.4684C59.8837 24.0863 60.382 23.6711 60.9634 23.3388C61.4618 23.0066 62.2093 22.8405 62.8737 22.8405C65.1993 22.8405 67.0266 24.5016 67.0266 28.0731V35.0498H63.289V28.4883C63.289 26.9103 62.7907 25.8305 61.3787 25.8305C60.382 25.8305 59.8006 26.495 59.5515 27.1594C59.4684 27.4086 59.4684 27.7408 59.4684 27.99V35.0498H55.6478V17.774Z" fill="#3E4095"/>
<path d="M68.1064 26.9103C68.1064 25.4153 68.0233 24.1694 68.0233 23.0897H71.2625L71.4286 24.7508C71.927 24.0033 73.0898 22.8405 75.0831 22.8405C77.4917 22.8405 79.319 24.4186 79.319 27.907V34.9668H75.5814V28.4053C75.5814 26.9103 75.0831 25.8305 73.6711 25.8305C72.6745 25.8305 72.01 26.495 71.7609 27.2425C71.6778 27.4917 71.5947 27.8239 71.5947 28.1561V35.0498H68.1064V26.9103Z" fill="#3E4095"/>
<path d="M83.887 31.2292C84.8836 31.7275 86.3787 32.2259 87.9567 32.2259C89.6179 32.2259 90.5315 31.5614 90.5315 30.4817C90.5315 29.485 89.784 28.9036 87.7906 28.1561C85.0497 27.2425 83.3056 25.6644 83.3056 23.3388C83.3056 20.5149 85.6311 18.4385 89.5348 18.4385C91.362 18.4385 92.774 18.8538 93.6876 19.269L92.8571 22.2591C92.1926 21.9268 91.0298 21.5116 89.4517 21.5116C87.8737 21.5116 87.0431 22.2591 87.0431 23.0896C87.0431 24.1694 87.9567 24.5847 90.1162 25.4152C93.0232 26.495 94.3521 27.99 94.3521 30.3156C94.3521 33.0564 92.2757 35.382 87.7076 35.382C85.7973 35.382 83.97 34.8837 83.0564 34.3853L83.887 31.2292Z" fill="#3E4095"/>
<path d="M94.9336 26.9103C94.9336 25.4153 94.8505 24.1694 94.8505 23.0897H98.0897L98.2558 24.7508H98.3389C98.8372 24.0033 100 22.8405 101.993 22.8405C104.402 22.8405 106.229 24.4186 106.229 27.907V34.9668H102.492V28.4053C102.492 26.9103 101.993 25.8305 100.581 25.8305C99.5847 25.8305 98.9203 26.495 98.6711 27.2425C98.5881 27.4917 98.505 27.8239 98.505 28.1561V35.0498H94.7675V26.9103H94.9336Z" fill="#3E4095"/>
<path d="M119.103 28.9867C119.103 33.3056 116.03 35.299 112.791 35.299C109.302 35.299 106.645 32.9734 106.645 29.1528C106.645 25.3322 109.136 22.8405 112.957 22.8405C116.694 22.8405 119.103 25.4153 119.103 28.9867ZM110.465 29.0698C110.465 31.1462 111.296 32.6412 112.874 32.6412C114.286 32.6412 115.199 31.2292 115.199 29.0698C115.199 27.3256 114.535 25.4983 112.874 25.4983C111.13 25.4983 110.465 27.3256 110.465 29.0698Z" fill="#3E4095"/>
<path d="M121.927 23.1727L122.841 28.0731C123.09 29.3189 123.339 30.6478 123.505 31.9767H123.588C123.837 30.6478 124.17 29.2359 124.502 28.0731L125.748 23.1727H128.655L129.817 27.9069C130.15 29.2359 130.482 30.5648 130.731 31.9767H130.814C130.98 30.6478 131.229 29.2359 131.478 27.9069L132.475 23.1727H136.13L132.475 35.0498H128.987L127.907 30.897C127.575 29.7342 127.409 28.6545 127.16 27.1594H127.076C126.827 28.6545 126.578 29.7342 126.329 30.897L125.166 35.0498H121.678L118.189 23.1727H121.927Z" fill="#3E4095"/>
<path d="M143.023 18.9369H145.1V32.8073H152.575V34.5515H143.023V18.9369Z" fill="#0098DA"/>
<path d="M155.399 29.5681L153.571 34.5515H151.329L157.226 18.9369H159.801L165.781 34.5515H163.455L161.545 29.5681H155.399ZM161.213 27.99L159.468 23.3389C159.136 22.3422 158.804 21.5116 158.555 20.6811H158.472C158.223 21.5116 157.973 22.3422 157.641 23.2558L155.897 27.99H161.213Z" fill="#0098DA"/>
<path d="M165.864 19.186C166.777 19.0199 168.355 18.8538 169.933 18.8538C172.176 18.8538 173.505 19.186 174.502 20.0166C175.332 20.6811 175.914 21.5947 175.914 22.8405C175.914 24.3355 174.834 25.6644 173.173 26.2458V26.3289C174.502 26.6611 176.495 27.8239 176.495 30.2326C176.495 31.5615 175.914 32.6412 175.083 33.3887C173.92 34.3854 172.093 34.8837 169.269 34.8837C167.774 34.8837 166.611 34.8007 165.864 34.7176V19.186ZM168.023 25.5814H170.183C172.508 25.5814 173.754 24.5017 173.754 23.0066C173.754 21.0963 172.176 20.4319 170.1 20.4319C169.02 20.4319 168.355 20.5149 168.023 20.598V25.5814ZM168.023 32.9734C168.521 33.0565 169.103 33.0565 169.933 33.0565C172.093 33.0565 174.252 32.392 174.252 29.9834C174.252 27.8239 172.342 26.9934 169.933 26.9934H167.94V32.9734H168.023Z" fill="#0098DA"/>
<path d="M176.91 31.9768C177.907 32.6412 179.402 33.1396 180.98 33.1396C183.223 33.1396 184.468 32.0598 184.468 30.4818C184.468 28.9867 183.638 28.1562 181.229 27.4087C178.239 26.495 176.661 25.1661 176.661 22.9236C176.661 20.4319 178.821 18.6047 182.06 18.6047C183.887 18.6047 185.133 19.02 185.963 19.4352L185.382 21.0964C184.884 20.7641 183.638 20.2658 182.06 20.2658C179.734 20.2658 178.821 21.5947 178.821 22.5914C178.821 24.0033 179.817 24.7509 182.226 25.4984C185.133 26.412 186.628 27.6578 186.628 30.1495C186.628 32.4751 184.884 34.7176 180.814 34.7176C179.153 34.7176 177.325 34.2193 176.412 33.6379L176.91 31.9768Z" fill="#0098DA"/>
<path d="M22.5083 35.6312C22.5083 40.1163 18.8538 43.7708 14.3688 43.7708C9.88372 43.7708 6.22924 40.1163 6.22924 35.6312V12.2093L0 11.4618V35.6312C0 43.6047 6.4784 50 14.3688 50C22.2591 50 28.7375 43.5216 28.7375 35.6312V11.4618L22.5083 12.2093V35.6312Z" fill="#0098DA"/>
<path d="M16.1129 17.7741H8.63786C8.13952 17.7741 7.72424 17.3588 7.72424 16.8604V9.38536C7.72424 8.88702 8.13952 8.47174 8.63786 8.47174H16.1129C16.6113 8.47174 17.0266 8.88702 17.0266 9.38536V16.8604C17.0266 17.3588 16.6113 17.7741 16.1129 17.7741Z" fill="#3E4095"/>
<path d="M20.515 22.7575H15.2824C14.7841 22.7575 14.3688 22.3422 14.3688 21.8439V16.6113C14.3688 16.113 14.7841 15.6977 15.2824 15.6977H20.515C21.0133 15.6977 21.4286 16.113 21.4286 16.6113V21.8439C21.4286 22.4253 21.0133 22.7575 20.515 22.7575Z" fill="#3E4095"/>
<path d="M19.8505 9.71762H16.113C15.6146 9.71762 15.1993 9.30233 15.1993 8.80399V5.06645C15.1993 4.56811 15.6146 4.15283 16.113 4.15283H19.8505C20.3488 4.15283 20.7641 4.56811 20.7641 5.06645V8.80399C20.6811 9.30233 20.3488 9.71762 19.8505 9.71762Z" fill="#3E4095"/>
<path d="M13.6213 3.48837H11.8771C11.3788 3.48837 10.9635 3.07309 10.9635 2.57475V0.913621C10.9635 0.415282 11.3788 0 11.8771 0H13.6213C14.1196 0 14.5349 0.415282 14.5349 0.913621V2.65781C14.5349 3.15615 14.1196 3.48837 13.6213 3.48837Z" fill="#3E4095"/>
<path d="M20.2658 41.196H8.38867V41.3622H20.2658V41.196Z" fill="#ECF9FF"/>
<path d="M20.2658 40.9469H8.38867V41.113H20.2658V40.9469Z" fill="#EBF9FF"/>
<path d="M20.2658 40.7808H8.38867V40.9469H20.2658V40.7808Z" fill="#EAF8FF"/>
<path d="M20.2658 40.6146H8.38867V40.7807H20.2658V40.6146Z" fill="#E9F8FF"/>
<path d="M20.2658 40.3655H8.38867V40.5316H20.2658V40.3655Z" fill="#E8F8FF"/>
<path d="M20.2658 40.1993H8.38867V40.3655H20.2658V40.1993Z" fill="#E7F7FF"/>
<path d="M20.2658 40.0333H8.38867V40.1994H20.2658V40.0333Z" fill="#E6F7FF"/>
<path d="M20.2658 39.8671H8.38867V40.0332H20.2658V39.8671Z" fill="#E5F7FF"/>
<path d="M20.2658 39.618H8.38867V39.7841H20.2658V39.618Z" fill="#E4F6FE"/>
<path d="M20.2658 39.4518H8.38867V39.618H20.2658V39.4518Z" fill="#E3F6FE"/>
<path d="M20.2658 39.2858H8.38867V39.4519H20.2658V39.2858Z" fill="#E2F5FE"/>
<path d="M20.2658 39.0366H8.38867V39.2027H20.2658V39.0366Z" fill="#E1F5FE"/>
<path d="M20.2658 38.8705H8.38867V39.0366H20.2658V38.8705Z" fill="#E0F5FE"/>
<path d="M20.2658 38.7043H8.38867V38.8705H20.2658V38.7043Z" fill="#DFF4FE"/>
<path d="M20.2658 38.4552H8.38867V38.6213H20.2658V38.4552Z" fill="#DEF4FE"/>
<path d="M20.2658 38.2891H8.38867V38.4552H20.2658V38.2891Z" fill="#DDF4FE"/>
<path d="M20.2658 38.1229H8.38867V38.289H20.2658V38.1229Z" fill="#DCF3FE"/>
<path d="M20.2658 37.8738H8.38867V38.0399H20.2658V37.8738Z" fill="#DBF3FE"/>
<path d="M20.2658 37.7077H8.38867V37.8738H20.2658V37.7077Z" fill="#DAF3FE"/>
<path d="M20.2658 37.5416H8.38867V37.7077H20.2658V37.5416Z" fill="#D9F2FE"/>
<path d="M20.2658 37.3754H8.38867V37.5415H20.2658V37.3754Z" fill="#D8F2FE"/>
<path d="M20.2658 37.1263H8.38867V37.2924H20.2658V37.1263Z" fill="#D7F2FE"/>
<path d="M20.2658 36.9601H8.38867V37.1263H20.2658V36.9601Z" fill="#D6F1FE"/>
<path d="M20.2658 36.7941H8.38867V36.9602H20.2658V36.7941Z" fill="#D5F1FE"/>
<path d="M20.2658 36.5449H8.38867V36.711H20.2658V36.5449Z" fill="#D4F1FD"/>
<path d="M20.2658 36.3788H8.38867V36.5449H20.2658V36.3788Z" fill="#D3F0FD"/>
<path d="M20.2658 36.2126H8.38867V36.3788H20.2658V36.2126Z" fill="#D2F0FD"/>
<path d="M20.2658 35.9635H8.38867V36.1296H20.2658V35.9635Z" fill="#D1F0FD"/>
<path d="M20.2658 35.7974H8.38867V35.9635H20.2658V35.7974Z" fill="#D0EFFD"/>
<path d="M20.2658 35.6313H8.38867V35.7974H20.2658V35.6313Z" fill="#CFEFFD"/>
<path d="M20.2658 35.3821H8.38867V35.5482H20.2658V35.3821Z" fill="#CEEEFD"/>
<path d="M20.2658 35.216H8.38867V35.3821H20.2658V35.216Z" fill="#CDEEFD"/>
<path d="M20.2658 35.0499H8.38867V35.216H20.2658V35.0499Z" fill="#CCEEFD"/>
<path d="M20.2658 34.8837H8.38867V35.0498H20.2658V34.8837Z" fill="#CBEDFD"/>
<path d="M20.2658 34.6346H8.38867V34.8007H20.2658V34.6346Z" fill="#CAEDFD"/>
<path d="M20.2658 34.4684H8.38867V34.6346H20.2658V34.4684Z" fill="#C9EDFD"/>
<path d="M20.2658 34.3024H8.38867V34.4685H20.2658V34.3024Z" fill="#C8ECFD"/>
<path d="M20.2658 34.0532H8.38867V34.2193H20.2658V34.0532Z" fill="#C7ECFD"/>
<path d="M20.2658 33.8871H8.38867V34.0532H20.2658V33.8871Z" fill="#C6ECFD"/>
<path d="M20.2658 33.7209H8.38867V33.8871H20.2658V33.7209Z" fill="#C4EBFC"/>
<path d="M20.2658 33.4718H8.38867V33.6379H20.2658V33.4718Z" fill="#C3EBFC"/>
<path d="M20.2658 33.3057H8.38867V33.4718H20.2658V33.3057Z" fill="#C2EBFC"/>
<path d="M20.2658 33.1396H8.38867V33.3057H20.2658V33.1396Z" fill="#C1EAFC"/>
<path d="M20.2658 32.8904H8.38867V33.0565H20.2658V32.8904Z" fill="#C0EAFC"/>
<path d="M20.2658 32.7242H8.38867V32.8904H20.2658V32.7242Z" fill="#BFEAFC"/>
<path d="M20.2658 32.5582H8.38867V32.7243H20.2658V32.5582Z" fill="#BEE9FC"/>
<path d="M20.2658 32.392H8.38867V32.5581H20.2658V32.392Z" fill="#BDE9FC"/>
<path d="M20.2658 32.1429H8.38867V32.309H20.2658V32.1429Z" fill="#BCE9FC"/>
<path d="M20.2658 31.9768H8.38867V32.1429H20.2658V31.9768Z" fill="#BBE8FC"/>
<path d="M20.2658 31.8107H8.38867V31.9768H20.2658V31.8107Z" fill="#BAE8FC"/>
<path d="M20.2658 31.5615H8.38867V31.7276H20.2658V31.5615Z" fill="#B9E7FC"/>
<path d="M20.2658 31.3954H8.38867V31.5615H20.2658V31.3954Z" fill="#B8E7FC"/>
<path d="M20.2658 31.2292H8.38867V31.3954H20.2658V31.2292Z" fill="#B7E7FC"/>
<path d="M20.2658 30.9801H8.38867V31.1462H20.2658V30.9801Z" fill="#B6E6FC"/>
<path d="M20.2658 30.814H8.38867V30.9801H20.2658V30.814Z" fill="#B5E6FB"/>
<path d="M20.2658 30.6479H8.38867V30.814H20.2658V30.6479Z" fill="#B4E6FB"/>
<path d="M20.2658 30.3987H8.38867V30.5648H20.2658V30.3987Z" fill="#B3E5FB"/>
<path d="M20.2658 30.2326H8.38867V30.3987H20.2658V30.2326Z" fill="#B2E5FB"/>
<path d="M20.2658 30.0665H8.38867V30.2326H20.2658V30.0665Z" fill="#B1E5FB"/>
<path d="M20.2658 29.9004H8.38867V30.0665H20.2658V29.9004Z" fill="#B0E4FB"/>
<path d="M20.2658 29.6512H8.38867V29.8173H20.2658V29.6512Z" fill="#AFE4FB"/>
<path d="M20.2658 29.4851H8.38867V29.6512H20.2658V29.4851Z" fill="#AEE4FB"/>
<path d="M20.2658 29.319H8.38867V29.4851H20.2658V29.319Z" fill="#ADE3FB"/>
<path d="M20.2658 29.0698H8.38867V29.2359H20.2658V29.0698Z" fill="#ACE3FB"/>
<path d="M20.2658 28.9037H8.38867V29.0698H20.2658V28.9037Z" fill="#ABE3FB"/>
<path d="M20.2658 28.7375H8.38867V28.9037H20.2658V28.7375Z" fill="#AAE2FB"/>
<path d="M20.2658 28.4884H8.38867V28.6545H20.2658V28.4884Z" fill="#A9E2FB"/>
<path d="M20.2658 28.3223H8.38867V28.4884H20.2658V28.3223Z" fill="#A8E2FB"/>
<path d="M20.2658 28.1562H8.38867V28.3223H20.2658V28.1562Z" fill="#A7E1FB"/>
<path d="M20.2658 27.907H8.38867V28.0731H20.2658V27.907Z" fill="#A6E1FB"/>
<path d="M20.2658 27.7409H8.38867V27.907H20.2658V27.7409Z" fill="#A5E0FA"/>
<path d="M20.2658 27.5748H8.38867V27.7409H20.2658V27.5748Z" fill="#A4E0FA"/>
<path d="M20.2658 27.4087H8.38867V27.5748H20.2658V27.4087Z" fill="#A3E0FA"/>
<path d="M20.2658 27.1595H8.38867V27.3256H20.2658V27.1595Z" fill="#A2DFFA"/>
<path d="M20.2658 26.9934H8.38867V27.1595H20.2658V26.9934Z" fill="#A1DFFA"/>
<path d="M20.2658 26.8273H8.38867V26.9934H20.2658V26.8273Z" fill="#A0DFFA"/>
<path d="M20.2658 26.5781H8.38867V26.7442H20.2658V26.5781Z" fill="#9FDEFA"/>
<path d="M20.2658 26.412H8.38867V26.5781H20.2658V26.412Z" fill="#9EDEFA"/>
</svg>
</a><!---->
            <!-- <a title="High Performance NLP with Apache Spark
" href="/">Spark NLP</a> -->
          <!---->
        </div></div><nav class="navigation top_navigation">
        <ul class="top-menu"><li class="navigation__item "><a href="/">Home</a></li><li class="navigation__item navigation__item--active"><a href="/docs">Docs</a></li><li class="navigation__item "><a href="/learn">Learn</a></li><li class="navigation__item "><a href="/models">Models</a></li><li class="navigation__item "><a href="/demos">Demo</a></li><li class="navigation__item "><a href="https://github.com/JohnSnowLabs/spark-nlp"><span style="color: #FF8A00;"><i class="fab fa-github fa-2x"></i></span></a></li><li class="navigation__item "><a href="https://www.johnsnowlabs.com/slack-redirect/"><span style="color: #FF8A00;"><i class="fab fa-slack-hash fa-2x"></i></span></a></li></ul>
      </nav><a class="responsive_btn" href="#" id="aside_menu">          
        <i class="fas fa-bars"></i>
        <i class="fas fa-times"></i>
        </a>
    </div>
  </header>
</div><div class="page__content "><div class ="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"><aside class="page__aside js-page-aside"><div class="toc-aside js-toc-root"></div></aside></div>

              <div class="col-main cell cell--auto"><!-- start custom main top snippet -->

<!-- end custom main top snippet --><article itemscope itemtype="http://schema.org/Article"><script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script><div class="article__header"><div class="header-nav"><div class="main-docs">
  <ul class="breadcrambs">
    <li><a href="/docs">Documentation</a></li>
    <li>Pipeline components</li>
  </ul>
</div></div><header><h1>Pipeline components</h1></header><span class="split-space">&nbsp;</span>
          <a class="edit-on-github"
            title="Edit on Github"
            href="https://github.com/johnsnowlabs/spark-nlp/tree/master/docs/en/ocr_pipeline_components.md">
            <i class="far fa-edit"></i></a></div><meta itemprop="headline" content="Pipeline components"><meta itemprop="author" content=""/><div class="js-article-content"><div class="docs-wrapper">
<div class="layout--article"><!-- start custom article top snippet -->

<!-- end custom article top snippet --><div class="article__content" itemprop="articleBody"><h2 id="pdf-processing">PDF processing</h2>

<p>Next section describes the transformers that deal with PDF files with the purpose of extracting text and image data from PDF files.</p>

<h3 id="pdftotext">PdfToText</h3>

<p><code class="language-plaintext highlighter-rouge">PDFToText</code> extracts text from selectable PDF (with text layout).</p>

<h5 id="input-columns">Input Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>text</td>
      <td>binary representation of the PDF document</td>
    </tr>
    <tr>
      <td>originCol</td>
      <td>string</td>
      <td>path</td>
      <td>path to the original file</td>
    </tr>
  </tbody>
</table>

<h5 id="parameters">Parameters</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>splitPage</td>
      <td>bool</td>
      <td>true</td>
      <td>whether it needed to split document to pages</td>
    </tr>
    <tr>
      <td>textStripper</td>
      <td> </td>
      <td>TextStripperType.PDF_TEXT_STRIPPER</td>
      <td> </td>
    </tr>
    <tr>
      <td>sort</td>
      <td>bool</td>
      <td>false</td>
      <td>Sort text during extraction with TextStripperType.PDF_LAYOUT_STRIPPER</td>
    </tr>
    <tr>
      <td>partitionNum</td>
      <td>int</td>
      <td>0</td>
      <td>Force repartition dataframe if set to value more than 0.</td>
    </tr>
    <tr>
      <td>onlyPageNum</td>
      <td>bool</td>
      <td>false</td>
      <td>Extract only page numbers.</td>
    </tr>
    <tr>
      <td>extractCoordinates</td>
      <td>bool</td>
      <td>false</td>
      <td>Extract coordinates and store to the <code class="language-plaintext highlighter-rouge">positions</code> column</td>
    </tr>
    <tr>
      <td>storeSplittedPdf</td>
      <td>bool</td>
      <td>false</td>
      <td>Store one page pdf’s for process it using PdfToImage.</td>
    </tr>
  </tbody>
</table>

<h5 id="output-columns">Output Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>text</td>
      <td>extracted text</td>
    </tr>
    <tr>
      <td>pageNumCol</td>
      <td>string</td>
      <td>pagenum</td>
      <td>page number or 0 when <code class="language-plaintext highlighter-rouge">splitPage = false</code></td>
    </tr>
  </tbody>
</table>

<p class="info">NOTE: For setting parameters use <code class="language-plaintext highlighter-rouge">setParamName</code> method.</p>

<p><strong>Example</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.PdfToText</span>

<span class="k">val</span> <span class="nv">pdfPath</span> <span class="k">=</span> <span class="s">"path to pdf with text layout"</span>

<span class="c1">// Read PDF file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">).</span><span class="py">load</span><span class="o">(</span><span class="n">pdfPath</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">transformer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PdfToText</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"content"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"text"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setPageNumCol</span><span class="o">(</span><span class="s">"pagenum"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setSplitPage</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">transformer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nv">data</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"pagenum"</span><span class="o">,</span> <span class="s">"text"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">pdfPath</span> <span class="o">=</span> <span class="s">"path to pdf with text layout"</span>

<span class="c1"># Read PDF file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="n">pdfPath</span><span class="p">)</span>

<span class="n">transformer</span> <span class="o">=</span> <span class="n">PdfToText</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"text"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setPageNumCol</span><span class="p">(</span><span class="s">"pagenum"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setSplitPage</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">transformer</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">data</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"pagenum"</span><span class="p">,</span> <span class="s">"text"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<p><strong>Output:</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+-------+----------------------+
|pagenum|text                  |
+-------+----------------------+
|0      |This is a page.       |
|1      |This is another page. |
|2      |Yet another page.     |
+-------+----------------------+
</code></pre></div></div>

<h3 id="pdftoimage">PdfToImage</h3>

<p><code class="language-plaintext highlighter-rouge">PdfToImage</code> renders PDF to an image. To be used with scanned PDF documents.
Output dataframe contains <code class="language-plaintext highlighter-rouge">total_pages</code> field with total number of pages.
For process pdf with big number of pages prefer to split pdf by setting <code class="language-plaintext highlighter-rouge">splitNumBatch</code> param.
Number of partitions should be equal number of cores/executors.</p>

<h5 id="input-columns-1">Input Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>content</td>
      <td>binary representation of the PDF document</td>
    </tr>
    <tr>
      <td>originCol</td>
      <td>string</td>
      <td>path</td>
      <td>path to the original file</td>
    </tr>
    <tr>
      <td>fallBackCol</td>
      <td>string</td>
      <td>text</td>
      <td>extracted text from previous method for detect if need to run transformer as fallBack</td>
    </tr>
  </tbody>
</table>

<h5 id="parameters-1">Parameters</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>splitPage</td>
      <td>bool</td>
      <td>true</td>
      <td>whether it needed to split document to pages</td>
    </tr>
    <tr>
      <td>minSizeBeforeFallback</td>
      <td>int</td>
      <td>10</td>
      <td>minimal count of characters to extract to decide, that the document is the PDF with text layout</td>
    </tr>
    <tr>
      <td>imageType</td>
      <td><a href="ocr_structures#imagetype">ImageType</a></td>
      <td><code class="language-plaintext highlighter-rouge">ImageType.TYPE_BYTE_GRAY</code></td>
      <td>type of the image</td>
    </tr>
    <tr>
      <td>resolution</td>
      <td>int</td>
      <td>300</td>
      <td>Output image resolution in dpi</td>
    </tr>
    <tr>
      <td>keepInput</td>
      <td>boolean</td>
      <td>false</td>
      <td>Keep input column in dataframe. By default it is dropping.</td>
    </tr>
    <tr>
      <td>partitionNum</td>
      <td>int</td>
      <td>0</td>
      <td>Number of Spark RDD partitions (0 value - without repartition)</td>
    </tr>
    <tr>
      <td>binarization</td>
      <td>boolean</td>
      <td>false</td>
      <td>Enable/Disable binarization image after extract image.</td>
    </tr>
    <tr>
      <td>binarizationParams</td>
      <td>Array[String]</td>
      <td>null</td>
      <td>Array of Binarization params in key=value format.</td>
    </tr>
    <tr>
      <td>splitNumBatch</td>
      <td>int</td>
      <td>0</td>
      <td>Number of partitions or size of partitions, related to the splitting strategy.</td>
    </tr>
    <tr>
      <td>partitionNumAfterSplit</td>
      <td>int</td>
      <td>0</td>
      <td>Number of Spark RDD partitions after splitting pdf document (0 value - without repartition).</td>
    </tr>
    <tr>
      <td>splittingStategy</td>
      <td><a href="ocr_structures#splittingstrategy">SplittingStrategy</a></td>
      <td>SplittingStrategy.FIXED_SIZE_OF_PARTITION</td>
      <td>Splitting strategy.</td>
    </tr>
  </tbody>
</table>

<h5 id="output-columns-1">Output Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>image</td>
      <td>extracted image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
    <tr>
      <td>pageNumCol</td>
      <td>string</td>
      <td>pagenum</td>
      <td>page number or 0 when <code class="language-plaintext highlighter-rouge">splitPage = false</code></td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.PdfToImage</span>

<span class="k">val</span> <span class="nv">pdfPath</span> <span class="k">=</span> <span class="s">"path to pdf"</span>

<span class="c1">// Read PDF file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">).</span><span class="py">load</span><span class="o">(</span><span class="n">pdfPath</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">pdfToImage</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PdfToImage</span><span class="o">()</span>
 <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"content"</span><span class="o">)</span>
 <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"text"</span><span class="o">)</span>
 <span class="o">.</span><span class="py">setPageNumCol</span><span class="o">(</span><span class="s">"pagenum"</span><span class="o">)</span>
 <span class="o">.</span><span class="py">setSplitPage</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span>  <span class="nv">pdfToImage</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nv">data</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"pagenum"</span><span class="o">,</span> <span class="s">"text"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">pdfPath</span> <span class="o">=</span> <span class="s">"path to pdf"</span>

<span class="c1"># Read PDF file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="n">pdfPath</span><span class="p">)</span>

<span class="n">pdfToImage</span> <span class="o">=</span> <span class="n">PdfToImage</span><span class="p">()</span> \
 <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
 <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"text"</span><span class="p">)</span> \
 <span class="p">.</span><span class="n">setPageNumCol</span><span class="p">(</span><span class="s">"pagenum"</span><span class="p">)</span> \
 <span class="p">.</span><span class="n">setSplitPage</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span>  <span class="n">pdfToImage</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">data</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"pagenum"</span><span class="p">,</span> <span class="s">"text"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<h3 id="imagetopdf">ImageToPdf</h3>

<p><code class="language-plaintext highlighter-rouge">ImageToPdf</code> transform image to Pdf document.
If dataframe contains few records for same origin path, it groups image by origin
column and create multipage PDF document.</p>

<h5 id="input-columns-2">Input Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
    <tr>
      <td>originCol</td>
      <td>string</td>
      <td>path</td>
      <td>path to the original file</td>
    </tr>
  </tbody>
</table>

<h5 id="output-columns-2">Output Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>content</td>
      <td>binary representation of the PDF document</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<p>Read images and store it as single page PDF documents.</p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers._</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">).</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>

<span class="c1">// Define transformer for convert to Image struct</span>
<span class="k">val</span> <span class="nv">binaryToImage</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">BinaryToImage</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"content"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="c1">// Define transformer for store to PDF</span>
<span class="k">val</span> <span class="nv">imageToPdf</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageToPdf</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"content"</span><span class="o">)</span>

<span class="c1">// Call transformers</span>
<span class="k">val</span> <span class="nv">image_df</span> <span class="k">=</span> <span class="nv">binaryToImage</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">pdf_df</span> <span class="k">=</span>  <span class="nv">pdfToImage</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">image_df</span><span class="o">)</span>

<span class="nv">pdf_df</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"content"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">pdfPath</span> <span class="o">=</span> <span class="s">"path to pdf"</span>

<span class="c1"># Read PDF file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="n">pdfPath</span><span class="p">)</span>

<span class="c1"># Define transformer for convert to Image struct
</span><span class="n">binaryToImage</span> <span class="o">=</span> <span class="n">BinaryToImage</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="c1"># Define transformer for store to PDF
</span><span class="n">imageToPdf</span> <span class="o">=</span> <span class="n">ImageToPdf</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span>

<span class="c1"># Call transformers
</span><span class="n">image_df</span> <span class="o">=</span> <span class="n">binaryToImage</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">pdf_df</span> <span class="o">=</span>  <span class="n">pdfToImage</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">image_df</span><span class="p">)</span>

<span class="n">pdf_df</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"content"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<h3 id="texttopdf">TextToPdf</h3>

<p><code class="language-plaintext highlighter-rouge">TextToPdf</code> renders ocr results to PDF document as text layout. Each symbol will render to same position
with same font size as in original image or PDF.
If dataframe contains few records for same origin path, it groups image by origin
column and create multipage PDF document.</p>

<h5 id="input-columns-3">Input Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>positions</td>
      <td>column with positions struct</td>
    </tr>
    <tr>
      <td>inputImage</td>
      <td>string</td>
      <td>image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
    <tr>
      <td>inputText</td>
      <td>string</td>
      <td>text</td>
      <td>column name with recognized text</td>
    </tr>
    <tr>
      <td>originCol</td>
      <td>string</td>
      <td>path</td>
      <td>path to the original file</td>
    </tr>
    <tr>
      <td>inputContent</td>
      <td>string</td>
      <td>content</td>
      <td>column name with binary representation of original PDF file</td>
    </tr>
  </tbody>
</table>

<h5 id="output-columns-3">Output Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>pdf</td>
      <td>binary representation of the PDF document</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<p>Read PDF document, run OCR and render results to PDF document.</p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers._</span>

<span class="k">val</span> <span class="nv">pdfPath</span> <span class="k">=</span> <span class="s">"path to pdf"</span>

<span class="c1">// Read PDF file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">).</span><span class="py">load</span><span class="o">(</span><span class="n">pdfPath</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">pdfToImage</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PdfToImage</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"content"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"image_raw"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setResolution</span><span class="o">(</span><span class="mi">400</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">binarizer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageBinarizer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image_raw"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setThreshold</span><span class="o">(</span><span class="mi">130</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">ocr</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageToText</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"text"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setIgnoreResolution</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setPageSegMode</span><span class="o">(</span><span class="nv">PageSegmentationMode</span><span class="o">.</span><span class="py">SPARSE_TEXT</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setConfidenceThreshold</span><span class="o">(</span><span class="mi">60</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">textToPdf</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">TextToPdf</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"positions"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setInputImage</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"pdf"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">pipeline</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pipeline</span><span class="o">()</span>
<span class="nv">pipeline</span><span class="o">.</span><span class="py">setStages</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span>
 <span class="n">pdfToImage</span><span class="o">,</span>
 <span class="n">binarizer</span><span class="o">,</span>
 <span class="n">ocr</span><span class="o">,</span>
 <span class="n">textToPdf</span>
<span class="o">))</span>

<span class="k">val</span> <span class="nv">modelPipeline</span> <span class="k">=</span> <span class="nv">pipeline</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">pdf</span> <span class="k">=</span> <span class="nv">modelPipeline</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">pdfContent</span> <span class="k">=</span> <span class="nv">pdf</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"pdf"</span><span class="o">).</span><span class="py">collect</span><span class="o">().</span><span class="py">head</span><span class="o">.</span><span class="py">getAs</span><span class="o">[</span><span class="kt">Array</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]](</span><span class="mi">0</span><span class="o">)</span>

<span class="c1">// store to file</span>
<span class="k">val</span> <span class="nv">tmpFile</span> <span class="k">=</span> <span class="nv">Files</span><span class="o">.</span><span class="py">createTempFile</span><span class="o">(</span><span class="n">suffix</span><span class="o">=</span><span class="s">".pdf"</span><span class="o">).</span><span class="py">toAbsolutePath</span><span class="o">.</span><span class="py">toString</span>
<span class="k">val</span> <span class="nv">fos</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="n">tmpFile</span><span class="o">)</span>
<span class="nv">fos</span><span class="o">.</span><span class="py">write</span><span class="o">(</span><span class="n">pdfContent</span><span class="o">)</span>
<span class="nv">fos</span><span class="o">.</span><span class="py">close</span><span class="o">()</span>
<span class="nf">println</span><span class="o">(</span><span class="n">tmpFile</span><span class="o">)</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">pdfPath</span> <span class="o">=</span> <span class="s">"path to pdf"</span>

<span class="c1"># Read PDF file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="n">pdfPath</span><span class="p">)</span>

<span class="n">pdf_to_image</span> <span class="o">=</span> <span class="n">PdfToImage</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image_raw"</span><span class="p">)</span>

<span class="n">binarizer</span> <span class="o">=</span> <span class="n">ImageBinarizer</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image_raw"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setThreshold</span><span class="p">(</span><span class="mi">130</span><span class="p">)</span>

<span class="n">ocr</span> <span class="o">=</span> <span class="n">ImageToText</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"text"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setIgnoreResolution</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setPageSegMode</span><span class="p">(</span><span class="n">PageSegmentationMode</span><span class="p">.</span><span class="n">SPARSE_TEXT</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setConfidenceThreshold</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

<span class="n">textToPdf</span> <span class="o">=</span> <span class="n">TextToPdf</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"positions"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setInputImage</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"pdf"</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">PipelineModel</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
    <span class="n">pdf_to_image</span><span class="p">,</span>
    <span class="n">binarizer</span><span class="p">,</span>
    <span class="n">ocr</span><span class="p">,</span>
    <span class="n">textToPdf</span>
<span class="p">])</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">).</span><span class="n">collect</span><span class="p">()</span>

<span class="c1"># Store to file for debug
</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"test.pdf"</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">pdf</span><span class="p">)</span>
</code></pre></div>  </div>

</div>

<h3 id="pdfassembler">PdfAssembler</h3>

<p><code class="language-plaintext highlighter-rouge">PdfAssembler</code> group single page PDF documents by the filename and assemble
muliplepage PDF document.</p>

<h5 id="input-columns-4">Input Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>page_pdf</td>
      <td>binary representation of the PDF document</td>
    </tr>
    <tr>
      <td>originCol</td>
      <td>string</td>
      <td>path</td>
      <td>path to the original file</td>
    </tr>
    <tr>
      <td>pageNumCol</td>
      <td>string</td>
      <td>pagenum</td>
      <td>for compatibility with another transformers</td>
    </tr>
  </tbody>
</table>

<h5 id="output-columns-4">Output Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>pdf</td>
      <td>binary representation of the PDF document</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">java.io.FileOutputStream</span>
<span class="k">import</span> <span class="nn">java.nio.file.Files</span>

<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers._</span>

<span class="k">val</span> <span class="nv">pdfPath</span> <span class="k">=</span> <span class="s">"path to pdf"</span>

<span class="c1">// Read PDF file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">).</span><span class="py">load</span><span class="o">(</span><span class="n">pdfPath</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">pdf_to_image</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PdfToImage</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"content"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setKeepInput</span><span class="o">(</span><span class="nc">True</span><span class="o">)</span>
    
<span class="c1">// Run OCR and render results to PDF</span>
<span class="k">val</span> <span class="nv">ocr</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageToTextPdf</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"pdf_page"</span><span class="o">)</span>

<span class="c1">// Assemble multipage PDF</span>
<span class="k">val</span> <span class="nv">pdf_assembler</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PdfAssembler</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"pdf_page"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"pdf"</span><span class="o">)</span>

<span class="c1">// Create pipeline</span>
<span class="k">val</span> <span class="nv">pipeline</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pipeline</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setStages</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span>
    <span class="n">pdf_to_image</span><span class="o">,</span>
    <span class="n">ocr</span><span class="o">,</span>
    <span class="n">pdf_assembler</span>
<span class="o">))</span>

<span class="k">val</span> <span class="nv">pdf</span> <span class="k">=</span> <span class="nv">pipeline</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">pdfContent</span> <span class="k">=</span> <span class="nv">pdf</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"pdf"</span><span class="o">).</span><span class="py">collect</span><span class="o">().</span><span class="py">head</span><span class="o">.</span><span class="py">getAs</span><span class="o">[</span><span class="kt">Array</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]](</span><span class="mi">0</span><span class="o">)</span>

<span class="c1">// store to pdf file</span>
<span class="k">val</span> <span class="nv">tmpFile</span> <span class="k">=</span> <span class="nv">Files</span><span class="o">.</span><span class="py">createTempFile</span><span class="o">(</span><span class="s">"with_regions_"</span><span class="o">,</span> <span class="n">s</span><span class="s">".pdf"</span><span class="o">).</span><span class="py">toAbsolutePath</span><span class="o">.</span><span class="py">toString</span>
<span class="k">val</span> <span class="nv">fos</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="n">tmpFile</span><span class="o">)</span>
<span class="nv">fos</span><span class="o">.</span><span class="py">write</span><span class="o">(</span><span class="n">pdfContent</span><span class="o">)</span>
<span class="nv">fos</span><span class="o">.</span><span class="py">close</span><span class="o">()</span>
<span class="nf">println</span><span class="o">(</span><span class="n">tmpFile</span><span class="o">)</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">PipelineModel</span>

<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">pdfPath</span> <span class="o">=</span> <span class="s">"path to pdf"</span>

<span class="c1"># Read PDF file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="n">pdfPath</span><span class="p">)</span>

<span class="n">pdf_to_image</span> <span class="o">=</span> <span class="n">PdfToImage</span><span class="p">()</span> \
        <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
        <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
        <span class="p">.</span><span class="n">setKeepInput</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    
<span class="c1"># Run OCR and render results to PDF
</span><span class="n">ocr</span> <span class="o">=</span> <span class="n">ImageToTextPdf</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"pdf_page"</span><span class="p">)</span>

<span class="c1"># Assemble multipage PDF
</span><span class="n">pdf_assembler</span> <span class="o">=</span> <span class="n">PdfAssembler</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"pdf_page"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"pdf"</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">PipelineModel</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
    <span class="n">pdf_to_image</span><span class="p">,</span>
    <span class="n">ocr</span><span class="p">,</span>
    <span class="n">pdf_assembler</span>
<span class="p">])</span>

<span class="n">pdf</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">pdfContent</span> <span class="o">=</span> <span class="n">pdf</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"pdf"</span><span class="p">).</span><span class="n">collect</span><span class="p">().</span><span class="n">head</span><span class="p">.</span><span class="n">getAs</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="n">Byte</span><span class="p">]](</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># store pdf to file
</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"test.pdf"</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pdfContent</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">pdf</span><span class="p">)</span> 
</code></pre></div>  </div>

</div>

<h3 id="pdfdrawregions">PdfDrawRegions</h3>

<p><code class="language-plaintext highlighter-rouge">PdfDrawRegions</code> transformer for drawing regions to Pdf document.</p>

<h5 id="input-columns-5">Input Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>content</td>
      <td>binary representation of the PDF document</td>
    </tr>
    <tr>
      <td>originCol</td>
      <td>string</td>
      <td>path</td>
      <td>path to the original file</td>
    </tr>
    <tr>
      <td>inputRegionsCol</td>
      <td>string</td>
      <td>region</td>
      <td>input column which contain regions</td>
    </tr>
  </tbody>
</table>

<h5 id="parameters-2">Parameters</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>lineWidth</td>
      <td>integer</td>
      <td>1</td>
      <td>line width for draw regions</td>
    </tr>
  </tbody>
</table>

<h5 id="output-columns-5">Output Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>pdf_regions</td>
      <td>binary representation of the PDF document</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">java.io.FileOutputStream</span>
<span class="k">import</span> <span class="nn">java.nio.file.Files</span>

<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers._</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.nlp.</span><span class="o">{</span><span class="nc">DocumentAssembler</span><span class="o">,</span> <span class="nc">SparkAccessor</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.nlp.annotators._</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.nlp.util.io.ReadAs</span>

<span class="k">val</span> <span class="nv">pdfPath</span> <span class="k">=</span> <span class="s">"path to pdf"</span>

<span class="c1">// Read PDF file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">).</span><span class="py">load</span><span class="o">(</span><span class="n">pdfPath</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">pdfToText</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PdfToText</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"content"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"text"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setSplitPage</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">documentAssembler</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">DocumentAssembler</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"text"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"document"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">sentenceDetector</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SentenceDetector</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCols</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"document"</span><span class="o">))</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"sentence"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">tokenizer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Tokenizer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCols</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"sentence"</span><span class="o">))</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"token"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">entityExtractor</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">TextMatcher</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCols</span><span class="o">(</span><span class="s">"sentence"</span><span class="o">,</span> <span class="s">"token"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setEntities</span><span class="o">(</span><span class="s">"test-chunks.txt"</span><span class="o">,</span> <span class="nv">ReadAs</span><span class="o">.</span><span class="py">TEXT</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"entity"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">positionFinder</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PositionFinder</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCols</span><span class="o">(</span><span class="s">"entity"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"coordinates"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setPageMatrixCol</span><span class="o">(</span><span class="s">"positions"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setMatchingWindow</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setPadding</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">pdfDrawRegions</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PdfDrawRegions</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputRegionsCol</span><span class="o">(</span><span class="s">"coordinates"</span><span class="o">)</span>

<span class="c1">// Create pipeline</span>
<span class="k">val</span> <span class="nv">pipeline</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pipeline</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setStages</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span>
    <span class="n">pdfToText</span><span class="o">,</span>
    <span class="n">documentAssembler</span><span class="o">,</span>
    <span class="n">sentenceDetector</span><span class="o">,</span>
    <span class="n">tokenizer</span><span class="o">,</span>
    <span class="n">entityExtractor</span><span class="o">,</span>
    <span class="n">positionFinder</span><span class="o">,</span>
    <span class="n">pdfDrawRegions</span>
  <span class="o">))</span>

<span class="k">val</span> <span class="nv">pdfWithRegions</span> <span class="k">=</span> <span class="nv">pipeline</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">pdfContent</span> <span class="k">=</span> <span class="nv">pdfWithRegions</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"pdf_regions"</span><span class="o">).</span><span class="py">collect</span><span class="o">().</span><span class="py">head</span><span class="o">.</span><span class="py">getAs</span><span class="o">[</span><span class="kt">Array</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]](</span><span class="mi">0</span><span class="o">)</span>

<span class="c1">// store to pdf to tmp file</span>
<span class="k">val</span> <span class="nv">tmpFile</span> <span class="k">=</span> <span class="nv">Files</span><span class="o">.</span><span class="py">createTempFile</span><span class="o">(</span><span class="s">"with_regions_"</span><span class="o">,</span> <span class="n">s</span><span class="s">".pdf"</span><span class="o">).</span><span class="py">toAbsolutePath</span><span class="o">.</span><span class="py">toString</span>
<span class="k">val</span> <span class="nv">fos</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="n">tmpFile</span><span class="o">)</span>
<span class="nv">fos</span><span class="o">.</span><span class="py">write</span><span class="o">(</span><span class="n">pdfContent</span><span class="o">)</span>
<span class="nv">fos</span><span class="o">.</span><span class="py">close</span><span class="o">()</span>
<span class="nf">println</span><span class="o">(</span><span class="n">tmpFile</span><span class="o">)</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>

<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sparknlp.annotator</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sparknlp.base</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">pdfPath</span> <span class="o">=</span> <span class="s">"path to pdf"</span>

<span class="c1"># Read PDF file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="n">pdfPath</span><span class="p">)</span>

<span class="n">pdf_to_text</span> <span class="o">=</span> <span class="n">PdfToText</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"text"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setPageNumCol</span><span class="p">(</span><span class="s">"page"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setSplitPage</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

<span class="n">document_assembler</span> <span class="o">=</span> <span class="n">DocumentAssembler</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"text"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"document"</span><span class="p">)</span>

<span class="n">sentence_detector</span> <span class="o">=</span> <span class="n">SentenceDetector</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCols</span><span class="p">([</span><span class="s">"document"</span><span class="p">])</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"sentence"</span><span class="p">)</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCols</span><span class="p">([</span><span class="s">"sentence"</span><span class="p">])</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"token"</span><span class="p">)</span>

<span class="n">entity_extractor</span> <span class="o">=</span> <span class="n">TextMatcher</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCols</span><span class="p">(</span><span class="s">"sentence"</span><span class="p">,</span> <span class="s">"token"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setEntities</span><span class="p">(</span><span class="s">"./sparkocr/resources/test-chunks.txt"</span><span class="p">,</span> <span class="n">ReadAs</span><span class="p">.</span><span class="n">TEXT</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"entity"</span><span class="p">)</span>

<span class="n">position_finder</span> <span class="o">=</span> <span class="n">PositionFinder</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCols</span><span class="p">(</span><span class="s">"entity"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"coordinates"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setPageMatrixCol</span><span class="p">(</span><span class="s">"positions"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setMatchingWindow</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setPadding</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">draw</span> <span class="o">=</span> <span class="n">PdfDrawRegions</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputRegionsCol</span><span class="p">(</span><span class="s">"coordinates"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"pdf_with_regions"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setLineWidth</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
    <span class="n">pdf_to_text</span><span class="p">,</span>
    <span class="n">document_assembler</span><span class="p">,</span>
    <span class="n">sentence_detector</span><span class="p">,</span>
    <span class="n">tokenizer</span><span class="p">,</span>
    <span class="n">entity_extractor</span><span class="p">,</span>
    <span class="n">position_finder</span><span class="p">,</span>
    <span class="n">draw</span>
<span class="p">])</span>

<span class="n">pdfWithRegions</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">).</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">pdfContent</span> <span class="o">=</span> <span class="n">pdfWithRegions</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"pdf_regions"</span><span class="p">).</span><span class="n">collect</span><span class="p">().</span><span class="n">head</span><span class="p">.</span><span class="n">getAs</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="n">Byte</span><span class="p">]](</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># store to pdf to tmp file
</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"test.pdf"</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pdfContent</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">pdf_regions</span><span class="p">)</span> 
</code></pre></div>  </div>

</div>

<p>Results:</p>

<p><img src="/assets/images/ocr/with_regions.png" alt="Result with regions" /></p>

<h3 id="pdftotexttable">PdfToTextTable</h3>

<p>Extract tables from Pdf document page.
Input is a column with binary representation of PDF document.
As output generate column with tables and tables text chunks coordinates (rows/cols).</p>

<h5 id="input-columns-6">Input Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>text</td>
      <td>binary representation of the PDF document</td>
    </tr>
    <tr>
      <td>originCol</td>
      <td>string</td>
      <td>path</td>
      <td>path to the original file</td>
    </tr>
  </tbody>
</table>

<h5 id="parameters-3">Parameters</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>pageIndex</td>
      <td>integer</td>
      <td>-1</td>
      <td>Page index to extract Tables.</td>
    </tr>
    <tr>
      <td>guess</td>
      <td>bool</td>
      <td>false</td>
      <td>A logical indicating whether to guess the locations of tables on each page.</td>
    </tr>
    <tr>
      <td>method</td>
      <td>string</td>
      <td>decide</td>
      <td>Identifying the prefered method of table extraction: basic, spreadsheet.</td>
    </tr>
  </tbody>
</table>

<h5 id="output-columns-6">Output Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>TableContainer</td>
      <td>tables</td>
      <td>Extracted tables</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">java.io.FileOutputStream</span>
<span class="k">import</span> <span class="nn">java.nio.file.Files</span>

<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers._</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.nlp.</span><span class="o">{</span><span class="nc">DocumentAssembler</span><span class="o">,</span> <span class="nc">SparkAccessor</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.nlp.annotators._</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.nlp.util.io.ReadAs</span>

<span class="k">val</span> <span class="nv">pdfPath</span> <span class="k">=</span> <span class="s">"path to pdf"</span>

<span class="c1">// Read PDF file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">).</span><span class="py">load</span><span class="o">(</span><span class="n">pdfPath</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">pdfToTextTable</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PdfToTextTable</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"content"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"table"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">pdf_to_text_table</span><span class="o">.</span><span class="py">setPageIndex</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
  <span class="o">.</span><span class="py">pdf_to_text_table</span><span class="o">.</span><span class="py">setMethod</span><span class="o">(</span><span class="s">"basic"</span><span class="o">)</span>

<span class="n">table</span> <span class="k">=</span> <span class="nv">pdfToTextTable</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="c1">// Show first row</span>
<span class="nv">table</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="n">table</span><span class="o">[</span><span class="err">"</span><span class="kt">table.chunks</span><span class="err">"</span><span class="o">].</span><span class="py">getItem</span><span class="o">(</span><span class="mi">1</span><span class="o">)[</span><span class="err">"</span><span class="kt">chunkText</span><span class="err">"</span><span class="o">]).</span><span class="py">show</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">False</span><span class="o">)</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>

<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sparknlp.annotator</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sparknlp.base</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">pdfPath</span> <span class="o">=</span> <span class="s">"path to pdf"</span>

<span class="c1"># Read PDF file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="n">pdfPath</span><span class="p">)</span>

<span class="n">pdf_to_text_table</span> <span class="o">=</span> <span class="n">PdfToTextTable</span><span class="p">()</span>
<span class="n">pdf_to_text_table</span><span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span>
<span class="n">pdf_to_text_table</span><span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"table"</span><span class="p">)</span>
<span class="n">pdf_to_text_table</span><span class="p">.</span><span class="n">setPageIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">pdf_to_text_table</span><span class="p">.</span><span class="n">setMethod</span><span class="p">(</span><span class="s">"basic"</span><span class="p">)</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">pdf_to_text_table</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># Show first row
</span><span class="n">table</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s">"table.chunks"</span><span class="p">].</span><span class="n">getItem</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s">"chunkText"</span><span class="p">]).</span><span class="n">show</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
</code></pre></div>  </div>

</div>

<p>Output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+------------------------------------------------------------------+
|table.chunks AS chunks#760[1].chunkText                           |
+------------------------------------------------------------------+
|[Mazda RX4, 21.0, 6, , 160.0, 110, 3.90, 2.620, 16.46, 0, 1, 4, 4]|
+------------------------------------------------------------------+
</code></pre></div></div>

<h2 id="docx-processing">DOCX processing</h2>

<p>Next section describes the transformers that deal with DOCX files with the purpose of extracting text and table data from it.</p>

<h3 id="doctotext">DocToText</h3>

<p><code class="language-plaintext highlighter-rouge">DocToText</code> extracts text from the DOCX document.</p>

<h5 id="input-columns-7">Input Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>text</td>
      <td>binary representation of the DOCX document</td>
    </tr>
    <tr>
      <td>originCol</td>
      <td>string</td>
      <td>path</td>
      <td>path to the original file</td>
    </tr>
  </tbody>
</table>

<h5 id="output-columns-7">Output Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>text</td>
      <td>extracted text</td>
    </tr>
    <tr>
      <td>pageNumCol</td>
      <td>string</td>
      <td>pagenum</td>
      <td>for compatibility with another transformers</td>
    </tr>
  </tbody>
</table>

<p class="info">NOTE: For setting parameters use <code class="language-plaintext highlighter-rouge">setParamName</code> method.</p>

<p><strong>Example</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.DocToText</span>

<span class="k">val</span> <span class="nv">docPath</span> <span class="k">=</span> <span class="s">"path to docx with text layout"</span>

<span class="c1">// Read DOCX file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">).</span><span class="py">load</span><span class="o">(</span><span class="n">docPath</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">transformer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">DocToText</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"content"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"text"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">transformer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nv">data</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"pagenum"</span><span class="o">,</span> <span class="s">"text"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">docPath</span> <span class="o">=</span> <span class="s">"path to docx with text layout"</span>

<span class="c1"># Read DOCX file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="n">docPath</span><span class="p">)</span>

<span class="n">transformer</span> <span class="o">=</span> <span class="n">DocToText</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"text"</span><span class="p">)</span> 

<span class="n">data</span> <span class="o">=</span> <span class="n">transformer</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">data</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"pagenum"</span><span class="p">,</span> <span class="s">"text"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<h3 id="doctotexttable">DocToTextTable</h3>

<p><code class="language-plaintext highlighter-rouge">DocToTextTable</code> extracts table data from the DOCX documents.</p>

<h5 id="input-columns-8">Input Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>text</td>
      <td>binary representation of the PDF document</td>
    </tr>
    <tr>
      <td>originCol</td>
      <td>string</td>
      <td>path</td>
      <td>path to the original file</td>
    </tr>
  </tbody>
</table>

<h5 id="output-columns-8">Output Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>TableContainer</td>
      <td>tables</td>
      <td>Extracted tables</td>
    </tr>
  </tbody>
</table>

<p class="info">NOTE: For setting parameters use <code class="language-plaintext highlighter-rouge">setParamName</code> method.</p>

<p><strong>Example</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.DocToTextTable</span>

<span class="k">val</span> <span class="nv">docPath</span> <span class="k">=</span> <span class="s">"path to docx with text layout"</span>

<span class="c1">// Read DOCX file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">).</span><span class="py">load</span><span class="o">(</span><span class="n">docPath</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">transformer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">DocToTextTable</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"content"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"tables"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">transformer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nv">data</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"tables"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">docPath</span> <span class="o">=</span> <span class="s">"path to docx with text layout"</span>

<span class="c1"># Read DOCX file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="n">docPath</span><span class="p">)</span>

<span class="n">transformer</span> <span class="o">=</span> <span class="n">DocToTextTable</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"tables"</span><span class="p">)</span> 

<span class="n">data</span> <span class="o">=</span> <span class="n">transformer</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">data</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"tables"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<h3 id="doctopdf">DocToPdf</h3>

<p><code class="language-plaintext highlighter-rouge">DocToPdf</code> convert DOCX document to PDF document.</p>

<h5 id="input-columns-9">Input Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>text</td>
      <td>binary representation of the DOCX document</td>
    </tr>
    <tr>
      <td>originCol</td>
      <td>string</td>
      <td>path</td>
      <td>path to the original file</td>
    </tr>
  </tbody>
</table>

<h5 id="output-columns-9">Output Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>text</td>
      <td>binary representation of the PDF document</td>
    </tr>
  </tbody>
</table>

<p class="info">NOTE: For setting parameters use <code class="language-plaintext highlighter-rouge">setParamName</code> method.</p>

<p><strong>Example</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.DocToPdf</span>

<span class="k">val</span> <span class="nv">docPath</span> <span class="k">=</span> <span class="s">"path to docx with text layout"</span>

<span class="c1">// Read DOCX file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">).</span><span class="py">load</span><span class="o">(</span><span class="n">docPath</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">transformer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">DocToPdf</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"content"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"pdf"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">transformer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nv">data</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"pdf"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">docPath</span> <span class="o">=</span> <span class="s">"path to docx with text layout"</span>

<span class="c1"># Read DOCX file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="n">docPath</span><span class="p">)</span>

<span class="n">transformer</span> <span class="o">=</span> <span class="n">DocToPdf</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"pdf"</span><span class="p">)</span> 

<span class="n">data</span> <span class="o">=</span> <span class="n">transformer</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">data</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"pdf"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<h3 id="ppttotexttable">PptToTextTable</h3>

<p><code class="language-plaintext highlighter-rouge">PptToTextTable</code> extracts table data from the PPT and PPTX documents.</p>

<h5 id="input-columns-10">Input Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>text</td>
      <td>binary representation of the PPT document</td>
    </tr>
    <tr>
      <td>originCol</td>
      <td>string</td>
      <td>path</td>
      <td>path to the original file</td>
    </tr>
  </tbody>
</table>

<h5 id="output-columns-10">Output Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>TableContainer</td>
      <td>tables</td>
      <td>Extracted tables</td>
    </tr>
  </tbody>
</table>

<p class="info">NOTE: For setting parameters use <code class="language-plaintext highlighter-rouge">setParamName</code> method.</p>

<p><strong>Example</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.PptToTextTable</span>

<span class="k">val</span> <span class="nv">docPath</span> <span class="k">=</span> <span class="s">"path to docx with text layout"</span>

<span class="c1">// Read PPT file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">).</span><span class="py">load</span><span class="o">(</span><span class="n">docPath</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">transformer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PptToTextTable</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"content"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"tables"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">transformer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nv">data</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"tables"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">docPath</span> <span class="o">=</span> <span class="s">"path to docx with text layout"</span>

<span class="c1"># Read PPT file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="n">docPath</span><span class="p">)</span>

<span class="n">transformer</span> <span class="o">=</span> <span class="n">PptToTextTable</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"tables"</span><span class="p">)</span> 

<span class="n">data</span> <span class="o">=</span> <span class="n">transformer</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">data</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"tables"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<h3 id="ppttopdf">PptToPdf</h3>

<p><code class="language-plaintext highlighter-rouge">PptToPdf</code> convert PPT and PPTX document to PDF document.</p>

<h5 id="input-columns-11">Input Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>text</td>
      <td>binary representation of the PPT document</td>
    </tr>
    <tr>
      <td>originCol</td>
      <td>string</td>
      <td>path</td>
      <td>path to the original file</td>
    </tr>
  </tbody>
</table>

<h5 id="output-columns-11">Output Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>text</td>
      <td>binary representation of the PDF document</td>
    </tr>
  </tbody>
</table>

<p class="info">NOTE: For setting parameters use <code class="language-plaintext highlighter-rouge">setParamName</code> method.</p>

<p><strong>Example</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.PptToPdf</span>

<span class="k">val</span> <span class="nv">docPath</span> <span class="k">=</span> <span class="s">"path to docx with text layout"</span>

<span class="c1">// Read PPT file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">).</span><span class="py">load</span><span class="o">(</span><span class="n">docPath</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">transformer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PptToPdf</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"content"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"pdf"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">transformer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nv">data</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"pdf"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">docPath</span> <span class="o">=</span> <span class="s">"path to PPT with text layout"</span>

<span class="c1"># Read DOCX file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="n">docPath</span><span class="p">)</span>

<span class="n">transformer</span> <span class="o">=</span> <span class="n">PptToPdf</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"pdf"</span><span class="p">)</span> 

<span class="n">data</span> <span class="o">=</span> <span class="n">transformer</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">data</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"pdf"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<h2 id="dicom-processing">Dicom processing</h2>

<h3 id="dicomtoimage">DicomToImage</h3>

<p><code class="language-plaintext highlighter-rouge">DicomToImage</code> transforms dicom object (loaded as binary file) to image struct.</p>

<h5 id="input-columns-12">Input Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>content</td>
      <td>binary dicom object</td>
    </tr>
    <tr>
      <td>originCol</td>
      <td>string</td>
      <td>path</td>
      <td>path to the original file</td>
    </tr>
  </tbody>
</table>

<h5 id="output-columns-12">Output Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>image</td>
      <td>extracted image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
    <tr>
      <td>pageNumCol</td>
      <td>integer</td>
      <td>pagenum</td>
      <td>page (image) number begin from 0</td>
    </tr>
    <tr>
      <td>metadataCol</td>
      <td>string</td>
      <td>metadata</td>
      <td>Output column name for dicom metatdata ( json formatted )</td>
    </tr>
  </tbody>
</table>

<p><strong>Scala example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.DicomToImage</span>

<span class="k">val</span> <span class="nv">dicomPath</span> <span class="k">=</span> <span class="s">"path to dicom files"</span>

<span class="c1">// Read dicom file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">).</span><span class="py">load</span><span class="o">(</span><span class="n">dicomPath</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">dicomToImage</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">DicomToImage</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"content"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setMetadataCol</span><span class="o">(</span><span class="s">"meta"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">dicomToImage</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nv">data</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"image"</span><span class="o">,</span> <span class="s">"pagenum"</span><span class="o">,</span> <span class="s">"meta"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">dicomPath</span> <span class="o">=</span> <span class="s">"path to dicom files"</span>

<span class="c1"># Read dicom file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="n">dicomPath</span><span class="p">)</span>

<span class="n">dicomToImage</span> <span class="o">=</span> <span class="n">DicomToImage</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setMetadataCol</span><span class="p">(</span><span class="s">"meta"</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">dicomToImage</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">data</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"image"</span><span class="p">,</span> <span class="s">"pagenum"</span><span class="p">,</span> <span class="s">"meta"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<h3 id="imagetodicom">ImageToDicom</h3>

<p><code class="language-plaintext highlighter-rouge">ImageToDicom</code> transforms image to Dicom document.</p>

<h5 id="input-columns-13">Input Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
    <tr>
      <td>originCol</td>
      <td>string</td>
      <td>path</td>
      <td>path to the original file</td>
    </tr>
    <tr>
      <td>metadataCol</td>
      <td>string</td>
      <td>metadata</td>
      <td>dicom metatdata ( json formatted )</td>
    </tr>
  </tbody>
</table>

<h5 id="output-columns-13">Output Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>dicom</td>
      <td>binary dicom object</td>
    </tr>
  </tbody>
</table>

<p><strong>Scala example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.ImageToDicom</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image file"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
  <span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">asImage</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">imageToDicom</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageToDicom</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"dicom"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">imageToDicom</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nv">data</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"dicom"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image file"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>

<span class="n">binaryToImage</span> <span class="o">=</span> <span class="n">BinaryToImage</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="n">image_df</span> <span class="o">=</span> <span class="n">binaryToImage</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">imageToDicom</span> <span class="o">=</span> <span class="n">ImageToDicom</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"dicom"</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">imageToDicom</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">image_df</span><span class="p">)</span>

<span class="n">data</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"dicom"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<h2 id="image-pre-processing">Image pre-processing</h2>

<p>Next section describes the transformers for image pre-processing: scaling, binarization, skew correction, etc.</p>

<h3 id="binarytoimage">BinaryToImage</h3>

<p><code class="language-plaintext highlighter-rouge">BinaryToImage</code> transforms image (loaded as binary file) to image struct.</p>

<h5 id="input-columns-14">Input Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>content</td>
      <td>binary representation of the image</td>
    </tr>
    <tr>
      <td>originCol</td>
      <td>string</td>
      <td>path</td>
      <td>path to the original file</td>
    </tr>
  </tbody>
</table>

<h5 id="output-columns-14">Output Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>image</td>
      <td>extracted image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<p><strong>Scala example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.BinaryToImage</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">).</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">binaryToImage</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">BinaryToImage</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"content"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">binaryToImage</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nv">data</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"image"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>

<span class="n">binaryToImage</span> <span class="o">=</span> <span class="n">BinaryToImage</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">binaryToImage</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">data</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"image"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<h3 id="gpuimagetransformer">GPUImageTransformer</h3>

<p><code class="language-plaintext highlighter-rouge">GPUImageTransformer</code> allows to run image pre-processing operations on GPU.</p>

<p>It supports following operations:</p>
<ul>
  <li>Scaling</li>
  <li>Otsu thresholding</li>
  <li>Huang thresholding</li>
  <li>Erosion</li>
  <li>Dilation</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">GPUImageTransformer</code> allows to add few operations. For add  operations need to call
one of the methods with params:</p>

<table class="table-model-big">
  <tbody>
    <tr>
      <td>Method name</td>
      <td>Params</td>
      <td>Description</td>
    </tr>
    <tr>
      <td>addScalingTransform</td>
      <td>factor</td>
      <td>Scale image by scaling factor.</td>
    </tr>
    <tr>
      <td>addOtsuTransform</td>
      <td> </td>
      <td>The automatic thresholder utilizes the Otsu threshold method.</td>
    </tr>
    <tr>
      <td>addHuangTransform</td>
      <td> </td>
      <td>The automatic thresholder utilizes the Huang threshold method.</td>
    </tr>
    <tr>
      <td>addDilateTransform</td>
      <td>width, height</td>
      <td>Computes the local maximum of a pixels rectangular neighborhood. The rectangles size is specified by its half-width and half-height.</td>
    </tr>
    <tr>
      <td>addErodeTransform</td>
      <td>width, height</td>
      <td>Computes the local minimum of a pixels rectangular neighborhood. The rectangles size is specified by its half-width and half-height</td>
    </tr>
  </tbody>
</table>

<h5 id="input-columns-15">Input Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<h5 id="parameters-4">Parameters</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>imageType</td>
      <td><a href="ocr_structures#imagetype">ImageType</a></td>
      <td><code class="language-plaintext highlighter-rouge">ImageType.TYPE_BYTE_BINARY</code></td>
      <td>Type of the output image</td>
    </tr>
    <tr>
      <td>gpuName</td>
      <td>string</td>
      <td>””</td>
      <td>GPU device name.</td>
    </tr>
  </tbody>
</table>

<h5 id="output-columns-15">Output Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>transformed_image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.GPUImageTransformer</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.OcrContext.implicits._</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
  <span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">asImage</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">transformer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">GPUImageTransformer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"transformed_image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">addHuangTransform</span><span class="o">()</span>
  <span class="o">.</span><span class="py">addScalingTransform</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
  <span class="o">.</span><span class="py">addDilateTransform</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setImageType</span><span class="o">(</span><span class="nv">ImageType</span><span class="o">.</span><span class="py">TYPE_BYTE_BINARY</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">transformer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nv">data</span><span class="o">.</span><span class="py">storeImage</span><span class="o">(</span><span class="s">"transformed_image"</span><span class="o">)</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sparkocr.enums</span> <span class="kn">import</span> <span class="n">ImageType</span>
<span class="kn">from</span> <span class="nn">sparkocr.utils</span> <span class="kn">import</span> <span class="n">display_images</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> \
  <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>

<span class="n">binary_to_image</span> <span class="o">=</span> <span class="n">BinaryToImage</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="n">transformer</span> <span class="o">=</span> <span class="n">GPUImageTransformer</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"transformed_image"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">addHuangTransform</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">addScalingTransform</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">addDilateTransform</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setImageType</span><span class="p">(</span><span class="n">ImageType</span><span class="p">.</span><span class="n">TYPE_BYTE_BINARY</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">PipelineModel</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
            <span class="n">binary_to_image</span><span class="p">,</span>
            <span class="n">transformer</span>
        <span class="p">])</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">display_images</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s">"transformed_image"</span><span class="p">)</span>
</code></pre></div>  </div>

</div>

<h3 id="imagebinarizer">ImageBinarizer</h3>

<p><code class="language-plaintext highlighter-rouge">ImageBinarizer</code> transforms image to binary color schema by threshold.</p>

<h5 id="input-columns-16">Input Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<h5 id="parameters-5">Parameters</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>threshold</td>
      <td>int</td>
      <td>170</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h5 id="output-columns-16">Output Columns</h5>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>binarized_image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.ImageBinarizer</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.OcrContext.implicits._</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
  <span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">asImage</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">binirizer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageBinarizer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"binary_image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setThreshold</span><span class="o">(</span><span class="mi">100</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">binirizer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nv">data</span><span class="o">.</span><span class="py">storeImage</span><span class="o">(</span><span class="s">"binary_image"</span><span class="o">)</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> \
  <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">asImage</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="n">binirizer</span> <span class="o">=</span> <span class="n">ImageBinarizer</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"binary_image"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setThreshold</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">binirizer</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">data</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<p><strong>Original image:</strong></p>

<p><img src="/assets/images/ocr/text_with_noise.png" alt="original" /></p>

<p><strong>Binarized image with 100 threshold:</strong></p>

<p><img src="/assets/images/ocr/binarized.png" alt="binarized" /></p>

<h3 id="imageadaptivebinarizer">ImageAdaptiveBinarizer</h3>

<p>Supported Methods:</p>
<ul>
  <li>OTSU</li>
  <li>Gaussian local thresholding. Thresholds the image using a locally adaptive threshold that is computed
 using a local square region centered on each pixel.  The threshold is equal to the gaussian weighted sum 
 of the surrounding pixels times the scale.</li>
  <li>Sauvola</li>
</ul>

<h4 id="input-columns-17">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<h4 id="parameters-6">Parameters</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>width</td>
      <td>float</td>
      <td>90</td>
      <td>Width of square region.</td>
    </tr>
    <tr>
      <td>method</td>
      <td><a href="ocr_structures#tresholdingmethod">TresholdingMethod</a></td>
      <td><code class="language-plaintext highlighter-rouge">TresholdingMethod.GAUSSIAN</code></td>
      <td>Method used to determine adaptive threshold.</td>
    </tr>
    <tr>
      <td>scale</td>
      <td>float</td>
      <td>1.1f</td>
      <td>Scale factor used to adjust threshold.</td>
    </tr>
    <tr>
      <td>imageType</td>
      <td><a href="ocr_structures#imagetype">ImageType</a></td>
      <td><code class="language-plaintext highlighter-rouge">ImageType.TYPE_BYTE_BINARY</code></td>
      <td>Type of the output image</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-17">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>binarized_image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.</span><span class="o">*</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.OcrContext.implicits._</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
  <span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">asImage</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">binirizer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageAdaptiveBinarizer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"binary_image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setWidth</span><span class="o">(</span><span class="mi">100</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setScale</span><span class="o">(</span><span class="mf">1.1</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">binirizer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nv">data</span><span class="o">.</span><span class="py">storeImage</span><span class="o">(</span><span class="s">"binary_image"</span><span class="o">)</span>












</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">PipelineModel</span>

<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sparkocr.utils</span> <span class="kn">import</span> <span class="n">display_image</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> 
    <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span>
    <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>

<span class="n">binary_to_image</span> <span class="o">=</span> <span class="n">BinaryToImage</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="n">adaptive_thresholding</span> <span class="o">=</span> <span class="n">ImageAdaptiveBinarizer</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"binarized_image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setWidth</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setScale</span><span class="p">(</span><span class="mf">1.1</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">PipelineModel</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
            <span class="n">binary_to_image</span><span class="p">,</span>
            <span class="n">adaptive_thresholding</span>
        <span class="p">])</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"image"</span><span class="p">,</span> <span class="s">"corrected_image"</span><span class="p">).</span><span class="n">collect</span><span class="p">():</span>
    <span class="n">display_image</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">image</span><span class="p">)</span>
    <span class="n">display_image</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">corrected_image</span><span class="p">)</span>
</code></pre></div>  </div>

</div>

<h3 id="imageadaptivethresholding">ImageAdaptiveThresholding</h3>

<p>Compute a threshold mask image based on local pixel neighborhood and apply it to image.</p>

<p>Also known as adaptive or dynamic thresholding. The threshold value is
the weighted mean for the local neighborhood of a pixel subtracted by a constant.</p>

<p>Supported methods:</p>
<ul>
  <li><strong><em>GAUSSIAN</em></strong></li>
  <li><strong><em>MEAN</em></strong></li>
  <li><strong><em>MEDIAN</em></strong></li>
  <li><strong><em>WOLF</em></strong></li>
  <li><strong><em>SINGH</em></strong></li>
</ul>

<h4 id="input-columns-18">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<h4 id="parameters-7">Parameters</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>blockSize</td>
      <td>int</td>
      <td>170</td>
      <td>Odd size of pixel neighborhood which is used to calculate the threshold value (e.g. 3, 5, 7, …, 21, …).</td>
    </tr>
    <tr>
      <td>method</td>
      <td><a href="ocr_structures#adaptivethresholdingmethod">AdaptiveThresholdingMethod</a></td>
      <td>AdaptiveThresholdingMethod.GAUSSIAN</td>
      <td>Method used to determine adaptive threshold for local neighbourhood in weighted mean image.</td>
    </tr>
    <tr>
      <td>offset</td>
      <td>int</td>
      <td> </td>
      <td>Constant subtracted from weighted mean of neighborhood to calculate the local threshold value. Default offset is 0.</td>
    </tr>
    <tr>
      <td>mode</td>
      <td>string</td>
      <td> </td>
      <td>The mode parameter determines how the array borders are handled, where cval is the value when mode is equal to ‘constant’</td>
    </tr>
    <tr>
      <td>cval</td>
      <td>int</td>
      <td> </td>
      <td>Value to fill past edges of input if mode is ‘constant’.</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-18">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>binarized_image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Implemented only for Python</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">PipelineModel</span>

<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sparkocr.utils</span> <span class="kn">import</span> <span class="n">display_image</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> 
    <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span>
    <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>

<span class="n">binary_to_image</span> <span class="o">=</span> <span class="n">BinaryToImage</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="n">adaptive_thresholding</span> <span class="o">=</span> <span class="n">ImageAdaptiveThresholding</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"scaled_image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"binarized_image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setBlockSize</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOffset</span><span class="p">(</span><span class="mi">73</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">PipelineModel</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
            <span class="n">binary_to_image</span><span class="p">,</span>
            <span class="n">adaptive_thresholding</span>
        <span class="p">])</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"image"</span><span class="p">,</span> <span class="s">"corrected_image"</span><span class="p">).</span><span class="n">collect</span><span class="p">():</span>
    <span class="n">display_image</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">image</span><span class="p">)</span>
    <span class="n">display_image</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">corrected_image</span><span class="p">)</span>
</code></pre></div>  </div>

</div>

<p><strong>Original image:</strong></p>

<p><img src="/assets/images/ocr/text_with_noise.png" alt="original" /></p>

<p><strong>Binarized image:</strong></p>

<p><img src="/assets/images/ocr/adaptive_binarized.png" alt="binarized" /></p>

<h3 id="imagescaler">ImageScaler</h3>

<p><code class="language-plaintext highlighter-rouge">ImageScaler</code> scales image by provided scale factor or needed output size.
It supports keeping original ratio of image by padding the image in case fixed output size.</p>

<h4 id="input-columns-19">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<h4 id="parameters-8">Parameters</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>scaleFactor</td>
      <td>double</td>
      <td>1.0</td>
      <td>scale factor</td>
    </tr>
    <tr>
      <td>keepRatio</td>
      <td>boolean</td>
      <td>false</td>
      <td>Keep original ratio of image</td>
    </tr>
    <tr>
      <td>width</td>
      <td>int</td>
      <td>0</td>
      <td>Output width of image</td>
    </tr>
    <tr>
      <td>height</td>
      <td>int</td>
      <td>0</td>
      <td>Outpu height of imgae</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-19">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>scaled_image</td>
      <td>scaled image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.ImageScaler</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.OcrContext.implicits._</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
  <span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">asImage</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">transformer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageScaler</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"scaled_image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setScaleFactor</span><span class="o">(</span><span class="mf">0.5</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">transformer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
<span class="nv">data</span><span class="o">.</span><span class="py">storeImage</span><span class="o">(</span><span class="s">"scaled_image"</span><span class="o">)</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> \
  <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">asImage</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="n">transformer</span> <span class="o">=</span> <span class="n">ImageScaler</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"scaled_image"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setScaleFactor</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">transformer</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">data</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<h3 id="imageadaptivescaler">ImageAdaptiveScaler</h3>

<p><code class="language-plaintext highlighter-rouge">ImageAdaptiveScaler</code> detects font size and scales image for have desired font size.</p>

<h4 id="input-columns-20">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<h4 id="parameters-9">Parameters</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>desiredSize</td>
      <td>int</td>
      <td>34</td>
      <td>desired size of font in pixels</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-20">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>scaled_image</td>
      <td>scaled image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.ImageAdaptiveScaler</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.OcrContext.implicits._</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
  <span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">asImage</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">transformer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageAdaptiveScaler</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"scaled_image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setDesiredSize</span><span class="o">(</span><span class="mi">34</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">transformer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
<span class="nv">data</span><span class="o">.</span><span class="py">storeImage</span><span class="o">(</span><span class="s">"scaled_image"</span><span class="o">)</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> \
  <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">asImage</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="n">transformer</span> <span class="o">=</span> <span class="n">ImageAdaptiveScaler</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"scaled_image"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setDesiredSize</span><span class="p">(</span><span class="mi">34</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">transformer</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">data</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<h3 id="imageskewcorrector">ImageSkewCorrector</h3>

<p><code class="language-plaintext highlighter-rouge">ImageSkewCorrector</code> detects skew of the image and rotates it.</p>

<h4 id="input-columns-21">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<h4 id="parameters-10">Parameters</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>rotationAngle</td>
      <td>double</td>
      <td>0.0</td>
      <td>rotation angle</td>
    </tr>
    <tr>
      <td>automaticSkewCorrection</td>
      <td>boolean</td>
      <td>true</td>
      <td>enables/disables adaptive skew correction</td>
    </tr>
    <tr>
      <td>halfAngle</td>
      <td>double</td>
      <td>5.0</td>
      <td>half the angle(in degrees) that will be considered for correction</td>
    </tr>
    <tr>
      <td>resolution</td>
      <td>double</td>
      <td>1.0</td>
      <td>The step size(in degrees) that will be used for generating correction angle candidates</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-21">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>corrected_image</td>
      <td>corrected image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.ImageSkewCorrector</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.OcrContext.implicits._</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
  <span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">asImage</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">transformer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageSkewCorrector</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"corrected_image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setAutomaticSkewCorrection</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">transformer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
<span class="nv">data</span><span class="o">.</span><span class="py">storeImage</span><span class="o">(</span><span class="s">"corrected_image"</span><span class="o">)</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">val</span> <span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="o">//</span> <span class="n">Read</span> <span class="n">image</span> <span class="nb">file</span> <span class="k">as</span> <span class="n">binary</span> <span class="nb">file</span>
<span class="n">val</span> <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span>
  <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span>
  <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>
  <span class="p">.</span><span class="n">asImage</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="n">val</span> <span class="n">transformer</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ImageSkewCorrector</span><span class="p">()</span>
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"corrected_image"</span><span class="p">)</span>
  <span class="p">.</span><span class="n">setAutomaticSkewCorrection</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>

<span class="n">val</span> <span class="n">data</span> <span class="o">=</span> <span class="n">transformer</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">data</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<p><strong>Original image:</strong></p>

<p><img src="/assets/images/ocr/rotated.png" alt="original" /></p>

<p><strong>Corrected image:</strong></p>

<p><img src="/assets/images/ocr/corrected.png" alt="corrected" /></p>

<h3 id="imagenoisescorer">ImageNoiseScorer</h3>

<p><code class="language-plaintext highlighter-rouge">ImageNoiseScorer</code> computes noise score for each region.</p>

<h4 id="input-columns-22">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
    <tr>
      <td>inputRegionsCol</td>
      <td>string</td>
      <td>regions</td>
      <td>regions</td>
    </tr>
  </tbody>
</table>

<h4 id="parameters-11">Parameters</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>method</td>
      <td><a href="ocr_structures#noisemethod">NoiseMethod</a> string</td>
      <td>NoiseMethod.RATIO</td>
      <td>method of computation noise score</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-22">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>noisescores</td>
      <td>noise score for each region</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span>

<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.</span><span class="o">{</span><span class="nc">ImageNoiseScorer</span><span class="o">,</span> <span class="nc">ImageLayoutAnalyzer</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.NoiseMethod</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.OcrContext.implicits._</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
  <span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">asImage</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="c1">// Define transformer for detect regions</span>
<span class="k">val</span> <span class="nv">layoutAnalyzer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageLayoutAnalyzer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"regions"</span><span class="o">)</span>

<span class="c1">// Define transformer for compute noise level for each region</span>
<span class="k">val</span> <span class="nv">noisescorer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageNoiseScorer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"noiselevel"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setInputRegionsCol</span><span class="o">(</span><span class="s">"regions"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setMethod</span><span class="o">(</span><span class="nv">NoiseMethod</span><span class="o">.</span><span class="py">VARIANCE</span><span class="o">)</span>

<span class="c1">// Define pipeline</span>
<span class="k">val</span> <span class="nv">pipeline</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pipeline</span><span class="o">()</span>
<span class="nv">pipeline</span><span class="o">.</span><span class="py">setStages</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span>
  <span class="n">layoutAnalyzer</span><span class="o">,</span>
  <span class="n">noisescorer</span>
<span class="o">))</span>

<span class="k">val</span> <span class="nv">modelPipeline</span> <span class="k">=</span> <span class="nv">pipeline</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="nv">spark</span><span class="o">.</span><span class="py">emptyDataFrame</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">modelPipeline</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nv">data</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"path"</span><span class="o">,</span> <span class="s">"noiselevel"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">PipelineModel</span>

<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sparkocr.enums</span> <span class="kn">import</span> <span class="n">NoiseMethod</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> \
  <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">asImage</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="c1"># Define transformer for detect regions
</span><span class="n">layoutAnalyzer</span> <span class="o">=</span> <span class="n">ImageLayoutAnalyzer</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"regions"</span><span class="p">)</span>

<span class="c1"># Define transformer for compute noise level for each region
</span><span class="n">noisescorer</span> <span class="o">=</span> <span class="n">ImageNoiseScorer</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"noiselevel"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setInputRegionsCol</span><span class="p">(</span><span class="s">"regions"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setMethod</span><span class="p">(</span><span class="n">NoiseMethod</span><span class="p">.</span><span class="n">VARIANCE</span><span class="p">)</span>

<span class="c1"># Define pipeline
</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">()</span>
<span class="n">pipeline</span><span class="p">.</span><span class="n">setStages</span><span class="p">(</span><span class="n">Array</span><span class="p">(</span>
  <span class="n">layoutAnalyzer</span><span class="p">,</span>
  <span class="n">noisescorer</span>
<span class="p">))</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">data</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"path"</span><span class="p">,</span> <span class="s">"noiselevel"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<p><strong>Output:</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+------------------+-----------------------------------------------------------------------------+
|path              |noiselevel                                                                   |
+------------------+-----------------------------------------------------------------------------+
|file:./noisy.png  |[32.01805641767766, 32.312916551193354, 29.99257352247787, 30.62470388308217]|
+------------------+-----------------------------------------------------------------------------+

</code></pre></div></div>

<h3 id="imageremoveobjects">ImageRemoveObjects</h3>

<p><strong>python only</strong></p>

<p><code class="language-plaintext highlighter-rouge">ImageRemoveObjects</code> for remove background objects.
It support removing:</p>
<ul>
  <li>objects less then elements of font with <em>minSizeFont</em> size</li>
  <li>objects less then <em>minSizeObject</em></li>
  <li>holes less then <em>minSizeHole</em></li>
  <li>objects more then <em>maxSizeObject</em></li>
</ul>

<h4 id="input-columns-23">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>None</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<h4 id="parameters-12">Parameters</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>minSizeFont</td>
      <td>int</td>
      <td>10</td>
      <td>Min size font in pt.</td>
    </tr>
    <tr>
      <td>minSizeObject</td>
      <td>int</td>
      <td>None</td>
      <td>Min size of object which will keep on image [*].</td>
    </tr>
    <tr>
      <td>connectivityObject</td>
      <td>int</td>
      <td>0</td>
      <td>The connectivity defining the neighborhood of a pixel.</td>
    </tr>
    <tr>
      <td>minSizeHole</td>
      <td>int</td>
      <td>None</td>
      <td>Min size of hole which will keep on image[ *].</td>
    </tr>
    <tr>
      <td>connectivityHole</td>
      <td>int</td>
      <td>0</td>
      <td>The connectivity defining the neighborhood of a pixel.</td>
    </tr>
    <tr>
      <td>maxSizeObject</td>
      <td>int</td>
      <td>None</td>
      <td>Max size of object which will keep on image [*].</td>
    </tr>
    <tr>
      <td>connectivityMaxObject</td>
      <td>int</td>
      <td>0</td>
      <td>The connectivity defining the neighborhood of a pixel.</td>
    </tr>
  </tbody>
</table>

<p>[*] : <em>None</em> value disables removing objects.</p>

<h4 id="output-columns-23">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>None</td>
      <td>scaled image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Implemented only for Python</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">PipelineModel</span>
<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> 
    <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span>
    <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>

<span class="n">binary_to_image</span> <span class="o">=</span> <span class="n">BinaryToImage</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="n">remove_objects</span> <span class="o">=</span> <span class="n">ImageRemoveObjects</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"corrected_image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setMinSizeObject</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">PipelineModel</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
    <span class="n">binary_to_image</span><span class="p">,</span>
    <span class="n">remove_objects</span>
<span class="p">])</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div>  </div>

</div>

<h3 id="imagemorphologyoperation">ImageMorphologyOperation</h3>

<p><strong>python only</strong></p>

<p><code class="language-plaintext highlighter-rouge">ImageMorphologyOperation</code>is a transformer for applying morphological operations to image.</p>

<p>It supports following operation:</p>
<ul>
  <li>Erosion</li>
  <li>Dilation</li>
  <li>Opening</li>
  <li>Closing</li>
</ul>

<h4 id="input-columns-24">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>None</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<h4 id="parameters-13">Parameters</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>operation</td>
      <td><a href="ocr_structures#morphologyoperationtype">MorphologyOperationType</a></td>
      <td>MorphologyOperationType.OPENING</td>
      <td>Operation type</td>
    </tr>
    <tr>
      <td>kernelShape</td>
      <td><a href="ocr_structures#kernelshape">KernelShape</a></td>
      <td>KernelShape.DISK</td>
      <td>Kernel shape.</td>
    </tr>
    <tr>
      <td>kernelSize</td>
      <td>int</td>
      <td>1</td>
      <td>Kernel size in pixels.</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-24">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>None</td>
      <td>scaled image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Implemented only for Python</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">PipelineModel</span>
<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> 
    <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span>
    <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>

<span class="n">binary_to_image</span> <span class="o">=</span> <span class="n">BinaryToImage</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOperation</span><span class="p">(</span><span class="n">MorphologyOperationType</span><span class="p">.</span><span class="n">OPENING</span><span class="p">)</span>

<span class="n">adaptive_thresholding</span> <span class="o">=</span> <span class="n">ImageAdaptiveThresholding</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"corrected_image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setBlockSize</span><span class="p">(</span><span class="mi">75</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOffset</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">opening</span> <span class="o">=</span> <span class="n">ImageMorphologyOperation</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"corrected_image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"opening_image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setkernelSize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">PipelineModel</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
    <span class="n">binary_to_image</span><span class="p">,</span>
    <span class="n">adaptive_thresholding</span><span class="p">,</span>
    <span class="n">opening</span>
<span class="p">])</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"image"</span><span class="p">,</span> <span class="s">"corrected_image"</span><span class="p">).</span><span class="n">collect</span><span class="p">():</span>
    <span class="n">display_image</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">image</span><span class="p">)</span>
    <span class="n">display_image</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">corrected_image</span><span class="p">)</span>
</code></pre></div>  </div>

</div>

<p><strong>Original image:</strong></p>

<p><img src="/assets/images/ocr/text_with_noise.png" alt="original" /></p>

<p><strong>Opening image:</strong></p>

<p><img src="/assets/images/ocr/opening.png" alt="opening" /></p>

<h3 id="imagecropper">ImageCropper</h3>

<p><code class="language-plaintext highlighter-rouge">ImageCropper</code>is a transformer for cropping image.</p>

<h4 id="input-columns-25">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<h4 id="parameters-14">Parameters</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>cropRectangle</td>
      <td>Rectangle</td>
      <td>Rectangle(0,0,0,0)</td>
      <td>Image rectangle.</td>
    </tr>
    <tr>
      <td>cropSquareType</td>
      <td><a href="ocr_structures#cropsquaretype">CropSquareType</a></td>
      <td>CropSquareType.TOP_LEFT</td>
      <td>Type of square.</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-25">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>cropped_image</td>
      <td>scaled image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.ImageAdaptiveScaler</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.OcrContext.implicits._</span>
<span class="k">import</span> <span class="nn">java.awt.Rectangle</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
  <span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">asImage</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">rectangle</span><span class="k">:</span> <span class="kt">Rectangle</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Rectangle</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">200</span><span class="o">,</span> <span class="mi">110</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">cropper</span><span class="k">:</span> <span class="kt">ImageCropper</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ImageCropper</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"cropped_image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setCropRectangle</span><span class="o">(</span><span class="n">rectangle</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">transformer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
<span class="nv">data</span><span class="o">.</span><span class="py">storeImage</span><span class="o">(</span><span class="s">"cropped_image"</span><span class="o">)</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">PipelineModel</span>
<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> 
    <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span>
    <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>

<span class="n">binary_to_image</span> <span class="o">=</span> <span class="n">BinaryToImage</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOperation</span><span class="p">(</span><span class="n">MorphologyOperationType</span><span class="p">.</span><span class="n">OPENING</span><span class="p">)</span>

<span class="n">cropper</span> <span class="o">=</span> <span class="n">ImageCropper</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"cropped_image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setCropRectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">110</span><span class="p">))</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">PipelineModel</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
    <span class="n">binary_to_image</span><span class="p">,</span>
    <span class="n">cropper</span>
<span class="p">])</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"image"</span><span class="p">,</span> <span class="s">"cropped_image"</span><span class="p">).</span><span class="n">collect</span><span class="p">():</span>
    <span class="n">display_image</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">image</span><span class="p">)</span>
    <span class="n">display_image</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">cropped_image</span><span class="p">)</span>
</code></pre></div>  </div>

</div>

<h3 id="splitting-image-to-regions">Splitting image to regions</h3>

<h3 id="imagelayoutanalyzer">ImageLayoutAnalyzer</h3>

<p><code class="language-plaintext highlighter-rouge">ImageLayoutAnalyzer</code> analyzes the image and determines regions of text.</p>

<h4 id="input-columns-26">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<h4 id="parameters-15">Parameters</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>pageSegMode</td>
      <td><a href="ocr_structures#pagesegmentationmode">PageSegmentationMode</a></td>
      <td>AUTO</td>
      <td>page segmentation mode</td>
    </tr>
    <tr>
      <td>pageIteratorLevel</td>
      <td><a href="ocr_structures#pageiteratorlevel">PageIteratorLevel</a></td>
      <td>BLOCK</td>
      <td>page iteration level</td>
    </tr>
    <tr>
      <td>ocrEngineMode</td>
      <td><a href="ocr_structures#enginemode">EngineMode</a></td>
      <td>LSTM_ONLY</td>
      <td>OCR engine mode</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-26">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>region</td>
      <td>array of [Coordinaties]ocr_structures#coordinate-schema)</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span>

<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.</span><span class="o">{</span><span class="nc">ImageSplitRegions</span><span class="o">,</span> <span class="nc">ImageLayoutAnalyzer</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.OcrContext.implicits._</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
  <span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">asImage</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="c1">// Define transformer for detect regions</span>
<span class="k">val</span> <span class="nv">layoutAnalyzer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageLayoutAnalyzer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"regions"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">layoutAnalyzer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nv">data</span><span class="o">.</span><span class="py">show</span><span class="o">()</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">PipelineModel</span>
<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> 
    <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span>
    <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>

<span class="n">binary_to_image</span> <span class="o">=</span> <span class="n">BinaryToImage</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="c1"># Define transformer for detect regions
</span><span class="n">layout_analyzer</span> <span class="o">=</span> <span class="n">ImageLayoutAnalyzer</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"regions"</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">PipelineModel</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
    <span class="n">binary_to_image</span><span class="p">,</span>
    <span class="n">layout_analyzer</span>
<span class="p">])</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">data</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<h3 id="imagesplitregions">ImageSplitRegions</h3>

<p><code class="language-plaintext highlighter-rouge">ImageSplitRegions</code> splits image to regions.</p>

<h4 id="input-columns-27">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
    <tr>
      <td>inputRegionsCol</td>
      <td>string</td>
      <td>region</td>
      <td>array of [Coordinaties]ocr_structures#coordinate-schema)</td>
    </tr>
  </tbody>
</table>

<h4 id="parameters-16">Parameters</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>explodeCols</td>
      <td>Array[string]</td>
      <td> </td>
      <td>Columns which need to explode</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-27">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>region_image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span>

<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.</span><span class="o">{</span><span class="nc">ImageSplitRegions</span><span class="o">,</span> <span class="nc">ImageLayoutAnalyzer</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.OcrContext.implicits._</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
  <span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">asImage</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="c1">// Define transformer for detect regions</span>
<span class="k">val</span> <span class="nv">layoutAnalyzer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageLayoutAnalyzer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"regions"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">splitter</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageSplitRegions</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setRegionCol</span><span class="o">(</span><span class="s">"regions"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"region_image"</span><span class="o">)</span>

<span class="c1">// Define pipeline</span>
<span class="k">val</span> <span class="nv">pipeline</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pipeline</span><span class="o">()</span>
<span class="nv">pipeline</span><span class="o">.</span><span class="py">setStages</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span>
  <span class="n">layoutAnalyzer</span><span class="o">,</span>
  <span class="n">splitter</span>
<span class="o">))</span>

<span class="k">val</span> <span class="nv">modelPipeline</span> <span class="k">=</span> <span class="nv">pipeline</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="nv">spark</span><span class="o">.</span><span class="py">emptyDataFrame</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">pipeline</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
<span class="nv">data</span><span class="o">.</span><span class="py">show</span><span class="o">()</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">PipelineModel</span>
<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> 
    <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span>
    <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>

<span class="n">binary_to_image</span> <span class="o">=</span> <span class="n">BinaryToImage</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="c1"># Define transformer for detect regions
</span><span class="n">layout_analyzer</span> <span class="o">=</span> <span class="n">ImageLayoutAnalyzer</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"regions"</span><span class="p">)</span>

<span class="n">splitter</span> <span class="o">=</span> <span class="n">ImageSplitRegions</span><span class="p">()</span>
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>
  <span class="p">.</span><span class="n">setRegionCol</span><span class="p">(</span><span class="s">"regions"</span><span class="p">)</span>
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"region_image"</span><span class="p">)</span>

<span class="c1"># Define pipeline
</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">PipelineModel</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
    <span class="n">binary_to_image</span><span class="p">,</span>
    <span class="n">layout_analyzer</span><span class="p">,</span>
    <span class="n">splitter</span>
<span class="p">])</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">data</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<h3 id="imagedrawannotations">ImageDrawAnnotations</h3>

<p><code class="language-plaintext highlighter-rouge">ImageDrawAnnotations</code> draw annotations with label and score to the image.</p>

<h4 id="input-columns-28">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
    <tr>
      <td>inputChunksCol</td>
      <td>string</td>
      <td>region</td>
      <td>array of Annotation</td>
    </tr>
  </tbody>
</table>

<h4 id="parameters-17">Parameters</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>lineWidth</td>
      <td>Int</td>
      <td>4</td>
      <td>Line width for draw rectangles</td>
    </tr>
    <tr>
      <td>fontSize</td>
      <td>Int</td>
      <td>12</td>
      <td>Font size for render labels and score</td>
    </tr>
    <tr>
      <td>rectColor</td>
      <td>Color</td>
      <td>Color.black</td>
      <td>Color of lines</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-28">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>image_with_chunks</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.</span><span class="o">*</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.OcrContext.implicits._</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
  <span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">asImage</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">imageToHocr</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageToHocr</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"hocr"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">tokenizer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">HocrTokenizer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"hocr"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"token"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">draw_annotations</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageDrawAnnotations</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setInputChunksCol</span><span class="o">(</span><span class="s">"token"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"image_with_annotations"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setFilledRect</span><span class="o">(</span><span class="nc">False</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setFontSize</span><span class="o">(</span><span class="mi">40</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setRectColor</span><span class="o">(</span><span class="nv">Color</span><span class="o">.</span><span class="py">red</span><span class="o">)</span>


<span class="k">val</span> <span class="nv">pipeline</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pipeline</span><span class="o">()</span>
<span class="nv">pipeline</span><span class="o">.</span><span class="py">setStages</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span>
  <span class="n">imageToHocr</span><span class="o">,</span>
  <span class="n">tokenizer</span><span class="o">,</span>
  <span class="n">draw_annotations</span>
<span class="o">))</span>

<span class="k">val</span> <span class="nv">modelPipeline</span> <span class="k">=</span> <span class="nv">pipeline</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">result</span> <span class="k">=</span>  <span class="nv">modelPipeline</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">PipelineModel</span>
<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> 
    <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span>
    <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>

<span class="n">binary_to_image</span> <span class="o">=</span> <span class="n">BinaryToImage</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="n">ocr</span> <span class="o">=</span> <span class="n">ImageToHocr</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"hocr"</span><span class="p">)</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">HocrTokenizer</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"hocr"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"token"</span><span class="p">)</span>

<span class="n">draw_annotations</span> <span class="o">=</span> <span class="n">ImageDrawAnnotations</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setInputChunksCol</span><span class="p">(</span><span class="s">"token"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image_with_annotations"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setFilledRect</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setFontSize</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setRectColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">red</span><span class="p">)</span>


<span class="c1"># Define pipeline
</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">PipelineModel</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
    <span class="n">binary_to_image</span><span class="p">,</span>
    <span class="n">ocr</span><span class="p">,</span>
    <span class="n">tokenizer</span><span class="p">,</span>
    <span class="n">image_with_annotations</span>
<span class="p">])</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div>  </div>

</div>

<h3 id="imagedrawregions">ImageDrawRegions</h3>

<p><code class="language-plaintext highlighter-rouge">ImageDrawRegions</code> draw regions with label and score to the image.</p>

<h4 id="input-columns-29">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
    <tr>
      <td>inputRegionsCol</td>
      <td>string</td>
      <td>region</td>
      <td>array of [Coordinaties]ocr_structures#coordinate-schema)</td>
    </tr>
  </tbody>
</table>

<h4 id="parameters-18">Parameters</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>lineWidth</td>
      <td>Int</td>
      <td>4</td>
      <td>Line width for draw rectangles</td>
    </tr>
    <tr>
      <td>fontSize</td>
      <td>Int</td>
      <td>12</td>
      <td>Font size for render labels and score</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-29">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>image_with_regions</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span>

<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.</span><span class="o">{</span><span class="nc">ImageSplitRegions</span><span class="o">,</span> <span class="nc">ImageLayoutAnalyzer</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.OcrContext.implicits._</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
  <span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">asImage</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="c1">// Define transformer for detect regions</span>
<span class="k">val</span> <span class="nv">layoutAnalyzer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageLayoutAnalyzer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"regions"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">draw</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageDrawRegions</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setRegionCol</span><span class="o">(</span><span class="s">"regions"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"image_with_regions"</span><span class="o">)</span>

<span class="c1">// Define pipeline</span>
<span class="k">val</span> <span class="nv">pipeline</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pipeline</span><span class="o">()</span>
<span class="nv">pipeline</span><span class="o">.</span><span class="py">setStages</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span>
  <span class="n">layoutAnalyzer</span><span class="o">,</span>
  <span class="n">draw</span>
<span class="o">))</span>

<span class="k">val</span> <span class="nv">modelPipeline</span> <span class="k">=</span> <span class="nv">pipeline</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="nv">spark</span><span class="o">.</span><span class="py">emptyDataFrame</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">pipeline</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
<span class="nv">data</span><span class="o">.</span><span class="py">show</span><span class="o">()</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">PipelineModel</span>
<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> 
    <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span>
    <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>

<span class="n">binary_to_image</span> <span class="o">=</span> <span class="n">BinaryToImage</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="c1"># Define transformer for detect regions
</span><span class="n">layout_analyzer</span> <span class="o">=</span> <span class="n">ImageLayoutAnalyzer</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"regions"</span><span class="p">)</span>

<span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDrawRegions</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setRegionCol</span><span class="p">(</span><span class="s">"regions"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image_with_regions"</span><span class="p">)</span>

<span class="c1"># Define pipeline
</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">PipelineModel</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
    <span class="n">binary_to_image</span><span class="p">,</span>
    <span class="n">layout_analyzer</span><span class="p">,</span>
    <span class="n">draw</span>
<span class="p">])</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">data</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<h2 id="characters-recognition">Characters recognition</h2>

<p>Next section describes the estimators for OCR</p>

<h3 id="imagetotext">ImageToText</h3>

<p><code class="language-plaintext highlighter-rouge">ImageToText</code> runs OCR for input image, return recognized text
to <em>outputCol</em> and positions with font size to ‘positionsCol’ column.</p>

<h4 id="input-columns-30">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<h4 id="parameters-19">Parameters</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>pageSegMode</td>
      <td><a href="ocr_structures#pagesegmentationmode">PageSegmentationMode</a></td>
      <td>AUTO</td>
      <td>page segmentation mode</td>
    </tr>
    <tr>
      <td>pageIteratorLevel</td>
      <td><a href="ocr_structures#pageiteratorlevel">PageIteratorLevel</a></td>
      <td>BLOCK</td>
      <td>page iteration level</td>
    </tr>
    <tr>
      <td>ocrEngineMode</td>
      <td><a href="ocr_structures#enginemode">EngineMode</a></td>
      <td>LSTM_ONLY</td>
      <td>OCR engine mode</td>
    </tr>
    <tr>
      <td>language</td>
      <td><a href="ocr_structures#language">Language</a></td>
      <td>Language.ENG</td>
      <td>language</td>
    </tr>
    <tr>
      <td>confidenceThreshold</td>
      <td>int</td>
      <td>0</td>
      <td>Confidence threshold.</td>
    </tr>
    <tr>
      <td>ignoreResolution</td>
      <td>bool</td>
      <td>false</td>
      <td>Ignore resolution from metadata of image.</td>
    </tr>
    <tr>
      <td>ocrParams</td>
      <td>array of strings</td>
      <td>[]</td>
      <td>Array of Ocr params in key=value format.</td>
    </tr>
    <tr>
      <td>pdfCoordinates</td>
      <td>bool</td>
      <td>false</td>
      <td>Transform coordinates in positions to PDF points.</td>
    </tr>
    <tr>
      <td>modelData</td>
      <td>string</td>
      <td> </td>
      <td>Path to the local model data.</td>
    </tr>
    <tr>
      <td>modelType</td>
      <td><a href="ocr_structures#modeltype">ModelType</a></td>
      <td>ModelType.BASE</td>
      <td>Model type</td>
    </tr>
    <tr>
      <td>downloadModelData</td>
      <td>bool</td>
      <td>false</td>
      <td>Download model data from JSL S3</td>
    </tr>
    <tr>
      <td>withSpaces</td>
      <td>bool</td>
      <td>false</td>
      <td>Include spaces to output positions.</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-30">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>text</td>
      <td>Recognized text</td>
    </tr>
    <tr>
      <td>positionsCol</td>
      <td>string</td>
      <td>positions</td>
      <td>Positions of each block of text (related to <code class="language-plaintext highlighter-rouge">pageIteratorLevel</code>) in <a href="ocr_structures#pagematrix">PageMatrix</a></td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.ImageToText</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.OcrContext.implicits._</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
  <span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">asImage</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">transformer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageToText</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"text"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOcrParams</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"preserve_interword_spaces=1"</span><span class="o">))</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">transformer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
<span class="nf">print</span><span class="o">(</span><span class="nv">data</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"text"</span><span class="o">).</span><span class="py">collect</span><span class="o">()[</span><span class="err">0</span><span class="o">].</span><span class="py">text</span><span class="o">)</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">PipelineModel</span>
<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> 
    <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span>
    <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>

<span class="n">binary_to_image</span> <span class="o">=</span> <span class="n">BinaryToImage</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="n">ocr</span> <span class="o">=</span> <span class="n">ImageToText</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"text"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOcrParams</span><span class="p">([</span><span class="s">"preserve_interword_spaces=1"</span><span class="p">,</span> <span class="p">])</span>

<span class="c1"># Define pipeline
</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">PipelineModel</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
    <span class="n">binary_to_image</span><span class="p">,</span>
    <span class="n">ocr</span>
<span class="p">])</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">data</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<p><strong>Image:</strong></p>

<p><img src="/assets/images/ocr/corrected.png" alt="image" /></p>

<p><strong>Output:</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FOREWORD

Electronic design engineers are the true idea men of the electronic
industries. They create ideas and use them in their designs, they stimu-
late ideas in other designers, and they borrow and adapt ideas from
others. One could almost say they feed on and grow on ideas.
</code></pre></div></div>

<h3 id="imagetotextpdf">ImageToTextPdf</h3>

<p><code class="language-plaintext highlighter-rouge">ImageToTextPdf</code> runs OCR for input image, render recognized text to 
the PDF as an invisible text layout with an original image.</p>

<h4 id="input-columns-31">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
    <tr>
      <td>originCol</td>
      <td>string</td>
      <td>path</td>
      <td>path to the original file</td>
    </tr>
    <tr>
      <td>pageNumCol</td>
      <td>string</td>
      <td>pagenum</td>
      <td>for compatibility with another transformers</td>
    </tr>
  </tbody>
</table>

<h4 id="parameters-20">Parameters</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ocrParams</td>
      <td>array of strings</td>
      <td>[]</td>
      <td>Array of Ocr params in key=value format.</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-31">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>pdf</td>
      <td>Recognized text rendered to PDF</td>
    </tr>
  </tbody>
</table>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.</span><span class="o">*</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.OcrContext.implicits._</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
  <span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">asImage</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">transformer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageToTextPdf</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"pdf"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">transformer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
<span class="nv">data</span><span class="o">.</span><span class="py">show</span><span class="o">()</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">PipelineModel</span>
<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> 
    <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span>
    <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>

<span class="n">binary_to_image</span> <span class="o">=</span> <span class="n">BinaryToImage</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="n">ocr</span> <span class="o">=</span> <span class="n">ImageToTextPdf</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"pdf"</span><span class="p">)</span>

<span class="c1"># Define pipeline
</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">PipelineModel</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
    <span class="n">binary_to_image</span><span class="p">,</span>
    <span class="n">ocr</span>
<span class="p">])</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">data</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<h3 id="imagetohocr">ImageToHocr</h3>

<p><code class="language-plaintext highlighter-rouge">ImageToHocr</code> runs OCR for input image, return recognized text and bounding boxes
to <em>outputCol</em> column in HOCR format.</p>

<h4 id="input-columns-32">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<h4 id="parameters-21">Parameters</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>pageSegMode</td>
      <td><a href="ocr_structures#pagesegmentationmode">PageSegmentationMode</a></td>
      <td>AUTO</td>
      <td>page segmentation mode</td>
    </tr>
    <tr>
      <td>pageIteratorLevel</td>
      <td><a href="ocr_structures#pageiteratorlevel">PageIteratorLevel</a></td>
      <td>BLOCK</td>
      <td>page iteration level</td>
    </tr>
    <tr>
      <td>ocrEngineMode</td>
      <td><a href="ocr_structures#enginemode">EngineMode</a></td>
      <td>LSTM_ONLY</td>
      <td>OCR engine mode</td>
    </tr>
    <tr>
      <td>language</td>
      <td>string</td>
      <td>eng</td>
      <td>language</td>
    </tr>
    <tr>
      <td>ignoreResolution</td>
      <td>bool</td>
      <td>true</td>
      <td>Ignore resolution from metadata of image.</td>
    </tr>
    <tr>
      <td>ocrParams</td>
      <td>array of strings</td>
      <td>[]</td>
      <td>Array of Ocr params in key=value format.</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-32">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>hocr</td>
      <td>Recognized text</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.ImageToHocr</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.OcrContext.implicits._</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
  <span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">asImage</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">transformer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageToHocr</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"hocr"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">transformer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
<span class="nf">print</span><span class="o">(</span><span class="nv">data</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"hocr"</span><span class="o">).</span><span class="py">collect</span><span class="o">()[</span><span class="err">0</span><span class="o">].</span><span class="py">hocr</span><span class="o">)</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">PipelineModel</span>
<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> 
    <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span>
    <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>

<span class="n">binary_to_image</span> <span class="o">=</span> <span class="n">BinaryToImage</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="n">ocr</span> <span class="o">=</span> <span class="n">ImageToHocr</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"hocr"</span><span class="p">)</span>

<span class="c1"># Define pipeline
</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">PipelineModel</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
    <span class="n">binary_to_image</span><span class="p">,</span>
    <span class="n">ocr</span>
<span class="p">])</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">data</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<p><strong>Image:</strong></p>

<p><img src="/assets/images/ocr/corrected.png" alt="image" /></p>

<p><strong>Output:</strong></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'ocr_page'</span> <span class="na">id=</span><span class="s">'page_1'</span> <span class="na">title=</span><span class="s">'image ""; bbox 0 0 1280 467; ppageno 0'</span><span class="nt">&gt;</span>
   <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'ocr_carea'</span> <span class="na">id=</span><span class="s">'block_1_1'</span> <span class="na">title=</span><span class="s">"bbox 516 80 780 114"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">'ocr_par'</span> <span class="na">id=</span><span class="s">'par_1_1'</span> <span class="na">lang=</span><span class="s">'eng'</span> <span class="na">title=</span><span class="s">"bbox 516 80 780 114"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocr_line'</span> <span class="na">id=</span><span class="s">'line_1_1'</span> <span class="na">title=</span><span class="s">"bbox 516 80 780 114; baseline 0 -1; x_size 44; x_descenders 11; x_ascenders 11"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_1'</span> <span class="na">title=</span><span class="s">'bbox 516 80 780 114; x_wconf 96'</span><span class="nt">&gt;</span>FOREWORD<span class="nt">&lt;/span&gt;</span>
     <span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/p&gt;</span>
   <span class="nt">&lt;/div&gt;</span>
   <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'ocr_carea'</span> <span class="na">id=</span><span class="s">'block_1_2'</span> <span class="na">title=</span><span class="s">"bbox 40 237 1249 425"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">'ocr_par'</span> <span class="na">id=</span><span class="s">'par_1_2'</span> <span class="na">lang=</span><span class="s">'eng'</span> <span class="na">title=</span><span class="s">"bbox 40 237 1249 425"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocr_line'</span> <span class="na">id=</span><span class="s">'line_1_2'</span> <span class="na">title=</span><span class="s">"bbox 122 237 1249 282; baseline 0.001 -12; x_size 45; x_descenders 12; x_ascenders 13"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_2'</span> <span class="na">title=</span><span class="s">'bbox 122 237 296 270; x_wconf 96'</span><span class="nt">&gt;</span>Electronic<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_3'</span> <span class="na">title=</span><span class="s">'bbox 308 237 416 281; x_wconf 96'</span><span class="nt">&gt;</span>design<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_4'</span> <span class="na">title=</span><span class="s">'bbox 428 243 588 282; x_wconf 96'</span><span class="nt">&gt;</span>engineers<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_5'</span> <span class="na">title=</span><span class="s">'bbox 600 250 653 271; x_wconf 96'</span><span class="nt">&gt;</span>are<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_6'</span> <span class="na">title=</span><span class="s">'bbox 665 238 718 271; x_wconf 96'</span><span class="nt">&gt;</span>the<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_7'</span> <span class="na">title=</span><span class="s">'bbox 731 246 798 272; x_wconf 97'</span><span class="nt">&gt;</span>true<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_8'</span> <span class="na">title=</span><span class="s">'bbox 810 238 880 271; x_wconf 96'</span><span class="nt">&gt;</span>idea<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_9'</span> <span class="na">title=</span><span class="s">'bbox 892 251 963 271; x_wconf 96'</span><span class="nt">&gt;</span>men<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_10'</span> <span class="na">title=</span><span class="s">'bbox 977 238 1010 272; x_wconf 96'</span><span class="nt">&gt;</span>of<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_11'</span> <span class="na">title=</span><span class="s">'bbox 1021 238 1074 271; x_wconf 96'</span><span class="nt">&gt;</span>the<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_12'</span> <span class="na">title=</span><span class="s">'bbox 1086 239 1249 272; x_wconf 96'</span><span class="nt">&gt;</span>electronic<span class="nt">&lt;/span&gt;</span>
     <span class="nt">&lt;/span&gt;</span>
     <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocr_line'</span> <span class="na">id=</span><span class="s">'line_1_3'</span> <span class="na">title=</span><span class="s">"bbox 41 284 1248 330; baseline 0.002 -13; x_size 44; x_descenders 11; x_ascenders 12"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_13'</span> <span class="na">title=</span><span class="s">'bbox 41 284 214 318; x_wconf 96'</span><span class="nt">&gt;</span>industries.<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_14'</span> <span class="na">title=</span><span class="s">'bbox 227 284 313 328; x_wconf 96'</span><span class="nt">&gt;</span>They<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_15'</span> <span class="na">title=</span><span class="s">'bbox 324 292 427 319; x_wconf 96'</span><span class="nt">&gt;</span>create<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_16'</span> <span class="na">title=</span><span class="s">'bbox 440 285 525 319; x_wconf 96'</span><span class="nt">&gt;</span>ideas<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_17'</span> <span class="na">title=</span><span class="s">'bbox 537 286 599 318; x_wconf 96'</span><span class="nt">&gt;</span>and<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_18'</span> <span class="na">title=</span><span class="s">'bbox 611 298 668 319; x_wconf 96'</span><span class="nt">&gt;</span>use<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_19'</span> <span class="na">title=</span><span class="s">'bbox 680 286 764 319; x_wconf 96'</span><span class="nt">&gt;</span>them<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_20'</span> <span class="na">title=</span><span class="s">'bbox 777 291 808 319; x_wconf 96'</span><span class="nt">&gt;</span>in<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_21'</span> <span class="na">title=</span><span class="s">'bbox 821 286 900 319; x_wconf 96'</span><span class="nt">&gt;</span>their<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_22'</span> <span class="na">title=</span><span class="s">'bbox 912 286 1044 330; x_wconf 96'</span><span class="nt">&gt;</span>designs,<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_23'</span> <span class="na">title=</span><span class="s">'bbox 1058 286 1132 330; x_wconf 93'</span><span class="nt">&gt;</span>they<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_24'</span> <span class="na">title=</span><span class="s">'bbox 1144 291 1248 320; x_wconf 92'</span><span class="nt">&gt;</span>stimu-<span class="nt">&lt;/span&gt;</span>
     <span class="nt">&lt;/span&gt;</span>
     <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocr_line'</span> <span class="na">id=</span><span class="s">'line_1_4'</span> <span class="na">title=</span><span class="s">"bbox 42 332 1247 378; baseline 0.002 -14; x_size 44; x_descenders 12; x_ascenders 12"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_25'</span> <span class="na">title=</span><span class="s">'bbox 42 332 103 364; x_wconf 97'</span><span class="nt">&gt;</span>late<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_26'</span> <span class="na">title=</span><span class="s">'bbox 120 332 204 365; x_wconf 96'</span><span class="nt">&gt;</span>ideas<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_27'</span> <span class="na">title=</span><span class="s">'bbox 223 337 252 365; x_wconf 96'</span><span class="nt">&gt;</span>in<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_28'</span> <span class="na">title=</span><span class="s">'bbox 271 333 359 365; x_wconf 96'</span><span class="nt">&gt;</span>other<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_29'</span> <span class="na">title=</span><span class="s">'bbox 376 333 542 377; x_wconf 96'</span><span class="nt">&gt;</span>designers,<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_30'</span> <span class="na">title=</span><span class="s">'bbox 561 334 625 366; x_wconf 96'</span><span class="nt">&gt;</span>and<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_31'</span> <span class="na">title=</span><span class="s">'bbox 643 334 716 377; x_wconf 96'</span><span class="nt">&gt;</span>they<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_32'</span> <span class="na">title=</span><span class="s">'bbox 734 334 855 366; x_wconf 96'</span><span class="nt">&gt;</span>borrow<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_33'</span> <span class="na">title=</span><span class="s">'bbox 873 334 934 366; x_wconf 96'</span><span class="nt">&gt;</span>and<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_34'</span> <span class="na">title=</span><span class="s">'bbox 954 335 1048 378; x_wconf 96'</span><span class="nt">&gt;</span>adapt<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_35'</span> <span class="na">title=</span><span class="s">'bbox 1067 334 1151 367; x_wconf 96'</span><span class="nt">&gt;</span>ideas<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_36'</span> <span class="na">title=</span><span class="s">'bbox 1169 334 1247 367; x_wconf 96'</span><span class="nt">&gt;</span>from<span class="nt">&lt;/span&gt;</span>
     <span class="nt">&lt;/span&gt;</span>
     <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocr_line'</span> <span class="na">id=</span><span class="s">'line_1_5'</span> <span class="na">title=</span><span class="s">"bbox 40 379 1107 425; baseline 0.002 -13; x_size 45; x_descenders 12; x_ascenders 12"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_37'</span> <span class="na">title=</span><span class="s">'bbox 40 380 151 412; x_wconf 96'</span><span class="nt">&gt;</span>others.<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_38'</span> <span class="na">title=</span><span class="s">'bbox 168 383 238 412; x_wconf 96'</span><span class="nt">&gt;</span>One<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_39'</span> <span class="na">title=</span><span class="s">'bbox 252 379 345 412; x_wconf 96'</span><span class="nt">&gt;</span>could<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_40'</span> <span class="na">title=</span><span class="s">'bbox 359 380 469 413; x_wconf 96'</span><span class="nt">&gt;</span>almost<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_41'</span> <span class="na">title=</span><span class="s">'bbox 483 392 537 423; x_wconf 96'</span><span class="nt">&gt;</span>say<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_42'</span> <span class="na">title=</span><span class="s">'bbox 552 381 626 424; x_wconf 96'</span><span class="nt">&gt;</span>they<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_43'</span> <span class="na">title=</span><span class="s">'bbox 641 381 712 414; x_wconf 96'</span><span class="nt">&gt;</span>feed<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_44'</span> <span class="na">title=</span><span class="s">'bbox 727 393 767 414; x_wconf 96'</span><span class="nt">&gt;</span>on<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_45'</span> <span class="na">title=</span><span class="s">'bbox 783 381 845 414; x_wconf 96'</span><span class="nt">&gt;</span>and<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_46'</span> <span class="na">title=</span><span class="s">'bbox 860 392 945 425; x_wconf 97'</span><span class="nt">&gt;</span>grow<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_47'</span> <span class="na">title=</span><span class="s">'bbox 959 393 999 414; x_wconf 96'</span><span class="nt">&gt;</span>on<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'ocrx_word'</span> <span class="na">id=</span><span class="s">'word_1_48'</span> <span class="na">title=</span><span class="s">'bbox 1014 381 1107 414; x_wconf 95'</span><span class="nt">&gt;</span>ideas.<span class="nt">&lt;/span&gt;</span>
     <span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/p&gt;</span>
   <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<h3 id="imagebrandstotext">ImageBrandsToText</h3>

<p><code class="language-plaintext highlighter-rouge">ImageBrandsToText</code> runs OCR for specified brands of input image, return recognized text
to <em>outputCol</em> and positions with font size to ‘positionsCol’ column.</p>

<h4 id="input-columns-33">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>image</td>
      <td>image struct (<a href="ocr_structures#image-schema">Image schema</a>)</td>
    </tr>
  </tbody>
</table>

<h4 id="parameters-22">Parameters</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>pageSegMode</td>
      <td><a href="ocr_structures#pagesegmentationmode">PageSegmentationMode</a></td>
      <td>AUTO</td>
      <td>page segmentation mode</td>
    </tr>
    <tr>
      <td>pageIteratorLevel</td>
      <td><a href="ocr_structures#pageiteratorlevel">PageIteratorLevel</a></td>
      <td>BLOCK</td>
      <td>page iteration level</td>
    </tr>
    <tr>
      <td>ocrEngineMode</td>
      <td><a href="ocr_structures#enginemode">EngineMode</a></td>
      <td>LSTM_ONLY</td>
      <td>OCR engine mode</td>
    </tr>
    <tr>
      <td>language</td>
      <td>string</td>
      <td>eng</td>
      <td>language</td>
    </tr>
    <tr>
      <td>confidenceThreshold</td>
      <td>int</td>
      <td>0</td>
      <td>Confidence threshold.</td>
    </tr>
    <tr>
      <td>ignoreResolution</td>
      <td>bool</td>
      <td>true</td>
      <td>Ignore resolution from metadata of image.</td>
    </tr>
    <tr>
      <td>ocrParams</td>
      <td>array of strings</td>
      <td>[]</td>
      <td>Array of Ocr params in key=value format.</td>
    </tr>
    <tr>
      <td>brandsCoords</td>
      <td>string</td>
      <td> </td>
      <td>Json with coordinates of brands.</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-33">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>structure</td>
      <td>image_brands</td>
      <td>Structure with recognized text from brands.</td>
    </tr>
    <tr>
      <td>textCol</td>
      <td>string</td>
      <td>text</td>
      <td>Recognized text</td>
    </tr>
    <tr>
      <td>positionsCol</td>
      <td>string</td>
      <td>positions</td>
      <td>Positions of each block of text (related to <code class="language-plaintext highlighter-rouge">pageIteratorLevel</code>)</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.ImageToText</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.OcrContext.implicits._</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
  <span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">asImage</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">transformer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageBrandsToText</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"text"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setBrandsCoordsStr</span><span class="o">(</span>
        <span class="s">"""
          [
             {
                "name":"part_one",
                "rectangle":{
                   "x":286,
                   "y":65,
                   "width":542,
                   "height":342
                }
             },
             {
                "name":"part_two",
                "rectangle":{
                   "x":828,
                   "y":65,
                   "width":1126,
                   "height":329
                }
             }
          ]
          """</span><span class="o">.</span><span class="py">stripMargin</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">transformer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
<span class="nf">print</span><span class="o">(</span><span class="nv">data</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"text"</span><span class="o">).</span><span class="py">collect</span><span class="o">()[</span><span class="err">0</span><span class="o">].</span><span class="py">text</span><span class="o">)</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">PipelineModel</span>
<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> 
    <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span>
    <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>

<span class="n">binary_to_image</span> <span class="o">=</span> <span class="n">BinaryToImage</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="n">ocr</span> <span class="o">=</span> <span class="n">ImageBrandsToText</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"text"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setBrandsCoords</span><span class="p">(</span><span class="s">"""[
                     {
                        "name":"part_one",
                        "rectangle":{
                           "x":286,
                           "y":65,
                           "width":542,
                           "height":342
                        }
                     },
                     {
                        "name":"part_two",
                        "rectangle":{
                           "x":828,
                           "y":65,
                           "width":1126,
                           "height":329
                        }
                     }
                  ]"""</span><span class="p">)</span>

<span class="c1"># Define pipeline
</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">PipelineModel</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
    <span class="n">binary_to_image</span><span class="p">,</span>
    <span class="n">ocr</span>
<span class="p">])</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">data</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<h2 id="other">Other</h2>

<p>Next section describes the extra transformers</p>

<h3 id="positionfinder">PositionFinder</h3>

<p><code class="language-plaintext highlighter-rouge">PositionFinder</code> find position of input text entities in original document.</p>

<h4 id="input-columns-34">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCols</td>
      <td>string</td>
      <td>image</td>
      <td>Input annotations columns</td>
    </tr>
    <tr>
      <td>pageMatrixCol</td>
      <td>string</td>
      <td> </td>
      <td>Column name for Page Matrix schema</td>
    </tr>
  </tbody>
</table>

<h4 id="parameters-23">Parameters</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>matchingWindow</td>
      <td>int</td>
      <td>10</td>
      <td>Textual range to match in context, applies in both direction</td>
    </tr>
    <tr>
      <td>windowPageTolerance</td>
      <td>boolean</td>
      <td>true</td>
      <td>whether or not to increase tolerance as page number grows</td>
    </tr>
    <tr>
      <td>padding</td>
      <td>int</td>
      <td>5</td>
      <td>padding for area</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-34">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td> </td>
      <td>Name of output column for store coordinates.</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers._</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.nlp.</span><span class="o">{</span><span class="nc">DocumentAssembler</span><span class="o">,</span> <span class="nc">SparkAccessor</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.nlp.annotators._</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.nlp.util.io.ReadAs</span>

<span class="k">val</span> <span class="nv">pdfPath</span> <span class="k">=</span> <span class="s">"path to pdf"</span>

<span class="c1">// Read PDF file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">).</span><span class="py">load</span><span class="o">(</span><span class="n">pdfPath</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">pdfToText</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PdfToText</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"content"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"text"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setSplitPage</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">documentAssembler</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">DocumentAssembler</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"text"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"document"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">sentenceDetector</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SentenceDetector</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCols</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"document"</span><span class="o">))</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"sentence"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">tokenizer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Tokenizer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCols</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"sentence"</span><span class="o">))</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"token"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">entityExtractor</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">TextMatcher</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCols</span><span class="o">(</span><span class="s">"sentence"</span><span class="o">,</span> <span class="s">"token"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setEntities</span><span class="o">(</span><span class="s">"test-chunks.txt"</span><span class="o">,</span> <span class="nv">ReadAs</span><span class="o">.</span><span class="py">TEXT</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"entity"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">positionFinder</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PositionFinder</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCols</span><span class="o">(</span><span class="s">"entity"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"coordinates"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setPageMatrixCol</span><span class="o">(</span><span class="s">"positions"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setMatchingWindow</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setPadding</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>

<span class="c1">// Create pipeline</span>
<span class="k">val</span> <span class="nv">pipeline</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pipeline</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setStages</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span>
    <span class="n">pdfToText</span><span class="o">,</span>
    <span class="n">documentAssembler</span><span class="o">,</span>
    <span class="n">sentenceDetector</span><span class="o">,</span>
    <span class="n">tokenizer</span><span class="o">,</span>
    <span class="n">entityExtractor</span><span class="o">,</span>
    <span class="n">positionFinder</span>
  <span class="o">))</span>

<span class="k">val</span> <span class="nv">results</span> <span class="k">=</span> <span class="nv">pipeline</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nv">results</span><span class="o">.</span><span class="py">show</span><span class="o">()</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>

<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sparknlp.annotator</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sparknlp.base</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">pdfPath</span> <span class="o">=</span> <span class="s">"path to pdf"</span>

<span class="c1"># Read PDF file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="n">pdfPath</span><span class="p">)</span>

<span class="n">pdf_to_text</span> <span class="o">=</span> <span class="n">PdfToText</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"text"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setPageNumCol</span><span class="p">(</span><span class="s">"page"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setSplitPage</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

<span class="n">document_assembler</span> <span class="o">=</span> <span class="n">DocumentAssembler</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"text"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"document"</span><span class="p">)</span>

<span class="n">sentence_detector</span> <span class="o">=</span> <span class="n">SentenceDetector</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCols</span><span class="p">([</span><span class="s">"document"</span><span class="p">])</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"sentence"</span><span class="p">)</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCols</span><span class="p">([</span><span class="s">"sentence"</span><span class="p">])</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"token"</span><span class="p">)</span>

<span class="n">entity_extractor</span> <span class="o">=</span> <span class="n">TextMatcher</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCols</span><span class="p">(</span><span class="s">"sentence"</span><span class="p">,</span> <span class="s">"token"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setEntities</span><span class="p">(</span><span class="s">"./sparkocr/resources/test-chunks.txt"</span><span class="p">,</span> <span class="n">ReadAs</span><span class="p">.</span><span class="n">TEXT</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"entity"</span><span class="p">)</span>

<span class="n">position_finder</span> <span class="o">=</span> <span class="n">PositionFinder</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCols</span><span class="p">(</span><span class="s">"entity"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"coordinates"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setPageMatrixCol</span><span class="p">(</span><span class="s">"positions"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setMatchingWindow</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setPadding</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
    <span class="n">pdf_to_text</span><span class="p">,</span>
    <span class="n">document_assembler</span><span class="p">,</span>
    <span class="n">sentence_detector</span><span class="p">,</span>
    <span class="n">tokenizer</span><span class="p">,</span>
    <span class="n">entity_extractor</span><span class="p">,</span>
    <span class="n">position_finder</span>
<span class="p">])</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">).</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">results</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<h3 id="updatetextposition">UpdateTextPosition</h3>

<p><code class="language-plaintext highlighter-rouge">UpdateTextPosition</code> update output text and keep old coordinates of original document.</p>

<h4 id="input-columns-35">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>positions</td>
      <td>Сolumn name with original positions struct</td>
    </tr>
    <tr>
      <td>InputText</td>
      <td>string</td>
      <td>replace_text</td>
      <td>Column name for  New Text to replace Old one</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-35">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>output_positions</td>
      <td>Name of output column for updated positions struct.</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.nlp.annotators.Tokenizer</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.nlp.annotators.sbd.pragmatic.SentenceDetector</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.nlp.annotators.spell.norvig.NorvigSweetingModel</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.nlp.</span><span class="o">{</span><span class="nc">DocumentAssembler</span><span class="o">,</span> <span class="nc">TokenAssembler</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers._</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span>

<span class="k">val</span> <span class="nv">pdfPath</span> <span class="k">=</span> <span class="s">"path to pdf"</span>

<span class="c1">// Read PDF file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">).</span><span class="py">load</span><span class="o">(</span><span class="n">pdfPath</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">pdfToText</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PdfToText</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"content"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"text"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">documentAssembler</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">DocumentAssembler</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"text"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"document"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">sentence</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SentenceDetector</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCols</span><span class="o">(</span><span class="s">"document"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"sentence"</span><span class="o">)</span>
   
<span class="k">val</span> <span class="nv">token</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Tokenizer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCols</span><span class="o">(</span><span class="s">"document"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"tokens"</span><span class="o">)</span>
   
<span class="k">val</span> <span class="nv">spell</span> <span class="k">=</span> <span class="nv">NorvigSweetingModel</span><span class="o">.</span><span class="py">pretrained</span><span class="o">(</span><span class="s">"spellcheck_norvig"</span><span class="o">,</span> <span class="s">"en"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setInputCols</span><span class="o">(</span><span class="s">"tokens"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"spell"</span><span class="o">)</span>
    
<span class="k">val</span> <span class="nv">tokenAssem</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">TokenAssembler</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCols</span><span class="o">(</span><span class="s">"spell"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"newDocs"</span><span class="o">)</span>
    
<span class="k">val</span> <span class="nv">updatedText</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">UpdateTextPosition</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"positions"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"output_positions"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setInputText</span><span class="o">(</span><span class="s">"newDocs.result"</span><span class="o">)</span>
    
<span class="k">val</span> <span class="nv">pipeline</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pipeline</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setStages</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span>
    <span class="n">pdfToText</span><span class="o">,</span>
    <span class="n">documentAssembler</span><span class="o">,</span>
    <span class="n">sentence</span><span class="o">,</span>
    <span class="n">token</span><span class="o">,</span>
    <span class="n">spell</span><span class="o">,</span>
    <span class="n">tokenAssem</span><span class="o">,</span>
    <span class="n">updatedText</span>
  <span class="o">))</span>

<span class="k">val</span> <span class="nv">results</span> <span class="k">=</span> <span class="nv">pipeline</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nv">results</span><span class="o">.</span><span class="py">show</span><span class="o">()</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sparknlp.annotator</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sparknlp.base</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">pdfPath</span> <span class="o">=</span> <span class="s">"path to pdf"</span>

<span class="c1"># Read PDF file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="n">pdfPath</span><span class="p">)</span>

<span class="n">pdf_to_text</span> <span class="o">=</span> <span class="n">PdfToText</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"text"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setPageNumCol</span><span class="p">(</span><span class="s">"page"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setSplitPage</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

<span class="n">document_assembler</span> <span class="o">=</span> <span class="n">DocumentAssembler</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"text"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"document"</span><span class="p">)</span>

<span class="n">sentence_detector</span> <span class="o">=</span> <span class="n">SentenceDetector</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCols</span><span class="p">([</span><span class="s">"document"</span><span class="p">])</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"sentence"</span><span class="p">)</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCols</span><span class="p">([</span><span class="s">"sentence"</span><span class="p">])</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"tokens"</span><span class="p">)</span>

<span class="n">spell</span> <span class="o">=</span> <span class="n">NorvigSweetingModel</span><span class="p">().</span><span class="n">pretrained</span><span class="p">(</span><span class="s">"spellcheck_norvig"</span><span class="p">,</span> <span class="s">"en"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setInputCols</span><span class="p">(</span><span class="s">"tokens"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"spell"</span><span class="p">)</span>

<span class="n">tokenAssem</span> <span class="o">=</span> <span class="n">TokenAssembler</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCols</span><span class="p">(</span><span class="s">"spell"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"newDocs"</span><span class="p">)</span>

<span class="n">updatedText</span> <span class="o">=</span> <span class="n">UpdateTextPosition</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"positions"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"output_positions"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setInputText</span><span class="p">(</span><span class="s">"newDocs.result"</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
    <span class="n">document_assembler</span><span class="p">,</span>
    <span class="n">sentence_detector</span><span class="p">,</span>
    <span class="n">tokenizer</span><span class="p">,</span>
    <span class="n">spell</span><span class="p">,</span>
    <span class="n">tokenAssem</span><span class="p">,</span>
    <span class="n">updatedText</span>
<span class="p">])</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">).</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">results</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<h3 id="foundationonereportparser">FoundationOneReportParser</h3>

<p><code class="language-plaintext highlighter-rouge">FoundationOneReportParser</code> is a transformer for parsing FoundationOne reports.
Current implementation support parsing patient info, genomic, biomarker findings and gene lists
from appendix.
Output format is json.</p>

<h4 id="input-columns-36">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>text</td>
      <td>Сolumn name with text of report</td>
    </tr>
    <tr>
      <td>originCol</td>
      <td>string</td>
      <td>path</td>
      <td>path to the original file</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-36">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>report</td>
      <td>Name of output column with report in json format.</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers._</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span>

<span class="k">val</span> <span class="nv">pdfPath</span> <span class="k">=</span> <span class="s">"path to pdf"</span>

<span class="c1">// Read PDF file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">).</span><span class="py">load</span><span class="o">(</span><span class="n">pdfPath</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">pdfToText</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PdfToText</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"content"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"text"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setSplitPage</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setTextStripper</span><span class="o">(</span><span class="nv">TextStripperType</span><span class="o">.</span><span class="py">PDF_LAYOUT_TEXT_STRIPPER</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">genomicsParser</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">FoundationOneReportParser</span><span class="o">()</span>
      <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"text"</span><span class="o">)</span>
      <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"report"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">pipeline</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pipeline</span><span class="o">()</span>
<span class="nv">pipeline</span><span class="o">.</span><span class="py">setStages</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span>
  <span class="n">pdfToText</span><span class="o">,</span>
  <span class="n">genomicsParser</span>
<span class="o">))</span>

<span class="k">val</span> <span class="nv">modelPipeline</span> <span class="k">=</span> <span class="nv">pipeline</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">report</span> <span class="k">=</span>  <span class="nv">modelPipeline</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sparkocr.enums</span> <span class="kn">import</span> <span class="n">TextStripperType</span>


<span class="n">pdfPath</span> <span class="o">=</span> <span class="s">"path to pdf"</span>

<span class="c1"># Read PDF file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="n">pdfPath</span><span class="p">)</span>

<span class="n">pdf_to_text</span> <span class="o">=</span> <span class="n">PdfToText</span><span class="p">()</span>
<span class="n">pdf_to_text</span><span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span>
<span class="n">pdf_to_text</span><span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"text"</span><span class="p">)</span>
<span class="n">pdf_to_text</span><span class="p">.</span><span class="n">setSplitPage</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">pdf_to_text</span><span class="p">.</span><span class="n">setTextStripper</span><span class="p">(</span><span class="n">TextStripperType</span><span class="p">.</span><span class="n">PDF_LAYOUT_TEXT_STRIPPER</span><span class="p">)</span>

<span class="n">genomic_parser</span> <span class="o">=</span> <span class="n">FoundationOneReportParser</span><span class="p">()</span>
<span class="n">genomic_parser</span><span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"text"</span><span class="p">)</span>
<span class="n">genomic_parser</span><span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"report"</span><span class="p">)</span>

<span class="n">report</span> <span class="o">=</span> <span class="n">genomic_parser</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">pdf_to_text</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)).</span><span class="n">collect</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<p>Output:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"Patient"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"disease"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Unknown primary melanoma"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Lekavich Gloria"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"date_of_birth"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"11 November 1926"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"sex"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Female"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"medical_record"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"11111"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"Physician"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ordering_physician"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Genes Pinley"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"medical_facility"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Health Network Cancer Institute"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"additional_recipient"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Nath"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"medical_facility_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"202051"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pathologist"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Manqju Nwath"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"Specimen"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"specimen_site"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Rectum"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"specimen_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"AVS 1A"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"specimen_type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Slide"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"date_of_collection"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"20 March 2015"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"specimen_received"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"30 March 2015 "</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"Biomarker_findings"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Tumor Mutation Burden"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"TMB-Low (3Muts/Mb)"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"actionability"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"No therapies or clinical trials. "</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"Genomic_findings"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"FLT3"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"state"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"amplification"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"therapies_with_clinical_benefit_in_patient_tumor_type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"none"</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nl">"therapies_with_clinical_benefit_in_other_tumor_type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Sorafenib"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Sunitinib"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Ponatinib"</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
 </span><span class="p">],</span><span class="w">
 </span><span class="nl">"Appendix"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"dna_gene_list"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"ABL1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ACVR1B"</span><span class="p">,</span><span class="w"> </span><span class="s2">"AKT1"</span><span class="p">,</span><span class="w"> </span><span class="err">....</span><span class="w">  </span><span class="p">],</span><span class="w">
    </span><span class="nl">"dna_gene_list_rearrangement"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"ALK"</span><span class="p">,</span><span class="w"> </span><span class="s2">"BCL2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"BCR"</span><span class="p">,</span><span class="w"> </span><span class="err">....</span><span class="w">  </span><span class="p">],</span><span class="w">
    </span><span class="nl">"additional_assays"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Tumor Mutation  Burden  (TMB)"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Microsatellite  Status  (MS)"</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="hocrdocumentassembler">HocrDocumentAssembler</h2>

<p><code class="language-plaintext highlighter-rouge">HocrDocumentAssembler </code> prepares data into a format that is processable by Spark NLP.</p>

<p><strong>Output Annotator Type:</strong> DOCUMENT</p>

<h4 id="input-columns-37">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>hocr</td>
      <td>Сolumn name with HOCR of the document</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-37">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>document</td>
      <td>Name of output column.</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.</span><span class="o">*</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.OcrContext.implicits._</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
  <span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">asImage</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">imageToHocr</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageToHocr</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"hocr"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">hocrDocumentAssembler</span> <span class="k">=</span> <span class="nc">HocrDocumentAssembler</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"hocr"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"document"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">pipeline</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pipeline</span><span class="o">()</span>
<span class="nv">pipeline</span><span class="o">.</span><span class="py">setStages</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span>
  <span class="n">imageToHocr</span><span class="o">,</span>
  <span class="n">hocrDocumentAssembler</span>
<span class="o">))</span>

<span class="k">val</span> <span class="nv">modelPipeline</span> <span class="k">=</span> <span class="nv">pipeline</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">result</span> <span class="k">=</span>  <span class="nv">modelPipeline</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
<span class="nv">result</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"document"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">PipelineModel</span>
<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> 
    <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span>
    <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>

<span class="n">binary_to_image</span> <span class="o">=</span> <span class="n">BinaryToImage</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="n">ocr</span> <span class="o">=</span> <span class="n">ImageToHocr</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"hocr"</span><span class="p">)</span>

<span class="n">hocr_document_assembler</span> <span class="o">=</span> <span class="n">HocrDocumentAssembler</span><span class="p">()</span> \
  <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"hocr"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"document"</span><span class="p">)</span> 

<span class="c1"># Define pipeline
</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">PipelineModel</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
    <span class="n">binary_to_image</span><span class="p">,</span>
    <span class="n">ocr</span><span class="p">,</span>
    <span class="n">hocr_document_assembler</span>
<span class="p">])</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">result</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"document"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<p>Output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+--------------------------------------------------------------------+
| document                                                           |
+--------------------------------------------------------------------+
| [[document, 0, 4392, Patient Nam Financial Numbe Random Hospital...|
+--------------------------------------------------------------------+

</code></pre></div></div>

<h2 id="hocrtokenizer">HocrTokenizer</h2>

<p><code class="language-plaintext highlighter-rouge">HocrTokenizer</code> prepares into a format that is processable by Spark NLP.<br />
HocrTokenizer puts to metadata coordinates and ocr confidence.</p>

<p><strong>Output Annotator Type:</strong> TOKEN</p>

<h4 id="input-columns-38">Input Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>inputCol</td>
      <td>string</td>
      <td>hocr</td>
      <td>Сolumn name with HOCR of the document.</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-38">Output Columns</h4>

<table class="table-model-big">
  <thead>
    <tr>
      <th>Param name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Column Data Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>outputCol</td>
      <td>string</td>
      <td>token</td>
      <td>Name of output column.</td>
    </tr>
  </tbody>
</table>

<p><strong>Example:</strong></p>

<div class="tabs-box pt0">

  <div class="top_tab_li">   
    <button class="tab-li code-selector-active python-button">Python</button><button class="tab-li code-selector-un-active scala-button">Scala</button>
</div>

  <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.transformers.</span><span class="o">*</span>
<span class="k">import</span> <span class="nn">com.johnsnowlabs.ocr.OcrContext.implicits._</span>

<span class="k">val</span> <span class="nv">imagePath</span> <span class="k">=</span> <span class="s">"path to image"</span>

<span class="c1">// Read image file as binary file</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
  <span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"binaryFile"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">imagePath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">asImage</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">imageToHocr</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ImageToHocr</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"image"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"hocr"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">tokenizer</span> <span class="k">=</span> <span class="nc">HocrTokenizer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"hocr"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"token"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">pipeline</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pipeline</span><span class="o">()</span>
<span class="nv">pipeline</span><span class="o">.</span><span class="py">setStages</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span>
  <span class="n">imageToHocr</span><span class="o">,</span>
  <span class="n">tokenizer</span>
<span class="o">))</span>

<span class="k">val</span> <span class="nv">modelPipeline</span> <span class="k">=</span> <span class="nv">pipeline</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">result</span> <span class="k">=</span>  <span class="nv">modelPipeline</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
<span class="nv">result</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"token"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span>
</code></pre></div>  </div>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">PipelineModel</span>
<span class="kn">from</span> <span class="nn">sparkocr.transformers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"path to image"</span>

<span class="c1"># Read image file as binary file
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> 
    <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"binaryFile"</span><span class="p">)</span>
    <span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>

<span class="n">binary_to_image</span> <span class="o">=</span> <span class="n">BinaryToImage</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"content"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span>

<span class="n">ocr</span> <span class="o">=</span> <span class="n">ImageToHocr</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"image"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"hocr"</span><span class="p">)</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">HocrTokenizer</span><span class="p">()</span> \
    <span class="p">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s">"hocr"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s">"token"</span><span class="p">)</span>

<span class="c1"># Define pipeline
</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">PipelineModel</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span>
    <span class="n">binary_to_image</span><span class="p">,</span>
    <span class="n">ocr</span><span class="p">,</span>
    <span class="n">tokenizer</span>
<span class="p">])</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">result</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"token"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>  </div>

</div>

<p>Output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+--------------------------------------------------------------------+
| token                                                              |
+--------------------------------------------------------------------+
| [[token, 0, 6, patient, [x -&gt; 2905, y -&gt; 527, height -&gt; 56,        |
| confidence -&gt; 95, word -&gt; Patient, width -&gt; 230], []], [token, 8,  |
|10, nam, [x -&gt; 3166, y -&gt; 526, height -&gt; 55, confidence -&gt; 95, word |
|-&gt; Nam, width -&gt; 158], []] ...                                      |
+--------------------------------------------------------------------+

</code></pre></div></div>
</div><div class="d-print-none"><footer class="article__footer"><span class="footer_date">Last updated
      <time itemprop="dateModified" datetime="2020-04-08T00:00:00+00:00">Apr 08, 2020</time>
    </span><!-- start custom article footer snippet -->

<!-- end custom article footer snippet --></footer>

<script>


jQuery(document).ready(function(){  
    $( ".scala-button" ).click(function() {
        $(this).closest( ".tabs-box" ).find(".scala-button").removeClass('code-selector-un-active').addClass( "code-selector-active" );        

        //remove  active class from all other buttons
        $(this).closest( ".tabs-box" ).find(".nlu-button").removeClass('code-selector-active').addClass('code-selector-un-active');
        $(this).closest( ".tabs-box" ).find(".python-button").removeClass('code-selector-active').addClass('code-selector-un-active');

        //toggle language snippets
        $(this).closest( ".tabs-box" ).find( ".language-scala" ).show();
        $(this).closest( ".tabs-box" ).find( ".language-python, .nlu-block" ).hide();
    });

    $( ".python-button" ).click(function() {
        //set current button to active class and remove unactive class
        $(this).closest( ".tabs-box" ).find(".python-button").removeClass('code-selector-un-active').addClass( "code-selector-active" ); 

        //remove  active class from all other buttons
        $(this).closest( ".tabs-box" ).find(".nlu-button").removeClass('code-selector-active').addClass('code-selector-un-active');
        $(this).closest( ".tabs-box" ).find(".scala-button").removeClass('code-selector-active').addClass('code-selector-un-active');


        //toggle language snippets
        $(this).closest( ".tabs-box" ).find( ".language-python" ).show();
        $(this).closest( ".tabs-box" ).find( ".nlu-block, .language-scala" ).hide();
    });

    $( ".nlu-button" ).click(function() {
        //set current button to active class and remove unactive class
        $(this).closest( ".tabs-box" ).find(".nlu-button").removeClass('code-selector-un-active').addClass( "code-selector-active" );        

        //remove  active class from all other buttons
        $(this).closest( ".tabs-box" ).find(".scala-button").removeClass('code-selector-active').addClass('code-selector-un-active');
        $(this).closest( ".tabs-box" ).find(".python-button").removeClass('code-selector-active').addClass('code-selector-un-active');

        //toggle language snippets        
        $(this).closest( ".tabs-box" ).find( ".language-python, .language-scala" ).hide();
        $(this).closest( ".tabs-box" ).find( ".nlu-block" ).show();
    });
});

function togglePython1() {

    //set current button to active class and remove unactive class
    $( ".python-button" ).addClass( "code-selector-active" );


    //toggle language snippets
    $( ".tabs-box .language-python" ).show() 
    $( ".tabs-box .nlu-block" ).hide()
    $( ".tabs-box .language-scala" ).hide()
}

function defer(method) { //wait until jquery ready
    if (window.jQuery) {
        method();
    } else {
        setTimeout(function() { defer(method) }, 15);
    }
}

defer(function () { // load inital language
    togglePython1()
});




</script>


<style>
  /* Remove Scrollbar from Code Segments */
.article__content .highlighter-rouge > .highlight > pre > code, .article__content figure.highlight > pre > code  {
    overflow: auto;
}



button.code-selector-active {
 background-color: white;
 color: #08c;
 font-weight: bold;
 border-width: 1px;
 padding-left: 12px;
 padding-right: 12px;
 width: 90px;
 padding-top: 6px;
 margin-right: 2px;

 border-bottom: none;

 position: relative;
 z-index: 2;
}

button.code-selector-un-active {
    background-color: white;
    padding-left: 12px;
    padding-right: 12px;
    width: 90px;
    margin-right: 2px;
    padding-top: 8px;
    position: relative;
    border-bottom: none;

   }

hr.code-selector-underlie {
    border-top: 1px solid;
    background-color: black;
    width: fill;
    height: 1px;
    margin-top: -3px;
    position: relative;

}

</style><div class="article__section-navigator clearfix"><div class="previous nav_link"><span>PREVIOUS</span><a href="/docs/en/version_compatibility">Version Compatibility</a></div><div class="next nav_link"><span>NEXT</span><a href="/docs/en/ocr_table_recognition">Table recognition</a></div></div></div>

</div>
</div>

<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    $(function() {
      var $this ,$scroll;
      var $articleContent = $('.js-article-content');
      var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
      var scroll = hasSidebar ? '.js-page-main' : 'html, body';
      $scroll = $(scroll);

      $articleContent.find('.highlight').each(function() {
        $this = $(this);
        $this.attr('data-lang', $this.find('code').attr('data-lang'));
      });
      $articleContent.find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').each(function() {
        $this = $(this);
        $this.append($('<a class="anchor d-print-none" aria-hidden="true"></a>').html('<i class="fas fa-anchor"></i>'));
      });
      $articleContent.on('click', '.anchor', function() {
        $scroll.scrollToAnchor('#' + $(this).parent().attr('id'), 400);
      });
    });
  });
})();
</script></div><section class="page__comments d-print-none"></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet --></div>
            </div></div></div><div class="page__footer d-print-none">
<footer class="footer py-4 js-page-footer">
  <div class="main"><div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content=""><meta itemprop="url" content="/"></div><div class="site-info mt-2">
      <div>© 2021 John Snow Labs Inc.
        <a href="http://www.johnsnowlabs.com/terms-of-service">Terms of Service</a> | <a href="http://www.johnsnowlabs.com/privacy-policy/">Privacy Policy</a>
      </div>
    </div>
  </div>
</footer>

<script>

/* Responsive menu
	 ========================================================*/
jQuery(document).ready(function($) {
	jQuery('#responsive_menu').click(function(e) {
      e.preventDefault();
      jQuery(this).toggleClass('close');
      jQuery('.top_navigation').toggleClass('open');
  });
  jQuery('#aside_menu').click(function(e) {
      e.preventDefault();
      jQuery(this).toggleClass('close');
      jQuery('.js-col-aside').toggleClass('open');
      if (jQuery(window).width() <= 1023)
      {
        jQuery('.page__sidebar').toggleClass('open'); 
      jQuery('.demopage-sidemenu').toggleClass('open');
      }
  });
  jQuery('.toc--ellipsis a').click(function(e) {
    if (jQuery(window).width() <= 767)
      {
        jQuery('.js-col-aside').removeClass('open');
        jQuery('.page__sidebar').removeClass('open');    
        jQuery('#aside_menu').removeClass('close');  
      }       
  });
});

/*TABS*/
function openTabCall(cityName){
  // Declare all variables
  var i, tabcontent, tablinks;

  // Get all elements with class="tabcontent" and hide them
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }

  // Get all elements with class="tablinks" and remove the class "active"
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }

  // Show the current tab, and add an "active" class to the button that opened the tab
  document.getElementById(cityName).style.display = "block";
}

function openTab(evt, cityName) {
  openTabCall(cityName);
  evt.currentTarget.className += " active";
}

/*OPen by URL*/
$(document).ready(function () {  
  const tabName = (window.location.hash || '').replace('#', '');
  const tab = document.getElementById(tabName || 'opensource');
  if (tab) {
    tab.click();
  }
});

jQuery(document).ready(function(){
	jQuery('.tab-item').click(function(event) {		
		if (($(window).width() > 400) && ($(window).width() < 1199))
	    {
	    	jQuery('.tab-item').removeClass('open');
	        jQuery(this).toggleClass('open');
	    }
  });
  

});


 

</script></div></div>
    </div></div></div><script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal"></div></div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
/*(function () {

})();*/
</script><script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;

  window.Lazyload.js(SOURCES.jquery, function() {
    var $pageMask = $('.js-page-mask');
    var $pageRoot = $('.js-page-root');
    var $sidebarShow = $('.js-sidebar-show');
    var $sidebarHide = $('.js-sidebar-hide');

    function freeze(e) {
      if (e.target === $pageMask[0]) {
        e.preventDefault();
      }
    }
    function stopBodyScrolling(bool) {
      if (bool === true) {
        window.addEventListener('touchmove', freeze, { passive: false });
      } else {
        window.removeEventListener('touchmove', freeze, { passive: false });
      }
    }

    $sidebarShow.on('click', function() {
      stopBodyScrolling(true); $pageRoot.addClass('show-sidebar');
    });
    $sidebarHide.on('click', function() {
      stopBodyScrolling(false); $pageRoot.removeClass('show-sidebar');
    });
  });
})();
</script><script>
  /* toc must before affix, since affix need to konw toc' height. */(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  var TOC_SELECTOR = window.TEXT_VARIABLES.site.toc.selectors;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window);
    var $articleContent = $('.js-article-content');
    var $tocRoot = $('.js-toc-root'), $col2 = $('.js-col-aside');
    var toc;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
    var hasToc = $articleContent.find(TOC_SELECTOR).length > 0;

    function disabled() {
      return $col2.css('display') === 'none' || !hasToc;
    }

    tocDisabled = disabled();

    toc = $tocRoot.toc({
      selectors: TOC_SELECTOR,
      container: $articleContent,
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      tocDisabled = disabled();
      toc && toc.setOptions({
        disabled: tocDisabled
      });
    }, 100));

  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $pageFooter = $('.js-page-footer');
    var $pageAside = $('.js-page-aside');
    var affix;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');

    affix = $pageAside.affix({
      offsetBottom: $pageFooter.outerHeight(),
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      scroll: hasSidebar ? $('.js-page-main').children() : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      affix && affix.setOptions({
        disabled: tocDisabled
      });
    }, 100));

    window.pageAsideAffix = affix;
  });
})();
</script><script>
  window.Lazyload.js(['https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js', 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js'], function() {
    var $canvas = null, $this = null, _ctx = null, _text = '';
    $('.language-chart').each(function(){
      $this = $(this);
      $canvas = $('<canvas></canvas>');
      _text = $this.text();
      $this.text('').append($canvas);
      _ctx = $canvas.get(0).getContext('2d');
      (_ctx && _text) && (new Chart(_ctx, JSON.parse(_text)) && $this.attr('data-processed', true));
    });
  });
</script><script type="text/x-mathjax-config">
	var _config = { tex2jax: {
		inlineMath: [['$','$'], ['\\(','\\)']]
	}};_config.TeX = { equationNumbers: { autoNumber: "all" } };MathJax.Hub.Config(_config);
</script>
<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script>
  window.Lazyload.js('https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js', function() {
    mermaid.initialize({
      startOnLoad: true
    });
    mermaid.init(undefined, '.language-mermaid');
  });
</script>
    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>